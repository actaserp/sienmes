<!DOCTYPE html>
<html lang="ko">
<style>
    .search-wrap{
        position: relative;
        padding: 0 10px;
        background-color: #fff;
        border-radius: 0 !important;
        box-shadow: 0 0 0 !important;
        margin-bottom: 10px !important;
    }

    button:hover, .btn:hover{
        border: 0 !important;
    }

    .aco-cont{
        border-top: 1px solid #EFEFEF !important;
    }

    .search-wrap .srch-cont dl{
        border-bottom: 1px solid #333 !important;
    }

    .questionBox {
        position: relative;
        height: 300px;
        border: 1px solid lightgrey;
        margin: 30px 10px 0 10px;
        border-radius: 6px;
        display: flex;
        align-items: center;
    }

    .questionBox textarea {
        width: 100%;
        height: 100px; /* ë†’ì´ ì¡°ì • ê°€ëŠ¥ */
        border: none;
        outline: none;
        resize: none;
        padding-right: 30px; /* X ë²„íŠ¼ ê³µê°„ í™•ë³´ */
    }

    .clear-btn {
        position: absolute;
        top: 93%;
        right: 0;
        transform: translateY(-50%);
        width: 20px;
        height: 20px;
        color: black;
        font-size: 14px;
        font-weight: bold;
        border: none;
        border-radius: 50%;
        cursor: pointer;
        display: none; /* ê¸°ë³¸ì ìœ¼ë¡œ ìˆ¨ê¹€ */
        align-items: center;
        justify-content: center;
    }

    .srch-tit {
        display: flex;
        justify-content: normal !important;
        align-items: center;
        width: 100%;
    }

    .qst-text {

    }

    .answer-status {
        display: inline-flex;
        align-items: center;
        gap: 5px; /* "ë¯¸ë‹µë³€"ê³¼ X ë²„íŠ¼ ê°„ê²© ì¡°ì • */
    }

    .status-Red {
        margin-left: 10px;
        color: tomato;
        font-weight: bold;
    }

    .status-Blue {
        margin-left: 10px;
        color: dodgerblue;
        font-weight: bold;
    }
    .delete-btn {
        color: black;
        border: none;
        width: 18px;
        cursor: pointer;
        align-items: center;
        justify-content: center;
        padding: 2px;
    }

    .btn-aco{
        display: flex;
        margin-left: auto;
    }

    .qst-text {
        max-width: 75%; /* ìµœëŒ€ ë„ˆë¹„ ì§€ì • */
        overflow: hidden;
        white-space: nowrap;
        text-overflow: ellipsis;
        display: inline-block;
        vertical-align: middle;
    }

    #QnAContainer {
        max-height: 400px;
        overflow-y: auto;
        border: 1px solid lightgrey;
        border-radius: 5px;
    }

</style>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FACT CHECK</title>
    <link rel="icon" type="image/png" href="/images/logo/icon_FACT%20CHECK.png">
    <link rel="stylesheet" href="https://code.jquery.com/ui/1.12.1/themes/smoothness/jquery-ui.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css"/> <!-- Slide css -->
    <link rel="stylesheet" href="/resource/ax5ui/ax5ui.all.css">
    <link rel="stylesheet" type="text/css" href="/assets_mobile/css/import.css">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.min.js"></script>

    <script src="/assets_mobile/js/ui.js"></script> <!-- Common js -->
    <script type="text/javascript" src="/resource/ax5ui/ax5ui.all.min.js?v=1000"></script>
    <script type="text/javascript" src="/js/ax5commUtil.js?v=1070"></script>
    <script src="/js/common.js?v=1060"></script>
    <script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script> <!-- Slide js -->
    <script src="/js/Mobile.js"></script>
</head>

<body>
<div class="mobile-wrapper"><!-- â˜…í˜ì´ì§€ Classëª… -->
    <!-- [ëª¨ë°”ì¼] í—¤ë”  -->
    <div class="mobile-layout-header">
        <header>
            <div class="left">
                <a href="#" title="ì „ì²´ë©”ë‰´" class="logo">
                </a>
            </div>
            <div class="center" style="margin-left:35px;">
                <h2>1:1ë¬¸ì˜</h2>
            </div>
            <div class="right">
                <a href="#" title="ì „ì²´ë©”ë‰´" class="btn-menu">
                    <img src="/assets_mobile/images/icon/btn-menu.svg" alt="ì „ì²´ë©”ë‰´ ì•„ì´ì½˜">
                </a>
            </div>
        </header>
    </div> <!-- //mobile-layout-header end-->

    <!-- [ëª¨ë°”ì¼] ë©”ë‰´  -->
    <div th:insert="~{mobile/mobile_menu :: mobile_menu}"></div>
    <!-- [ëª¨ë°”ì¼] ì»¨ë´ì¸   -->
    <div class="mobile-layout-contents">
        <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
        <!--- (ë ˆì´ì•„ì›ƒ) Contents ì˜ì—­ -->
        <div class="layout-contents" style="padding-bottom: 10px">

            <!-- ê²€ìƒ‰ ì˜ì—­  -->
            <div id="QnAContainer">

            </div>

            <div id="questionBox" class="questionBox">
                <input type="hidden" id="seq" />
                <textarea id="questionTextarea" style="height: 100%"></textarea>
                <button id="clearButton" class="clear-btn">X</button>
            </div>
            <div style="display: flex; justify-content: center;">
                <button id="questionSave" class="btn" style="width: 120px; margin-top: 25px">ë¬¸ì˜ ë“±ë¡</button>
            </div>

        </div> <!--//layout-contents end -->
    </div> <!-- //mobile-layout-contents end-->
</div> <!-- //page-wrapper end-->

<script type="text/javascript">

    document.readyState === 'complete' ? init() : window.onload = init;

    const textarea = document.getElementById("questionTextarea");
    const clearButton = document.getElementById("clearButton");

    // ì…ë ¥ì´ ìˆì„ ë•Œë§Œ X ë²„íŠ¼ í‘œì‹œ
    textarea.addEventListener("input", function () {
        clearButton.style.display = textarea.value.trim() ? "flex" : "none";
    });

    // X ë²„íŠ¼ í´ë¦­ ì‹œ ë‚´ìš© ì´ˆê¸°í™”
    clearButton.addEventListener("click", function () {
        textarea.value = "";
        clearButton.style.display = "none";
        textarea.focus(); // í´ë¦­ í›„ ë‹¤ì‹œ ì…ë ¥ ê°€ëŠ¥í•˜ê²Œ í¬ì»¤ìŠ¤ ìœ ì§€
    });

    function init() {
        fetchList();
    }

    function fetchList() {
        $.ajax({
            url: "/api/inquiry/list",
            type: "GET",
            success: function (response) {
                if (response.success) {

                    console.log(response.data);
                    renderQnA(response.data);

                } else {
                    Alert.alert("QnAì— ëŒ€í•œ ì •ë³´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
                }
            },
            error: function (xhr, status, error) {
                Alert.alert("ì„œë²„ì™€ì˜ í†µì‹  ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
            }
        });
    }


    function renderQnA(faqData) {
        const container = document.getElementById("QnAContainer");
        container.innerHTML = ''; // ê¸°ì¡´ FAQ ì´ˆê¸°í™”

        faqData.forEach(item => {
            console.log("ğŸ”¹ ì¶”ê°€í•  í•­ëª©:", item);

            let deleteButton = item.answer ? '' : `<button class="delete-btn" data-qstseq="${item.QSTSEQ}">X</button>`

            let answerStatus = item.answer ? `<span class="status-Blue">ë‹µë³€ì™„ë£Œ</span>` : `
            <span class="status-Red">ë¯¸ë‹µë³€</span>
        `;

            let toggleButton = item.answer ? `
            <a href="#" title="ì—´ê¸°/ë‹«ê¸°" class="btn-aco">
                <img src="/assets_mobile/images/icon/ico-down.svg" alt="ì—´ê¸°/ë‹«ê¸°">
            </a>` : '';

            let faqItem = document.createElement("div");
            faqItem.classList.add("search-wrap");
            faqItem.setAttribute("data-qstseq", item.QSTSEQ); // ì‚­ì œí•  ë•Œ ì‚¬ìš©
            faqItem.innerHTML = `
            <div class="srch-tit aco-hd" data-qstseq="${item.QSTSEQ}" data-qsttext="${item.QSTTEXT}">
                <span class="qst-text" title="${item.QSTTEXT}">${item.QSTTEXT}</span>
                <span class="answer-status">
                    ${answerStatus}
                        ${deleteButton}
                </span>
                ${toggleButton}
            </div>
            <div class="srch-cont ${item.answer ? 'aco-cont answer' : 'aco-cont'}" style="display: none;">
                <dl>
                    <dt>ë‹µë³€</dt>
                    <dd>${item.answer ? item.answer : '<span style="color: red;">ì•„ì§ ë‹µë³€ì´ ë“±ë¡ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.</span>'}</dd>
                </dl>
            </div>
        `;

            container.appendChild(faqItem);
        });


        $(document).off("click", ".aco-hd").on("click", ".aco-hd", function () {
            let qstText = $(this).data("qsttext");  // ë¬¸ì˜ ë‚´ìš© ê°€ì ¸ì˜¤ê¸°
            let qstSeq = $(this).data("qstseq");  // ë¬¸ì˜ ID ê°€ì ¸ì˜¤ê¸°
            console.log("ë¬¸ì˜ ë‚´ìš©:", qstText, "ë¬¸ì˜ ID:", qstSeq);


            $("#questionTextarea").val(qstText);

            // í´ë¦­ëœ ì•„ì½”ë””ì–¸ í•­ëª©ì˜ ì»¨í…ì¸  í† ê¸€
            $(this).next('.aco-cont').slideToggle();
            $('.aco-cont').not($(this).next()).slideUp();
            $(this).toggleClass('active');
            $('.aco-hd').not($(this)).removeClass('active');
        });

        // X ë²„íŠ¼ í´ë¦­ ì‹œ í•´ë‹¹ ë¬¸ì˜ ì‚­ì œ
        $(document).off("click", ".delete-btn").on("click", ".delete-btn", function (e) {
            e.stopPropagation(); // ë¶€ëª¨ í´ë¦­ ì´ë²¤íŠ¸ ë°©ì§€

            let qstSeq = $(this).data("qstseq");  // ì‚­ì œí•  ë¬¸ì˜ ID
                let _this = this;
            Alert.confirm('', 'ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?', function(){
                let data = {
                    'id' : qstSeq,
                    '_csrf': csrfToken
                }
                let fnSuccess = function (res) {
                    if (res.success) {
                        Alert.alert('', 'ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.', function(){
                            // í•´ë‹¹ ìš”ì†Œ ì‚­ì œ
                            $(_this).closest(".search-wrap").remove();
                        });

                    }else{
                        Alert.alert('', res.message);
                    }
                }
                AjaxUtil.postAsyncData('/api/inquiry/delete', data, fnSuccess);
            })


        });
    }

    function resetField(){
        $('#questionTextarea').val("");

    }

    $('#questionSave').click(function(){
        let val = $('#questionTextarea').val();

        if(val === '') {
            Alert.alert('', 'ë‚´ìš©ì„ ì…ë ¥í•´ ì£¼ì„¸ìš”.')
        }else{

            let data = {
                '_csrf': csrfToken,
                'content' : val
            }
            let fnSuccess = function (res) {
                if (res.success) {
                    Alert.alert('', 'ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤.', function(){
                        fetchList();
                        resetField();
                    });
                }
            }
            AjaxUtil.postAsyncData('/api/inquiry/save', data, fnSuccess);
        }
    })

</script>
</body>
</html>

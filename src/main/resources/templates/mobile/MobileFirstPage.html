<!DOCTYPE html>
<html lang="ko">
<style>
    .mobile-layout-header header {
        display: flex;
        justify-content: center; /* ê°€ìš´ë° ì •ë ¬ */
        align-items: center; /* ìˆ˜ì§ ì •ë ¬ */
        height: 60px; /* ë†’ì´ ì¡°ì ˆ */
    }

    .left {
        margin-left: 0; /* ê¸°ì¡´ ì—¬ë°± ì œê±° */
    }

    .left h2 {
        font-size: 25px; /* ê¸€ì í¬ê¸° ì„¤ì • */
    }
    .btn-clear {
        display: none !important; /* ê°•ì œë¡œ ìˆ¨ê¹€ */
    }
    .btn-close {
        display: none !important; /* ê°•ì œë¡œ ìˆ¨ê¹€ */
    }
    /* ì „ì²´ ì»¨í…Œì´ë„ˆ ìŠ¤íƒ€ì¼ */
    .contents-wrap {
        width: 100%;
        max-width: 500px;
        margin: 0 auto;
    }

    /* ê²€ìƒ‰ ì˜ì—­ ìŠ¤íƒ€ì¼ */
    #searcharea, #detailarea {
        position: relative;
        width: 100%;
        margin-top: 10px;
    }

    #searcharea input, #detailarea input {
        width: 100%;
        border: none;
        outline: none;
        font-size: 16px;
        padding: 10px;
    }

    /* ê²€ìƒ‰ ì•„ì´ì½˜ (SVG) */
    .search-icon {
        position: absolute;
        right: 10px;
        top: 50%;
        transform: translateY(-50%);
        cursor: pointer;
    }

    /* ê²€ìƒ‰ ê°€ì´ë“œ ìŠ¤íƒ€ì¼ */
    .search-guide {
        padding: 10px;
        font-size: 14px;
        color: #666;
    }

    /* ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
    .btn-select, .btn-login {
        width: 100%;
        padding: 10px;
        margin-top: 10px;
        border: none;
        border-radius: 5px;
        cursor: pointer;
    }

    /* ëª¨ë‹¬ ì˜¤ë²„ë ˆì´ (ë°°ê²½ íë¦¬ê²Œ) */
    .modal-overlay {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.5); /* ë°˜íˆ¬ëª…í•œ ê²€ì€ìƒ‰ ë°°ê²½ */
        z-index: 999; /* ëª¨ë‹¬ë³´ë‹¤ í•œ ë‹¨ê³„ ì•„ë˜ */
    }

    /* ëª¨ë‹¬ ìŠ¤íƒ€ì¼ */
    .modal {
        display: none;
        position: fixed;
        left: 50%;
        top: 50%;
        transform: translate(-50%, -50%);
        width: 400px;
        max-width: 90%;
        background-color: white;
        border-radius: 10px;
        box-shadow: 0px 4px 6px rgba(0, 0, 0, 0.1);
        padding: 20px;
        z-index: 9999;
    }

    /* ëª¨ë‹¬ ë‹«ê¸° ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
    .modal-close {
        position: absolute;
        top: 10px;
        right: 5px;
        width: 30px; /* ë²„íŠ¼ í¬ê¸° */
        height: 25px;
        border: none;
        border-radius: 3px;
        background: none; !important; /* ë°°ê²½ ì œê±° */
        background-color: transparent; !important; /* ë°°ê²½ì„ íˆ¬ëª…í•˜ê²Œ */
        z-index: 1000;
        cursor: pointer; /* í´ë¦­ ê°€ëŠ¥í•œ ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
    }
    #loadingSpinner {
        position: fixed;
        top: 0;
        left: 0;
        width: 100vw;
        height: 100vh;
        background: rgba(0, 0, 0, 0.8); /* ë°°ê²½ ì–´ë‘¡ê²Œ */
        display: flex;
        justify-content: center;
        align-items: center;
        z-index: 9999;
    }

    #loadingImage {
        width: 90%; /* ì „ì²´ í™”ë©´ì˜ 80% í¬ê¸° */
        max-width: 700px; /* ìµœëŒ€ í¬ê¸° ì œí•œ */
    }

</style>
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>FACT CHECK</title>
  <link rel="icon" type="image/png" href="/images/logo/icon_FACT%20CHECK.png">
  <link rel="stylesheet" href="https://code.jquery.com/ui/1.12.1/themes/smoothness/jquery-ui.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css"/> <!-- Slide css -->
  <link rel="stylesheet" href="/resource/ax5ui/ax5ui.all.css">
  <link rel="stylesheet" type="text/css" href="/assets_mobile/css/import.css">
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.min.js"></script>

  <script src="/assets_mobile/js/ui.js"></script> <!-- Common js -->
  <script th:inline="javascript">
    var sandanData = /*[[${session.sandanList}]]*/ [];
  </script>


  <script type="text/javascript" src="/resource/ax5ui/ax5ui.all.min.js?v=1000"></script>
  <script type="text/javascript" src="/js/ax5commUtil.js?v=1070"></script>
  <script src="/js/common.js?v=1060"></script>
  <script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script> <!-- Slide js -->
</head>

<body>
<div class="mobile-wrapper page-ticket-list"><!-- â˜…í˜ì´ì§€ Classëª… -->
  <!-- [ëª¨ë°”ì¼] í—¤ë”  -->
  <div class="mobile-layout-header">
    <header>
      <div class="left">
        <h2>FACT CHECK</h2>
      </div>
    </header>
  </div> <!-- //mobile-layout-header end-->
  <!-- [ëª¨ë°”ì¼] ë©”ë‰´  -->
  <div th:insert="~{mobile/mobile_menu :: mobile_menu}"></div>
  <!-- [ëª¨ë°”ì¼] ì»¨ë´ì¸   -->
  <div class="mobile-layout-contents">
    <!--- (ë ˆì´ì•„ì›ƒ) Contents ì˜ì—­ -->
    <div class="layout-contents">
      <!-- ê²€ìƒ‰ ì˜ì—­  -->
      <div class="search-wrap">

      </div>
      <!-- ì»¨í…ì¸  ì˜ì—­  -->
      <div class="contents-wrap">
        <dl style="margin-bottom: 10px">
          <div class="search-container">
            <input type="hidden" id="postno">
            <h2>ì£¼ì†Œ</h2>

            <!-- ì£¼ì†Œ ê²€ìƒ‰ ì…ë ¥ì°½ -->
            <div id="searcharea">
              <input type="text" id="address1" placeholder="ê²€ìƒ‰ í•  ë¶€ë™ì‚° ì£¼ì†Œë¥¼ ì…ë ¥ í•´ì£¼ì„¸ìš”" onfocus="openModal()">
              <span class="search-icon" id="searchIcon" onclick="openModal()">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <circle cx="11" cy="11" r="7" stroke="black" stroke-width="2"/>
                        <line x1="16" y1="16" x2="22" y2="22" stroke="black" stroke-width="2"/>
                    </svg>
                </span>
            </div>
            <div class="modal-overlay" id="modalOverlay"></div>
            <!-- ëª¨ë‹¬ -->
            <div id="postcodeModal" class="modal">
              <div class="modal-content">
                <div style="display: flex">
                  <div class="modal-header"></div>
                  <button class="modal-close" onclick="closeModal()">
                    <img src="../img/icon/factcheck/x-lg.svg" alt="ë‹«ê¸°" class="close-icon">
                  </button>
                </div>
                <div id="postcodeContainer"></div>
              </div>
            </div>


            <!-- ìƒì„¸ ì£¼ì†Œ ì…ë ¥ -->
            <div id="detailarea">
              <input type="text" id="address2" placeholder="ìƒì„¸ì£¼ì†Œë¥¼ ì…ë ¥ í•˜ì„¸ìš”">
            </div>
          </div>

          <!-- ê²€ìƒ‰ ê°€ì´ë“œ -->
          <div class="search-guide">
            <p>* ë¶€ë™ì‚° ì†Œì¬ì§€ë²ˆ ë˜ëŠ” ë„ë¡œëª…, ë™/í˜¸ë¡œ ê²€ìƒ‰í•˜ë©´ ì •í™•í•œ ê²°ê³¼ë¥¼ ì–»ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
            <p>* ë¯¸ë“±ê¸°ì¸ ê²½ìš° ì£¼ì†Œ ì¡°íšŒ ë° ë“±ë¡ì´ ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.</p>
          </div>

          <!-- ë²„íŠ¼ -->
          <div style="display: flex; gap: 5px; align-items: center; max-width: 100%;">
          <button onclick="searchGoyuList()" style="margin-top: 10px;border: none; margin-bottom: 10px;">ë¬¼ê±´ ì„ íƒ</button>
          <button id="login" style="padding-top: 0px;border: none;">ë¡œê·¸ì¸ í•˜ëŸ¬ ê°€ê¸°</button>
          </div>
        </dl>
      </div>


      <div id="addressWrap" class="contents-wrap"></div>

      <!-- ë¡œë”© í™”ë©´ -->
      <div id="loadingSpinner" style="display: none;">
        <img src="/images/gif/CardLoading.gif" alt="ë¡œë”© ì¤‘" id="loadingImage">
      </div>
    </div> <!--//layout-contents end -->

  </div> <!-- //mobile-layout-contents end-->
</div> <!-- //page-wrapper end-->
<script src="//t1.daumcdn.net/mapjsapi/bundle/postcode/prod/postcode.v2.js"></script>
<script th:inline="javascript">
  // // Thymeleafì—ì„œ ê°’ ì„¤ì •: Null ì²´í¬ì™€ ê¸°ë³¸ê°’ ì²˜ë¦¬
  // var groupid = [[${session.groupid != null ? session.groupid : 'null'}]];
  // var id = /*[[${id != null ? id : 'null'}]]*/;
  // var groupname = /*[[${groupname != null ? groupname : 'null'}]]*/;
  // var username = /*[[${username != null ? username : 'null'}]]*/;
  //
  // // ë¡œì»¬ìŠ¤í† ë¦¬ì§€ì— ê°’ ìœ ì§€ (null ë˜ëŠ” ë¹ˆ ë¬¸ìì—´ì€ ì €ì¥í•˜ì§€ ì•ŠìŒ)
  // if (groupid && groupid !== 'null') localStorage.setItem('groupid', groupid);
  // if (id && id !== 'null') localStorage.setItem('id', id);
  // if (username && username !== 'null') localStorage.setItem('username', username);
  // if (groupname && groupname !== 'null') localStorage.setItem('groupname', groupname);
</script>
<script>
  function openModal() {
    document.getElementById('postcodeModal').style.display= 'block';
    document.getElementById('searcharea').style.display= 'none';
    document.getElementById("searchIcon").style.display = "none";
    new daum.Postcode({
      oncomplete: function(data) {
        var roadAddr = data.roadAddress;
        var extraRoadAddr = '';

        if (data.bname !== '' && /[ë™|ë¡œ|ê°€]$/g.test(data.bname)) {
          extraRoadAddr += data.bname;
        }
        if (data.buildingName !== '' && data.apartment === 'Y') {
          extraRoadAddr += (extraRoadAddr !== '' ? ', ' + data.buildingName : data.buildingName);
        }
        if (extraRoadAddr !== '') {
          extraRoadAddr = ' (' + extraRoadAddr + ')';
        }

        document.getElementById('postno').value = data.zonecode;
        document.getElementById('address1').value = roadAddr;

        closeModal();
      },
      onresize: function(size) {
        // ëª¨ë‹¬ ë‚´ë¶€ iframe í¬ê¸° ìë™ ì¡°ì •
        const layers = document.querySelectorAll('[id^="__daum__layer_"]');
        layers.forEach(layer => {
          layer.style.width = '100%';
          layer.style.height = window.innerHeight * 0.6 + 'px'; // í™”ë©´ ë†’ì´ì˜ 60%ë¡œ ì¡°ì •
          layer.style.overflow = 'hidden';
          layer.style.backgroundColor = '#fff';
        });

        // ëª¨ë‹¬ í¬ê¸° ì¡°ì •
        const modal = document.getElementById('postcodeModal');
        if (modal) {
          modal.style.width = '90%'; // ì‘ì€ í™”ë©´ì—ì„œëŠ” ë„ˆë¹„ë¥¼ 90%ë¡œ ì„¤ì •
          modal.style.maxWidth = '500px'; // ìµœëŒ€ ë„ˆë¹„ ì œí•œ
          modal.style.height = 'auto';
          modal.style.maxHeight = window.innerHeight * 0.8 + 'px'; // í™”ë©´ì˜ 80%ê¹Œì§€ë§Œ ì»¤ì§€ë„ë¡ ì„¤ì •
        }
      }

    }).embed(document.getElementById('postcodeContainer'));
  }

  function closeModal() {
    document.getElementById('postcodeModal').style.display= 'none';
    document.getElementById('searcharea').style.display= 'block';
  }
</script>
<script type="text/javascript">
  document.readyState === 'complete' ? init() : window.onload = init;

  function init() {
    // âœ… ë¡œê·¸ì¸ ì—¬ë¶€ í™•ì¸
    const isLoggedIn = sessionStorage.getItem('isLoggedIn');
    const loginButton = document.getElementById('login'); // ë¡œê·¸ì¸ ë²„íŠ¼ ì„ íƒ
    const localLogged = localStorage.getItem('isLoggedIn');

    if(localLogged === 'true'){
      localStorage.removeItem('isLoggedIn');
    }

    if (isLoggedIn === 'true') {
      console.log("âœ… ë¡œê·¸ì¸ ìœ ì§€ë¨: í˜„ì¬ í˜ì´ì§€ ìœ ì§€");

      // ë¡œê·¸ì¸ ìƒíƒœì´ë©´ ë²„íŠ¼ ìˆ¨ê¸°ê¸°
      if (loginButton) {
        loginButton.style.display = "none";
        //sessionStorage.removeItem('isLoggedIn');
      }
    } else {
      console.log("ğŸ”’ ë¡œê·¸ì¸ ì •ë³´ ì—†ìŒ: ë¡œê·¸ì¸ í•˜ëŸ¬ ê°€ê¸° ë²„íŠ¼ ë³´ì´ê¸°");

      // ë¡œê·¸ì•„ì›ƒ ìƒíƒœì´ë©´ ë²„íŠ¼ ë³´ì´ê¸°
      if (loginButton) {
        loginButton.style.display = "block";
      }
    }
  }

  document.getElementById('login').addEventListener('click', function() {
    window.location.href = '/mobile/mlogin';
  });

  $(document).ready(function () {

    // 2.ê²€ìƒ‰ ë²„íŠ¼ í´ë¦­ ì‹œ ì´ë²¤íŠ¸ ì²˜ë¦¬
    $(document).on('click', 'button[onclick="searchGoyuList()"]', function (e) {
      e.preventDefault(); // ê¸°ë³¸ ë™ì‘ ë°©ì§€
      handleSearchButtonClick(); // ê²€ìƒ‰ ë²„íŠ¼ ì²˜ë¦¬ í•¨ìˆ˜ ì‹¤í–‰
    });
  });

  // ì£¼ì†Œë¥¼ ë¡œì»¬ìŠ¤í† ë¦¬ì§€ì— ì €ì¥
  function saveAddressToLocalStorage() {
    const address1 = $('#address1').val().trim();
    const address2 = $('#address2').val().trim();

    localStorage.setItem('savedAddress1', address1);
    localStorage.setItem('savedAddress2', address2);

    console.log('ì£¼ì†Œ ì €ì¥ ì™„ë£Œ:', address1, address2);
  }

  // ê²€ìƒ‰ ë²„íŠ¼ í´ë¦­ ì‹œ ì‹¤í–‰ë  í•¨ìˆ˜
  function handleSearchButtonClick() {
    saveAddressToLocalStorage(); // ìƒˆ ì£¼ì†Œ ì €ì¥
    clearPreviousSearchResults(); // ê¸°ì¡´ ê²€ìƒ‰ ê²°ê³¼ ì‚­ì œ
  }

  // ê¸°ì¡´ ê²€ìƒ‰ ê²°ê³¼ ì‚­ì œ (ì˜¬ë°”ë¥¸ ì‚­ì œ ë°©ì‹)
  function clearPreviousSearchResults() {
    $('#addressWrap').empty(); // ê¸°ì¡´ ê²€ìƒ‰ ê²°ê³¼ ì‚­ì œ
    localStorage.removeItem('address1'); // ë„ë¡œëª… ì£¼ì†Œ ì‚­ì œ
    localStorage.removeItem('address2'); // ìƒì„¸ ì£¼ì†Œ ì‚­ì œ
  }

  // ê³ ìœ ë²ˆí˜¸ ì¡°íšŒ
  let isRequestInProgress = false;  // ì¤‘ë³µ ìš”ì²­ ë°©ì§€ í”Œë˜ê·¸

  function searchGoyuList() {

    const isLoggedIn = sessionStorage.getItem('isLoggedIn');

    if (isLoggedIn !== 'true') {
      console.log("ë¡œê·¸ì¸ í•„ìš”: ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ì´ë™");
      saveAddressToLocalStorage();
      // Alert í™•ì¸ í›„ ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ì´ë™í•˜ë„ë¡ ìˆ˜ì •
      Alert.alert("ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.", "ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ì´ë™í•©ë‹ˆë‹¤.", function () {

        window.location.href = '/mobile/mlogin';
      });

      return;
    }

    if (isRequestInProgress) return;  // ì§„í–‰ ì¤‘ì´ë©´ ë¬´ì‹œ
    isRequestInProgress = true;

    if (document.getElementById('address1').value === "") {
      Alert.alert('', 'ì£¼ì†Œë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”');
      isRequestInProgress = false;
      return false;
    }


    $.ajax({
      url: '/api/tilko/searchGoyuList',
      type: 'GET',
      data: {
        'address1': $('#address1').val() + " " + $('#address2').val()
      },
      async: false,
      success: function (data) {
        let data2 = data.data;
        // **ë¹„ì–´ ìˆëŠ” ë°ì´í„° ì²´í¬ ë° ê²½ê³  ë©”ì‹œì§€ í‘œì‹œ**
        if (!data2 || data2.length === 0) {
          Alert.alert('', 'ê²€ìƒ‰ëœ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.');
          isRequestInProgress = false;
          return;
        }
        console.log("data2", data);
        console.log("data2", data2);

        const listAddressWrap = document.getElementById('addressWrap');
        const availableColors = ['card-blue', 'card-green', 'card-black', 'card-red', 'card-yellow', 'card-purple'];
        listAddressWrap.innerHTML = '';  // ê¸°ì¡´ ë‚´ìš© ì´ˆê¸°í™”
        let colorIndex = 0;
        let htmlContent = '';

        // 'í† ì§€' ì œì™¸ ë¡œì§
        data2.forEach(data => {
          if (data.Gubun !== 'í† ì§€') {
            const cardColor = availableColors[colorIndex];
            colorIndex = (colorIndex + 1) % availableColors.length;

            let cleanAddress = preprocessAddress(data.rd_addr_detail);
            htmlContent += `
                        <div class="card-box ${cardColor}" data-Goyu="${data.pin}">
                            <div class="card-cont">
                                <dl>
                                    <dt>ê³ ìœ ë²ˆí˜¸</dt>
                                    <dd>${data.pin}</dd>
                                </dl>
                                <dl>
                                    <dt>ì£¼ì†Œ</dt>
                                    <dd>${cleanAddress}</dd>
                                </dl>
                                <dl>
                                    <dt>êµ¬ë¶„</dt>
                                    <dd>${data.real_cls_cd}</dd>
                                </dl>
                                <dl>
                                    <dt>ìƒíƒœ</dt>
                                    <dd>${data.use_cls_cd}</dd>
                                </dl>
                            </div>
                            <button class="btn btn-popup-open" data-popup="popup-history" title="ë“±ê¸°ë¶€">
                                ë“±ê¸°ë¶€ ì¡°íšŒ
                            </button>
                        </div>`;
          } else {
            console.log("í† ì§€ ë°ì´í„°");
          }
        });

        listAddressWrap.insertAdjacentHTML('beforeend', htmlContent);

        // AJAX ì™„ë£Œ ì‹œ í”Œë˜ê·¸ í•´ì œ
        isRequestInProgress = false;

        // ì´ë²¤íŠ¸ ìœ„ì„ (ì¤‘ë³µ ë°©ì§€)
        listAddressWrap.addEventListener('click', (event) => {
          const button = event.target.closest('.btn-popup-open[data-popup="popup-history"]');
          if (!button) return;

          const cardBox = button.closest('.card-box');
          const goyuNum = cardBox.getAttribute('data-Goyu');

          const item = data2.find(d => d.pin === goyuNum);
          if (item) {
            const cleanAddress = preprocessAddress(item.rd_addr_detail);
            searchaddress(item, cleanAddress);
          }
        });
      },
      error: function () {
        isRequestInProgress = false;  // ì—ëŸ¬ ì‹œì—ë„ í”Œë˜ê·¸ í•´ì œ
      }
    });
  }

  // ì£¼ì† íƒœê·¸ ì‚­ì œ ë° ê³µë°± ë©”ì„œë“œ
  function preprocessAddress(input) {
    // 1. <span> ì‹œì‘/ì¢…ë£Œ ì‹œ ê³µë°± ì¶”ê°€
    let processed = input.replace(/<\/?span[^>]*>/g, match => ` ${match} `);
    // 2. ëª¨ë“  íƒœê·¸ ì œê±° ë° ê³µë°± ì¶•ì†Œ
    processed = processed.replace(/<[^>]+>/g, '').replace(/\s+/g, ' ').trim();
    return processed;
  }
  // HTML íƒœê·¸ ì œê±° í•¨ìˆ˜
  function stripHtmlTags(html) {
    let tempDiv = document.createElement("div");
    tempDiv.innerHTML = html;
    return tempDiv.textContent || tempDiv.innerText || "";
  }
  // pdf ë°ì´í„° ì¡°íšŒ ë° íŒŒì‹± ì €ì¥ ë©”ì„œë“œ í˜¸ì¶œ(ë“±ê¸°ë¶€ë“±ë³¸ ì¡°íšŒ ë©”ì„œë“œ)
  let isSearchInProgress = false;  // ì¤‘ë³µ í˜¸ì¶œ ë°©ì§€ í”Œë˜ê·¸

  function searchaddress(data, cleanAddress) {
    if (isSearchInProgress) return; // ì§„í–‰ ì¤‘ì´ë©´ í•¨ìˆ˜ ì¢…ë£Œ
    isSearchInProgress = true; // í”Œë˜ê·¸ ì„¤ì •

    console.log("data : ", data);

    // ë¡œë”© í™”ë©´ í‘œì‹œ
    document.getElementById('loadingSpinner').style.display = 'flex';

    let startTime = Date.now(); // ìš”ì²­ ì‹œì‘ ì‹œê°„ ê¸°ë¡

    $.ajax({
      url: '/api/tilko/downloadPDF',
      type: 'GET',
      data: {
        "GoyuNUM": data.pin,
        "address": cleanAddress
      },
      async: true,
      success: function (response) {
        let elapsedTime = Date.now() - startTime; // ê²½ê³¼ ì‹œê°„ ê³„ì‚°
        let minLoadingTime = 4500; // ìµœì†Œ ë¡œë”© ì‹œê°„ (2ì´ˆ)

        // ìµœì†Œ ë¡œë”© ì‹œê°„ ë³´ì¥ í›„ ì‹¤í–‰
        setTimeout(() => {
          if (!response.success || response.data === null) {
            document.getElementById('loadingSpinner').style.display = 'none';
            isSearchInProgress = false;

            Alert.alert("", response.message);
            return;
          }

          let data2 = response.data;
          console.log("data2", data2);

          let resultMap = {
            "REALID": data2.REALID,
            "REALSCORE": data2.REALSCORE,
            "GRADE": data2.GRADE,
            "COMMENT": data2.COMMENT,
            "ADDRESS": data2.ADDRESS
          };
          sessionStorage.setItem("resultMap", JSON.stringify(resultMap));

          document.getElementById('loadingSpinner').style.display = 'none';
          isSearchInProgress = false;

          // search_card í˜ì´ì§€ë¡œ ì´ë™
          window.location.href = "mobile/search_card";
        }, Math.max(0, minLoadingTime - elapsedTime)); // ìµœì†Œ ë¡œë”© ì‹œê°„ ë³´ì¥
      },
      error: function (error) {
        let elapsedTime = Date.now() - startTime;
        let minLoadingTime = 4500;

        setTimeout(() => {
          document.getElementById('loadingSpinner').style.display = 'none';
          isSearchInProgress = false;
          console.error("Error in API call:", error);
        }, Math.max(0, minLoadingTime - elapsedTime)); // ìµœì†Œ ë¡œë”© ì‹œê°„ ë³´ì¥
      }
    });
  }
</script>
</body>
</html>
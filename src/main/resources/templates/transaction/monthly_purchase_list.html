<html layout:decorate="~{layout_page}">
<th:block layout:fragment="content">
  <div class="layout-contents">
    <div class="page-title-wrap">
      <div class="left">
        <h2>ì›”ë³„ ë§¤ì… í˜„í™©</h2>
        <a title="ë¶ë§ˆí¬" class="bookmark toggle">
          ë‚´ ë©”ë‰´
        </a>
      </div>
      <ul class="page-navi">
        <li><img src="/images/icon/ico-nav-home.svg" alt="í™ˆì•„ì´ì½˜"></li>
        <li>ì…ê¸ˆê´€ë¦¬</li>
        <li>ì›”ë³„ ë§¤ì… í˜„í™©</li>
      </ul>
    </div>

    <section class="section">
      <div class="section-top">
        <div class="search-wrap">
          <dl>
            <dt>
              <label>
                ì—°ë„
              </label>
            </dt>
            <dd>
              <select class="" id="cboYear" name="cboYear">
              </select>
            </dd>
          </dl>
          <dl id="searchComArea">
            <dt>
              ê±°ë˜ì²˜
            </dt>
            <dd>
              <input type="text" id="btnCompanySearch" name="btnCompanySearch" placeholder="í•´ë‹¹ ì¹¸ì„ í´ë¦­í•´ì„œ ê²€ìƒ‰í•˜ì„¸ìš”.">
              <input type="hidden" id="cboCompanyHidden">
              <input type="hidden" id="spjangcdHidden">
            </dd>
          </dl>
          <dl>
            <dt>&nbsp;</dt>
            <dd>
              <li>
                <a class="btn btn-delete" title="ê²€ìƒ‰" id="btnSearch">
                  <!--                                        class ì“°ì´ëŠ” ê³³ ì°¾ê³  ì—†ìœ¼ë©´ í´ë˜ìŠ¤ëª… ìˆ˜ì •í•˜ê¸°-->
                  <img src="/images/icon/btn-srch.svg" alt="ê²€ìƒ‰ ì•„ì´ì½˜">
                  ê²€ìƒ‰
                </a>
              </li>
            </dd>
          </dl>
        </div>
      </div>
      <div class="tab-wrap">
        <ul class="tab-links">
          <li><a href="#tabs_sales" style="border-radius: 6px 0 0 0;">ë§¤ì…</a></li>
          <li><a href="#tabs_payment">ì§€ê¸‰</a></li>
          <li><a href="#tabs_accounts_payable" style="border-radius: 0 6px 0 0;">ë¯¸ì§€ê¸‰</a></li>
        </ul>
        <div>
          <section class="tab-item" id="tabs_sales" style="border-top-left-radius: 0;">
            <div class="container-fluid">
              <div id="theGrid" style="height: 730px;"></div>
            </div>
          </section>
          <section class="tab-item" id="tabs_payment" style="border-top-left-radius: 0;">
            <div class="container-fluid">
              <div id="payment-grid" style="height: 730px;"></div>
            </div>
          </section>
          <section class="tab-item" id="tabs_accounts_payable" style="border-top-left-radius: 0;">
            <div class="container-fluid">
              <div id="accounts_payable-grid" style="height: 730px;"></div>
            </div>
          </section>

        </div>
      </div>
    </section>
  </div>
  <!-- ë§¤ì… ìƒì„¸ íŒì—…-->
  <script type="text/x-tmpl" id="PurchaseDetailPopup">
    <div class="content_wrap popup">
        <section class="section" style="padding-top: 10px;">
            <div class="section-top">
                <div class="container-fluid">
                    <div id="PurchaseGrid" style="height: 450px;"></div>
                </div>
            </div>
        </section>
    </div>
  </script>
  <!-- ì§€ê¸‰ ìƒì„¸ íŒì—…-->
  <script type="text/x-tmpl" id="popup_Payment">
    <div class="content_wrap popup">
        <section class="section" style="padding-top: 10px;">
            <div class="section-top">
                <div class="container-fluid">
                    <div id="PaymentGrid" style="height: 450px;"></div>
                </div>
            </div>
        </section>
    </div>
  </script>

</th:block>

<th:block layout:fragment="scripts">
  <!--<th:block th:replace="/common/columns_setting :: columns_setting"></th:block>-->
  <th:block th:replace="/common/multiform_material :: multiform_material"></th:block>
  <th:block th:replace="/common/popup_company :: popup_company"></th:block>
  <script type="text/javascript">
    class MonthlyPurchaseListPage {
      constructor() {
        this.grid = null;
        this.grid3 = null;
        this.grid4 = null;
        this.$btnEdit = $('#btnEdit');
        this.$btnAddNew = $('#btnAddNew');
        this.spjangcd = $('#spjangcdHidden');
        this.viewData = new wijmo.collections.CollectionView();
        this.init();
      }

      init() {
        let _this = this;
        const monthColumns = Array.from({length: 12}, (_, i) => {
          const month = i + 1;
          return {
            binding: `mon_${month}`,
            header: `${month}ì›”`,
            width: 120,
            align: 'right',
            allowSorting: false,
            format: 'n0',
          };
        });

        this.grid = new wijmo.grid.FlexGrid('#theGrid', {
          frozenColumns: 4,
          frozenRows: 0,
          allowSorting: wijmo.grid.AllowSorting.MultiColumn,
          selectionMode: wijmo.grid.SelectionMode.Row,
          allowMerging: wijmo.grid.AllowMerging.Cells,
          autoGenerateColumns: false,
          showMarquee: true,
          isReadOnly: true,
          formatItem: (sender, e) => {
            if (e.panel.cellType === wijmo.grid.CellType.ColumnHeader) {
              e.cell.style.textAlign = 'center';
            }
          },
          columns: [
            {binding: 'comp_name', header: 'ê±°ë˜ì²˜ëª…', width: 250, align: 'center', allowMerging: false},
            {binding: 'misgubun', header: 'ë§¤ì¶œêµ¬ë¶„', width: 90, align: 'center', allowMerging: false},
            {binding: 'depart_id', header: 'ë¶€ì„œ ì½”ë“œ', width: 90, align: 'center', visible: false},
            {binding: 'dp_name', header: 'ë¶€ì„œ', width: 90, align: 'center', allowMerging: false},
            {binding: 'account_manager', header: 'ë‹´ë‹¹ì', width: 100, align: 'center', allowSorting: false},
            ...monthColumns,  //ì—¬ê¸°ì—ì„œ ì›”ë³„ ì»¬ëŸ¼ì„ ì‚½ì…
            {binding: 'total_sum', header: 'í•©ê³„', width: 120, align: 'right', allowSorting: false},
          ],
          itemsSource: this.viewData,
        });
        this.grid.rowHeaders.columns.splice(0, 1);
        this.grid.hostElement.addEventListener('dblclick', (e) => {
          const ht = this.grid.hitTest(e);
          if (ht.cellType === wijmo.grid.CellType.Cell) {
            const row = this.grid.rows[ht.row];
            const data = row.dataItem;
            this.openPurchaseDetailPopup(data);
          }
        });
        new FlexGridContextMenu(this.grid);
        this.grid.downloadFileName = 'ì›”ë³„ ë§¤ì… í˜„í™©(ë§¤ì…)';
        //Footer íŒ¨ë„ ì‚¬ìš© ì„¤ì •
        this.grid.columnFooters.rows.push(new wijmo.grid.Row());

        //Footer í•©ê³„ ê°’ ì„¤ì • (ìˆ˜ë™)
        this.grid.loadedRows.addHandler(() => {
          const rows = this.grid.rows;
          const footerTotal = this.grid.columnFooters.rows[0];
          const getSum = (field) => rows.map(r => +r.dataItem[field] || 0).reduce((a, b) => a + b, 0);
          // footerì— ë“¤ì–´ê°ˆ ë°ì´í„° êµ¬ì„±
          const footerData = {
            comp_name: 'í•© ê³„', // ì²« ì»¬ëŸ¼ì— í…ìŠ¤íŠ¸
          };
          monthColumns.forEach(col => {
            footerData[col.binding] = getSum(col.binding);
          });
          footerData['total_sum'] = getSum('total_sum');
          footerTotal.dataItem = footerData;
        });

        this.grid3 = new wijmo.grid.FlexGrid('#payment-grid', {
          frozenColumns: 1,
          frozenRows: 0,
          allowSorting: wijmo.grid.AllowSorting.MultiColumn,
          selectionMode: wijmo.grid.SelectionMode.Row,
          allowMerging: wijmo.grid.AllowMerging.Cells,
          autoGenerateColumns: false,
          showMarquee: true,
          isReadOnly: true,
          formatItem: (sender, e) => {
            if (e.panel.cellType === wijmo.grid.CellType.ColumnHeader) {
              e.cell.style.textAlign = 'center';
            }
          },
          columns: [
            {binding: 'cltcd', header: 'ì»¤ë˜ì²˜ ì½”ë“œ', width: 250, visible: false},
            {binding: 'comp_name', header: 'ê±°ë˜ì²˜ëª…', width: 250, align: 'center', allowMerging: false},
            ...monthColumns,
            {binding: 'total_sum', header: 'í•©ê³„', width: 120, align: 'right', allowSorting: false},
          ],
          itemsSource: this.viewData,
        });


        this.grid3.rowHeaders.columns.splice(0, 1);
        this.grid3.hostElement.addEventListener('dblclick', (e) => {
          const ht = this.grid3.hitTest(e); //ì˜¬ë°”ë¥´ê²Œ grid3ì—ì„œ hitTest
          if (ht.cellType === wijmo.grid.CellType.Cell) {
            const row = this.grid3.rows[ht.row];
            const data = row.dataItem;
            this.openPaymentPopup(data);  //ì…ê¸ˆ ìƒì„¸ íŒì—… í•¨ìˆ˜ ì‹¤í–‰
          }
        });
        new FlexGridContextMenu(this.grid3);
        this.grid3.downloadFileName = 'ì›”ë³„ ë§¤ì… í˜„í™©(ì§€ê¸‰)';
        //Footer íŒ¨ë„ ì‚¬ìš© ì„¤ì •
        this.grid3.columnFooters.rows.push(new wijmo.grid.Row());
        // âœ… Footer í•©ê³„ ì„¤ì •
        this.grid3.loadedRows.addHandler(() => {
          const rows = this.grid3.rows;
          const footerTotal = this.grid3.columnFooters.rows[0];
          const getSum = (field) => rows.map(r => +r.dataItem[field] || 0).reduce((a, b) => a + b, 0);

          const footerData = {
            comp_name: 'í•© ê³„',
          };
          monthColumns.forEach(col => {
            footerData[col.binding] = getSum(col.binding);
          });
          footerData['total_sum'] = getSum('total_sum');
          footerTotal.dataItem = footerData;
        });

        this.grid4 = new wijmo.grid.FlexGrid('#accounts_payable-grid', {
          frozenColumns: 4,
          frozenRows: 0,
          allowSorting: wijmo.grid.AllowSorting.MultiColumn,
          selectionMode: wijmo.grid.SelectionMode.Row,
          allowMerging: wijmo.grid.AllowMerging.Cells,
          autoGenerateColumns: false,
          showMarquee: true,
          isReadOnly: true,
          formatItem: (sender, e) => {
            if (e.panel.cellType === wijmo.grid.CellType.ColumnHeader) {
              e.cell.style.textAlign = 'center';
            }
          },
          columns: [
            {binding: 'comp_name', header: 'ê±°ë˜ì²˜ëª…', width: 170, align: 'center', allowMerging: true},
            {binding: 'amount', header: 'ì „ì”ì•¡', width: 110, align: 'right'},
            /* { binding: 'misgubun', header: 'ë§¤ì¶œêµ¬ë¶„', width: 100, align: 'center', allowMerging: true },
             { binding: 'icerdeptnm', header: 'ë¶€ì„œ', width: 130, align: 'center', allowMerging: true },
             { binding: 'icerceonm', header: 'ë‹´ë‹¹ì', width: 100, align: 'center', allowSorting: false },*/
            ...monthColumns,
          ],
          itemsSource: this.viewData,
        });
        this.grid4.rowHeaders.columns.splice(0, 1);
        new FlexGridContextMenu(this.grid4);
        this.grid4.downloadFileName = 'ì›”ë³„ ë§¤ì… í˜„í™©(ë¯¸ì§€ê¸‰)';
        //Footer íŒ¨ë„ ì‚¬ìš© ì„¤ì •
        this.grid4.columnFooters.rows.push(new wijmo.grid.Row());
        // âœ… Footer í•©ê³„ ì„¤ì •
        this.grid4.loadedRows.addHandler(() => {
          const rows = this.grid4.rows;
          const footerTotal = this.grid4.columnFooters.rows[0];
          const getSum = (field) => rows.map(r => +r.dataItem[field] || 0).reduce((a, b) => a + b, 0);

          const footerData = {
            comp_name: 'í•© ê³„',
          };
          monthColumns.forEach(col => {
            footerData[col.binding] = getSum(col.binding);
          });
          footerData['total_sum'] = getSum('total_sum');
          footerTotal.dataItem = footerData;
        });
      }

      searchMainData() {
        let _this = this;
        let url = '/api/transaction/monthly_purchase_list'
        let data = {
          'cboYear': $("#cboYear").val(),
          'cboCompany': $("#cboCompanyHidden").val(),
          spjangcd: this.spjangcd.val()
        }
        //ë§¤ì… ë‚´ì—­
        AjaxUtil.getAsyncData(url + '/PurchaseDetails', data, function (result) {
          if (result != null) {
            _this.grid.itemsSource = result.data;
          }
        });
        // ì§€ê¸‰ ë‚´ì—­
        AjaxUtil.getAsyncData(url + '/ProvisionRead', data, function (result) {
          if (result != null) {
            _this.grid3.itemsSource = result.data;
          }
        });
        // ë¯¸ì§€ê¸‰ê¸ˆ ë‚´ì—­
        AjaxUtil.getAsyncData(url + '/PaymentRead', data, function (result) {
          if (result != null) {
            _this.grid4.itemsSource = result.data;
          }
        });
      }

      openPurchaseDetailPopup(data) {
        let _this = this;
        const cltcd = data.cltcd;
        const depart_id = data.depart_id;
        const compName = data.comp_name;

        let content = tmpl('PurchaseDetailPopup', {});
        let $content = $(content);

        let modal = new PopupDraggable(`[${compName}] ë§¤ì… ìƒì„¸`);
        modal.open({width: 800, height: 500, $content});

        //ê·¸ë£¹ìš© CollectionView ìƒì„± (ë¹ˆ ìƒíƒœ)
        this.viewData = new wijmo.collections.CollectionView();

        //ê·¸ë£¹í•‘ ê¸°ì¤€ì„ ì›”ë³„ë¡œ ì„¤ì •
        this.viewData.groupDescriptions.push(
          new wijmo.collections.PropertyGroupDescription('misdate', (item, prop) => {
            if (!item[prop]) return '';
            // misdate: "YYYY-MM-DD" í˜•ì‹ ê¸°ì¤€
            const [year, month] = item[prop].split('-');
            return `${year}ë…„ ${month}ì›”`;
          })
        );

        _this.PurchaseGrid = new wijmo.grid.FlexGrid('#PurchaseGrid', {
          selectionMode: wijmo.grid.SelectionMode.Row,
          autoGenerateColumns: false,
          showMarquee: true,
          isReadOnly: true,
          itemsSource: this.viewData,  //ê·¸ë£¹ì´ ì ìš©ëœ viewData ì‚¬ìš©
          formatItem: (sender, e) => {
            if (e.panel.cellType === wijmo.grid.CellType.ColumnHeader) {
              e.cell.style.textAlign = 'center';
            }
            if (e.panel.cellType === wijmo.grid.CellType.Cell) {
              const row = sender.rows[e.row];
              if (row instanceof wijmo.grid.GroupRow) {
                const group = row.dataItem;
                const sumSupply = wijmo.getAggregate(wijmo.Aggregate.Sum, group.items, 'supplycost');
                const sumTax = wijmo.getAggregate(wijmo.Aggregate.Sum, group.items, 'taxtotal');
                const sumTotal = sumSupply + sumTax;  //í•©ê³„ ê³„ì‚°

                e.cell.colSpan = sender.columns.length;
                e.cell.innerHTML = `<b>${group.name}</b> (ê³µê¸‰ê°€ì•¡: ${sumSupply.toLocaleString()}ì› / ì„¸ì•¡: ${sumTax.toLocaleString()}ì› / í•©ê³„: ${sumTotal.toLocaleString()}ì›)`;
                e.cell.style.textAlign = 'left';
                e.cell.style.paddingLeft = '8px';
              }
            }
          },
          columns: [
            {binding: 'misdate', header: 'ì¼ì', width: 120, align: 'center'},
            {binding: 'misgubun', header: 'ë§¤ì¶œêµ¬ë¶„', width: 80, align: 'center'},
            {binding: 'itemnm', header: 'í’ˆëª©', width: '*', align: 'center'},
            {binding: 'spec', header: 'ê·œê²©', width: 70, align: 'center'},
            {binding: 'qty', header: 'ìˆ˜ëŸ‰', width: 70, align: 'center'},
            {binding: 'supplycost', header: 'ê³µê¸‰ê°€ì•¡', width: '*', align: 'right', format: 'n0'},
            {binding: 'taxtotal', header: 'ì„¸ì•¡', width: '*', align: 'right', format: 'n0'},
            {binding: 'totalamt', header: 'í•©ê³„', width: '*', align: 'right', format: 'n0'},
          ]
        });

        _this.PurchaseGrid.rowHeaders.columns.splice(0, 1);
        new FlexGridContextMenu(_this.PurchaseGrid);
        _this.PurchaseGrid.downloadFileName = `[${compName}] ë§¤ì¶œ ìƒì„¸`;

        // Footer ì„¤ì •
        _this.PurchaseGrid.columnFooters.rows.push(new wijmo.grid.Row());
        _this.PurchaseGrid.loadedRows.addHandler(() => {
          const rows = _this.PurchaseGrid.rows;
          const footer = _this.PurchaseGrid.columnFooters.rows[0];
          const getSum = (field) => rows
            .filter(r => r.dataItem && !(r instanceof wijmo.grid.GroupRow))
            .map(r => +r.dataItem[field] || 0)
            .reduce((a, b) => a + b, 0);

          footer.dataItem = {
            misdate: 'í•©ê³„',
            supplycost: getSum('supplycost'),
            taxtotal: getSum('taxtotal'),
            totalamt: getSum('totalamt'),
          };
        });

        // ë°ì´í„° ë¡œë”©
        $.ajax({
          url: '/api/transaction/monthly_purchase_list/PurchaseDetail',
          method: 'GET',
          data: {
            cltcd: cltcd,
            depart_id: depart_id,
            cboYear: $("#cboYear").val(),
            spjangcd: this.spjangcd.val()
          },
          dataType: 'json',
          success: function (response) {
            if (response && Array.isArray(response.data)) {
              const processedData = response.data.map(item => ({
                ...item,
                totalamt: (+item.supplycost || 0) + (+item.taxtotal || 0)
              }));
              _this.viewData.sourceCollection = processedData;
            } else {
              Alert.alert('', 'ë°ì´í„° í˜•ì‹ì´ ì˜ëª»ë˜ì—ˆìŠµë‹ˆë‹¤.');
              _this.viewData.sourceCollection = [];
            }
          },
          error: function () {
            alert('ë§¤ì¶œ ìƒì„¸ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
          }
        });
      }

      openPaymentPopup(data) {
        let _this = this;
        const cltcd = data.cltcd;
        const compName = data.comp_name;

        // í…œí”Œë¦¿ ì‚½ì…
        let content = tmpl('popup_Payment', {});
        let $content = $(content);

        // íŒì—… ì»¨í…Œì´ë„ˆ ìƒì„± (ì¡°íšŒ ì „ìš©)
        let modal = new PopupDraggable(`[${compName}] ì§€ê¸‰ ìƒì„¸`);
        modal.open({width: 800, height: 500, $content});

        // ê·¸ë¦¬ë“œ ì´ˆê¸°í™”
        _this.PaymentGrid = new wijmo.grid.FlexGrid('#PaymentGrid', {
          selectionMode: wijmo.grid.SelectionMode.Row,
          autoGenerateColumns: false,
          showMarquee: true,
          isReadOnly: true,
          columns: [
            {binding: 'trdate', header: 'ì¼ì', width: 120, align: 'left'},
            {binding: 'ioid', header: 'ì½”ë“œ', width: 100, align: 'right', visible: false},
            {binding: 'CompanyName', header: 'ê±°ë˜ì²˜ëª…', width: 140, align: 'center'},
            {binding: 'accout', header: 'ê¸ˆì•¡', width: 100, align: 'right'},
            {binding: 'deposit_type', header: 'ì…ê¸‰í˜•íƒœ', width: 80, align: 'center'},
            {binding: 'banknm', header: 'ì€í–‰', width: 80, align: 'center'},
            {binding: 'accnum', header: 'ê³„ì¢Œ', width: 140, align: 'center'},
            {binding: 'memo', header: 'ë©”ëª¨', width: 150}
          ],
          itemsSource: []  // ì´ˆê¸°ì—ëŠ” ë¹„ì›€
        });

        //íŒì—… ê·¸ë¦¬ë“œì— ì ìš©í•´ì•¼ í•˜ëŠ” ë¡œì§ë“¤ì€ ëª¨ë‘ PaymentGridë¡œ ì ìš©
        _this.PaymentGrid.rowHeaders.columns.splice(0, 1);
        new FlexGridContextMenu(_this.PaymentGrid);
        _this.PaymentGrid.downloadFileName = `[${compName}] ì§€ê¸‰ ìƒì„¸`;
        _this.PaymentGrid.downloadFileName = 'ì§€ê¸‰ ìƒì„¸ë‚´ì—­';
        _this.PaymentGrid.columnFooters.rows.push(new wijmo.grid.Row());
        _this.PaymentGrid.loadedRows.addHandler(() => {
          const rows = _this.PaymentGrid.rows;
          const footer = _this.PaymentGrid.columnFooters.rows[0];
          const getSum = (field) => rows.map(r => +r.dataItem[field] || 0).reduce((a, b) => a + b, 0);

          footer.dataItem = {
            trdate: 'í•©ê³„',
            accout: getSum('accout'),
          };
        });
        _this.PaymentGrid.formatItem.addHandler(function (s, e) {
          if (e.panel.cellType === wijmo.grid.CellType.Cell) {
            const row = s.rows[e.row];
            if (row instanceof wijmo.grid.GroupRow) {
              const group = row.dataItem;
              const sumAmount = wijmo.getAggregate(wijmo.Aggregate.Sum, group.items, 'accout');

              e.cell.colSpan = s.columns.length;
              e.cell.innerHTML = `<b>${group.name}</b> (í•©ê³„: ${sumAmount.toLocaleString()}ì›)`;
              e.cell.style.textAlign = 'left';
              e.cell.style.paddingLeft = '8px';
            }
          }
        });
        // ë°ì´í„° ë¡œë”©
        $.ajax({
          url: '/api/transaction/monthly_purchase_list/PaymentDetail',
          method: 'GET',
          data: {
            cltcd: cltcd,
            cboYear: $("#cboYear").val(),
            spjangcd: this.spjangcd.val()
          },
          dataType: 'json',
          success: function (response) {
            if (response && Array.isArray(response.data)) {
              // ê·¸ë£¹í™” ì²˜ë¦¬ë¥¼ ìœ„í•œ CollectionView ìƒì„±
              const view = new wijmo.collections.CollectionView(response.data);
              view.groupDescriptions.push(new wijmo.collections.PropertyGroupDescription(null, function (item) {
                const date = new Date(item.trdate);
                const year = date.getFullYear();
                const month = date.getMonth() + 1;
                return `${year}ë…„ ${month}ì›”`;
              }));
              _this.PaymentGrid.itemsSource = view;
            } else {
              Alert.alert('', 'ë°ì´í„° í˜•ì‹ì´ ì˜ëª»ë˜ì—ˆìŠµë‹ˆë‹¤.');
              _this.PaymentGrid.itemsSource = [];
            }
          },
          error: function () {
            alert('ë§¤ì¶œ ìƒì„¸ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
          }
        });
      }
    }

    let page = null;

    $(document).ready(function (e) {
      const spjangcd = sessionStorage.getItem('spjangcd');
      if (spjangcd) {
        $('#spjangcdHidden').val(spjangcd);  // hidden inputì´ ìˆì–´ì•¼ í•¨
      }
      page = new MonthlyPurchaseListPage();

      AjaxUtil.fillSelectOptions($('#cboCompany'), 'company', 'all', '', 'sale');
      AjaxUtil.fillSelectOptions($('#cboYear'), 'data_year', '', false);

      $('#srchStartDt').val(CommonUtil.getYYYYMMDD(-7));
      $('#srchEndDt').val(CommonUtil.getYYYYMMDD());

      page.searchMainData();

      // ê²€ìƒ‰
      $('#btnSearch').click(function (e) {
        if ($('#cboCompany').val() !== '' && $('#cboCompanyHidden').val() === '') {
          // ì—…ì²´ëª… í…ìŠ¤íŠ¸ëŠ” ì¼ì§€ë§Œ, ì—…ì²´ ê²€ìƒ‰ ë²„íŠ¼ ì•ˆ ëˆŒë €ì„ ë•Œ
          page.searchMainData();
        } else {
          page.searchMainData();
        }
      });

      $('#btnCompanySearch').click(function () {
        let poppage = new PopCompComponent();
        let $poppage = $(poppage);
        let searchcallback = function (items) {
          //console.log('items : ',items);
          document.getElementById('btnCompanySearch').value = items.compname;
          document.getElementById('cboCompanyHidden').value = items.id;
        };

        poppage.show(searchcallback);
      });

      $('#btnCompanySearch').on('input', function () {
        const val = $(this).val();
        if (val === '') {
          $('#cboCompanyHidden').val('');
        }
      });
      // .btn-clear í´ë¦­ í›„ input ì´ë²¤íŠ¸ ê°•ì œ ë°œìƒ
      $(document).on('click', '.btn-clear', function () {
        const $input = $(this).siblings('input[type="text"]');
        $input.val('');
        $input.trigger('input'); // ğŸ”¥ input ì´ë²¤íŠ¸ ê°•ì œ ë°œìƒ
      });
      // ì´ˆê¸°í™” ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸
      $('#btnClear').click(function () {

        document.getElementById('cboCompany').value = '';
        document.getElementById('cboCompanyHidden').value = '';
      });

    })
  </script>

</th:block>

<input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
</html>
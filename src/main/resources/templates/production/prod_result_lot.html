<html layout:decorate="~{layout_page}">

<head>
    <style>
        .background-white {
            background: #ffffff
        }

        .background-blue {
            background-color: #dcf0f8 !important;
            font-weight: bold !important;
            text-align: right !important;
        }

        .background-order {
            background-color: #00ff21 !important;
            font-weight: bold !important;
            text-align: right !important;
        }

        .background-defect {
            background-color: #f8d2cb !important;
            font-weight: bold !important;
            text-align: right !important;
        }

        .background-loss {
            background: #ffd800;
            font-weight: bold;
            text-align: right
        }

        .background-scrap {
            background: #c28fbb;
            font-weight: bold;
            text-align: right;
        }

        .working-status {
            background: #00ff21 !important;
            font-weight: bold !important;
        }

        .finished-status {
            background: #0026ff !important;
            color: #ffffff !important;
        }

        .work-table td {
            text-align: left;
        }

        .work-table td input[type="text"], input[type="number"], input[type="date"], input[type="time"] {
            width: 160px;
        }

        .work-table td input[type="text"]:disabled, input[type="number"]:disabled, input[type="date"]:disabled, input[type="time"]:disabled, textarea:disabled {
            width: 160px;
            background-color: #EDEFF5 !important;
        }

        .work-table textarea:disabled {
            width: 100%;
            background-color: #EDEFF5 !important;
        }

        .work-table select, select:disabled {
            width: 160px;
        }

        .work-table select:disabled {
            width: 160px;
            background-color: #EDEFF5 !important;
        }

    </style>


</head>
<th:block layout:fragment="content">
    <div class="layout-contents">

        <div class="page-title-wrap">
            <div class="left">
                <h2>ÏÉùÏÇ∞ Ïã§Ï†Å ÏûÖÎ†• A3(Ï∞®ÏàòÏ∂îÍ∞Ä)</h2>
                <small2>ÎùºÏö∞ÌåÖÏù¥ ÏóÜÎäî ÌíàÎ™©Ïóê ÎåÄÌïú Ïã§Ï†Å ÏûÖÎ†•. Î°úÌä∏Ìà¨ÏûÖ Í∞ÄÎä•</small2>
                <a title="Î∂ÅÎßàÌÅ¨" class="bookmark toggle">
                    ÎÇ¥ Î©îÎâ¥
                </a>
            </div>
            <ul class="page-navi">
                <li><img src="/images/icon/ico-nav-home.svg" alt="ÌôàÏïÑÏù¥ÏΩò"></li>
                <li>ÏÉùÏÇ∞ Í¥ÄÎ¶¨</li>
                <li>ÏÉùÏÇ∞ Ïã§Ï†Å ÏûÖÎ†•</li>
            </ul>
        </div>

        <section class="section">

            <div class="section-top">
                <div class="search-wrap">
                    <dl>
                        <dt>
                            ÏÉùÏÇ∞Ïùº<span class="eq">*</span>
                        </dt>
                        <dd>
                            <ul class="date-box">
                                <li>
                                    <input type="date" id="date_from" name="date_from">
                                    <label for="date_from" class="hide">ÏãúÏûëÏùº</label>
                                </li>
                                <li>
                                    <input type="date" id="date_to" name="date_to">
                                    <label for="date_to" class="hide">Ï¢ÖÎ£åÏùº</label>
                                </li>
                            </ul>
                        </dd>
                    </dl>

                    <dl>
                        <dt>
                            <label for="cboMaterialType">
                                ÌíàÎ™© Íµ¨Î∂Ñ<span class="eq"></span>
                            </label>
                        </dt>
                        <dd>
                            <div class="srch-box">
                                <select id="cboMaterialType" name="cboMaterialType">
                                </select>
                            </div>
                        </dd>
                    </dl>
                    <dl>
                        <dt>
                            <label for="cboShift">
                                Í∑ºÎ¨¥Ï°∞<span class="eq"></span>
                            </label>
                        </dt>
                        <dd>
                            <div class="srch-box">
                                <select id="cboShift" name="cboShift">
                                </select>
                            </div>
                        </dd>
                    </dl>
                    <dl>
                        <dt>
                            <label for="cboWorkCenter">
                                ÏõåÌÅ¨ÏÑºÌÑ∞<span class="eq"></span>
                            </label>
                        </dt>
                        <dd>
                            <div class="srch-box">
                                <select id="cboWorkCenter" name="cboWorkCenter">
                                </select>
                            </div>
                        </dd>
                    </dl>

                    <dl>
                        <dt>
                            <label for="chxCompYn">

                            </label>
                        </dt>
                        <dd>
                            <div class="srch-box">
                                <input type="checkbox" id="chxCompYn" name="chxCompYn" checked/>
                                ÏôÑÎ£å Ìè¨Ìï®
                            </div>
                        </dd>
                    </dl>

                    <dl>
                        <dt>&nbsp;</dt>
                        <dd>
                            <li>
                                <a class="btn btn-search" title="Í≤ÄÏÉâ" id="btnMainSearch">
                                    <!--                                        class Ïì∞Ïù¥Îäî Í≥≥ Ï∞æÍ≥† ÏóÜÏúºÎ©¥ ÌÅ¥ÎûòÏä§Î™Ö ÏàòÏ†ïÌïòÍ∏∞-->
                                    <img src="/images/icon/btn-srch.svg" alt="Í≤ÄÏÉâ ÏïÑÏù¥ÏΩò">
                                    Í≤ÄÏÉâ
                                </a>
                            </li>
                        </dd>
                    </dl>
                </div>
            </div>
            <div class="grid_box" id="prodResultList">
                <div class="search-wrap">

                    <dl>
                        <dt>
                            ÏûëÏßÄÎ≤àÌò∏
                        </dt>
                        <dd>
                            <ul class="date-box">
                                <li>
                                    <input type="text" id="selected_order_num" name="selected_order_num" readonly>
                                    <label for="selected_order_num" class="hide">ÏÉùÏÇ∞Ïùº</label>
                                </li>
                            </ul>
                        </dd>
                    </dl>
                </div>
                <div id="prod-result-grid" style="height: 300px;"></div>
            </div>
        </section>

        <div class="tab-wrap">

            <ul class="tab-links">
                <li><a href="#tabBasic" name="tabBasic">Í∏∞Î≥∏ Ï†ïÎ≥¥</a></li>
                <li><a href="#tabChasu" name="tabChasu">Ï∞®ÏàòÎ≥Ñ ÏÉùÏÇ∞</a></li>
                <li><a href="#tabDefect" name="tabDefect">Î∂ÄÏ†ÅÌï© Ï†ïÎ≥¥</a></li>
                <li><a href="#tabConsumed" name="tabConsumed">Ìà¨ÏûÖ ÎÇ¥Ïó≠</a></li>
                <li hidden><a href="#tabBarcode" name="tabBarcode">Î∞îÏΩîÎìú</a></li>
            </ul>
            <div>
                <section class="tab-item" id="tabBasic" style="border-top-left-radius: 0;">
                    <div class="section-top">
                        <div class="button-wrap">
                            <ul>
                                <li>
                                    <button class="btn" title="ÏãúÏûë" disabled id="btnWorkStart">
                                        ÏãúÏûë
                                    </button>
                                </li>
                                <li>
                                    <button class="btn" title="Ï†ÄÏû•" disabled id="btnSave">
                                        <i class="fas fa-save"></i>
                                    </button>
                                </li>
                                <li>
                                    <button class="btn" title="ÏÇ≠Ï†ú" disabled id="btnDel">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </li>
                                <li>
                                    <button class="btn" title="ÏôÑÎ£å" disabled id="btnWorkFinish">
                                        ÏôÑÎ£å
                                    </button>
                                </li>
                                <li>
                                    <button class="btn" title="ÏôÑÎ£å Ï∑®ÏÜå" disabled id="btnFinishCancel">
                                        ÏôÑÎ£å Ï∑®ÏÜå
                                    </button>
                                </li>
                                <li>
                                    <button class="btn" title="Ï†úÌíàÍ≤ÄÏÇ¨" disabled id="btnTest">
                                        Ï†úÌíàÍ≤ÄÏÇ¨
                                    </button>
                                </li>
                            </ul>
                        </div>

                        <div class="table-wrap">
                            <form id="basicForm">
                                <table class="work-table">
                                    <caption>ÏûëÏóÖ ÏßÄÏãú ÌÖåÏù¥Î∏î</caption>
                                    <colgroup>
                                        <col style="width: 10%;">
                                        <col style="width: 15%;">
                                        <col style="width: 10%;">
                                        <col style="width: 15%;">
                                        <col style="width: 10%;">
                                        <col style="width: 15%;">
                                        <col style="width: 10%;">
                                        <col style="width: 15%;">
                                    </colgroup>
                                    <input type="hidden" id="id" name="id"/>
                                    <input type="hidden" id="mp_id" name="mp_id"/>
                                    <input type="hidden" id="mat_pk" name="mat_pk"/>
                                    <input type="hidden" id="state" name="state"/>
                                    <tbody>
                                    <tr>
                                        <th><label for="order_num">ÏûëÏßÄÎ≤àÌò∏</label></th>
                                        <td><input type="text" id="order_num" name="order_num" readonly/></td>
                                        <th><label for="mat_code">Ï†úÌíàÏΩîÎìú</label></th>
                                        <td><input type="text" id="mat_code" name="mat_code" readonly/></td>
                                        <th><label for="mat_name">Ï†úÌíà</label></th>
                                        <td><input type="text" id="mat_name" name="mat_name" readonly/></td>
                                        <th><label for="unit">Îã®ÏúÑ</label></th>
                                        <td><input type="text" id="unit" name="unit" readonly/></td>
                                    </tr>
                                    <tr>
                                        <th><label for="job_state">ÏÉÅÌÉú</label></th>
                                        <td><input type="text" id="job_state" name="job_state" readonly/></td>
                                        <th><label for="workcenter_id">ÏõåÌÅ¨ÏÑºÌÑ∞</label></th>
                                        <td><select id="workcenter_id" name="workcenter_id" disabled></select></td>
                                        <th><label for="equipment_id">ÏÑ§ÎπÑ</label></th>
                                        <td><select id="equipment_id" name="equipment_id" disabled></select></td>
                                        <th><label for="shift_code">Í∑ºÎ¨¥Ï°∞</label></th>
                                        <td><select id="shift_code" name="shift_code" disabled></select></td>
                                    </tr>
                                    <tr>
                                        <th><label for="prod_date">ÏÉùÏÇ∞ÏãúÍ∞Ñ</label></th>
                                        <td colspan="7">
                                            <div class="input-group" id="prod_datepicker">
                                                <input type="date" id="prod_date" name="prod_date"/>
                                                <input type="time" id="start_time" name="start_time" disabled/>
                                                <span class="slow_sign">~</span>
                                                <input type="date" id="end_date" name="end_date"/>
                                                <input type="time" id="end_time" name="end_time" disabled/>
                                            </div>
                                        </td>
                                    </tr>
                                    <tr>
                                        <th><label for="order_qty">ÏßÄÏãúÎüâ</label></th>
                                        <td><input type="number" id="order_qty" name="order_qty"
                                                   class="background-order" readonly/></td>
                                        <th><label for="good_qty">ÏñëÌíàÎüâ</label></th>
                                        <td><input type="number" id="good_qty" name="good_qty" class="background-blue"
                                                   readonly disabled/></td>
                                        <th><label for="defect_qty">Î∂ÄÏ†ÅÌï©Îüâ</label></th>
                                        <td colspan="3"><input type="number" id="defect_qty" name="defect_qty"
                                                               class="background-defect" value="0" readonly/></td>
                                    </tr>
                                    <tr>
                                        <th><label for="description">ÎπÑÍ≥†</label></th>
                                        <td colspan="7"><textarea id="description" name="description"
                                                                  disabled></textarea></td>
                                    </tr>
                                    </tbody>
                                </table>
                            </form>
                        </div>

                    </div>
                </section>
                <section class="tab-item" id="tabChasu" style="border-top-left-radius: 0;">
                    <div class="tab_con_box ">
                        <div class="grid_box">
                            <div class="button-wrap">
                                <ul>
                                    <li>
                                        ÏßÄÏãúÎüâ : <label id="ordqty">0</label>, LOT size :
                                        <input type="number" class="w-80" id="chasuLotSize" name="chasuLotSize"
                                               value="0"
                                               min="0">
                                    </li>
                                    <li>
                                        <button type="button" class="btn" id="btnAddChasu" title="Ï∞®Ïàò Ï∂îÍ∞Ä" disabled><i
                                                class="fas fa-plus"></i></button>
                                    </li>
                                    <li>
                                        <button type="button" class="btn" id="btnSaveChasu" title="ÏÉùÏÇ∞ÏàòÎüâÏàòÏ†ï" disabled>
                                            <i class="fas fa-save"></i></button>
                                    </li>
                                    <li>
                                        <button type="button" class="btn" id="btnDeleteChasu" title="ÎßàÏßÄÎßâ Ï∞®Ïàò ÏÇ≠Ï†ú"
                                                disabled><i class="fas fa-trash"></i></button>
                                    </li>
                                    <li>
                                        <button type="button" class="btn" id="btnLOTbarcode" data-labelCd="LOTÎ∞îÏΩîÎìú"
                                                disabled>LOTÎ∞îÏΩîÎìú
                                        </button>
                                    </li>
                                </ul>
                            </div>
                            <div id="chasu-grid" style="height: 220px;"></div>
                        </div>
                    </div>
                </section>

                <section class="tab-item" id="tabDefect" style="border-top-left-radius: 0;">
                    <div class="tab_con_box">
                        <div class="grid_box">
                            <div class="button-wrap">
                                <ul>
                                    <li>
                                        <button type="button" class="btn" id="btnDefectSave" title="Î∂ÄÏ†ÅÌï©ÎÇ¥Ïó≠ Ï†ÄÏû•" disabled>
                                            <i
                                                    class="fas fa-save"></i></button>
                                    </li>
                                </ul>
                            </div>
                            <div id="defect-grid" style="height: 220px;"></div>
                        </div>
                    </div>
                </section>
                <section class="tab-item" id="tabConsumed" style="border-top-left-radius: 0;">
                    <div class="tab_con_box">
                        <div>
                            <label class="switch">
                                <input type="checkbox" id="btnToggle"><span class="slider round"></span>
                            </label>Ìà¨ÏûÖÎ°úÌä∏ Î≥¥Í∏∞/Í∞êÏ∂îÍ∏∞
                        </div>
                        <div>&nbsp;</div>
                        <div class="grid_box" id="input_lot_div">
                            <div class="button-wrap">
                                <ul>
                                    <li>
                                        <button type="button" class="btn" id="btnInputLotList" title="Ï°∞Ìöå"><i
                                                class="fas fa-search"></i></button>
                                    </li>
                                    <li>
                                        <button type="button" class="btn" id="btnInputLotSelect" title="Î°úÌä∏Í≤ÄÏÉâ"><i
                                                class="fas fa-plus"></i></button>
                                    </li>
                                    <li>
                                        <button type="button" class="btn" id="btnLotSelectDel" title="Î°úÌä∏ÏÇ≠Ï†ú"><i
                                                class="fas fa-trash"></i></button>
                                    </li>
                                    <li>
                                        Î°úÌä∏Î≤àÌò∏ <input type="text" id="txtInputLot" class="w-200 tac"
                                                    placeholder="Î°úÌä∏Î≤àÌò∏Î•º Ïä§Ï∫îÌïòÏÑ∏Ïöî"
                                                    autocomplete="off" style="height: 36px;"/>
                                    </li>
                                    <li>
                                        <button type="button" class="btn" id="btnInputLotGridSetting" title="Î°úÌä∏Ìà¨ÏûÖ Ï†ÄÏû•"><i
                                                class="fas fa-edit"></i></button>
                                    </li>
                                </ul>
                            </div>
                            <div id="input-lot-grid" style="height: 220px;"></div>
                        </div>

                        <div class="grid_box">
                            <div class="title_box">
                                Ìà¨ÏûÖ ÎÇ¥Ïó≠
                            </div>
                            <div id="consumed-grid" style="height: 200px;"></div>
                        </div>
                    </div>
                </section>
                <section class="tab-item" id="tabBarcode">

                    <div class="table_box sub">
                        <div class="row">

                            <div class="col-6">
                                <div class="title_box">
                                    <div class="left_align">
                                        ÏûëÏóÖÏßÄÏãúÎ≤àÌò∏
                                        <button type="button" class="btn-cancel" id="btnPrintWorkOrderBarcode"
                                                data-labelCd="ÌîÑÎ¶∞Ìä∏">ÌîÑÎ¶∞Ìä∏
                                        </button>
                                    </div>
                                </div>
                                <div class="col-12" id="workOrderContainerDiv"></div>
                            </div>

                            <div class="col-6">
                                <div class="title_box">
                                    <div class="left_align">
                                        Lot number
                                        <button type="button" class="btn-cancel" id="btnPrintLotNumberBarcode"
                                                data-labelCd="ÌîÑÎ¶∞Ìä∏">ÌîÑÎ¶∞Ìä∏
                                        </button>
                                    </div>
                                </div>
                                <div class="col-12" id="LotNumberContainerDiv">
                                </div>
                            </div>

                        </div>
                    </div>
                </section>
            </div>

        </div>
    </div>

    <th:block th:replace="/common/popup_consu_material :: materialSearchTemplate"></th:block>
    <th:block th:replace="/common/popup_consu_mat_lot :: matLotSearchTemplate"></th:block>
    <th:block th:replace="/common/popup_lot_input :: LotInputTemplate"></th:block>

    <script type="text/x-tmpl" id="workorder_table_tmpl">
        <table class="table_1" style="width: 400px;border-collapse: collapse;">
            <tr>
                <td class="tac">ÌíàÎ™©ÏΩîÎìú</td>
                <td>{%=o.mat_code%}</td>
                <td class="tac">ÏõåÌÅ¨ÏÑºÌÑ∞</td>
                <td>{%=o.workcenter_name%}</td>
            </tr>
            <tr>
                <td class="tac">ÏÉùÏÇ∞ÌíàÎ™Ö</td>
                <td colspan="3">{%=o.mat_name%}</td>
            </tr>
            <tr>
                <td class="tac">ÏñëÌíàÏàòÎüâ</td>
                <td>{%=o.good_qty%}</td>
                <td class="tac">ÏÉùÏÇ∞Îã®ÏúÑ</td>
                <td>{%=o.unit%}</td>
            </tr>

            <tr>
                <td class="tac">ÏÉùÏÇ∞ÏùºÏûê</td>
                <td colspan="3">{%=o.prod_date%} {%=o.end_time%}</td>
            </tr>
            <tr>
                <td class="tac">Ïú†Ìö®Í∏∞Ìïú</td>
                <td colspan="3">{%=o.ValidDays%}</td>
            </tr>
            <tr>
                <td colspan="4" class="barcode_td">
                    <svg id='svgBarcodeWorkOrderNumber'></svg>
                </td>
            </tr>
        </table>

    </script>
    <script type="text/x-tmpl" id="lotnumber_table_tmpl">
        <table class="table_1" style="width: 400px;border-collapse: collapse;">
            <tr>
                <td class="tac">ÌíàÎ™©ÏΩîÎìú</td>
                <td>{%=o.mat_code%}</td>
                <td class="tac">ÏõåÌÅ¨ÏÑºÌÑ∞</td>
                <td>{%=o.workcenter_name%}</td>
            </tr>
            <tr>
                <td class="tac">ÏÉùÏÇ∞ÌíàÎ™Ö</td>
                <td colspan="3">{%=o.mat_name%}</td>
            </tr>
            <tr>
                <td class="tac">ÏñëÌíàÏàòÎüâ</td>
                <td>{%=o.good_qty%}</td>
                <td class="tac">ÏÉùÏÇ∞Îã®ÏúÑ</td>
                <td>{%=o.unit%}</td>
            </tr>

            <tr>
                <td class="tac">ÏÉùÏÇ∞ÏùºÏûê</td>
                <td colspan="3">{%=o.prod_date%} {%=o.end_time%}</td>
            </tr>
            <tr>
                <td class="tac">Ïú†Ìö®Í∏∞Ìïú</td>
                <td colspan="3">{%=o.ValidDays%}</td>
            </tr>
            <tr>
                <td colspan="4" class="barcode_td">
                    <svg id='svgBarcodeLotNumber'></svg>
                </td>
            </tr>
        </table>

    </script>

    <script type="text/x-tmpl" id="inputTestPopup">
        <div class="content_wrap popup">
            <div class="table-wrap">
                <form id="inputTestForm">
                    <table class="write-table" style="border-top: 1px solid #D4D5D7">
                        <tbody>
                            <tr>
                                <th style="text-align: center">
                                    <label for="cboTestMaster">Í≤ÄÏÇ¨Ïú†Ìòï</label>
                                </th>
                                <td colspan="3">
                                    <select class="form-control2 tac" id="cboTestMaster" name="cboTestMaster" ></select>
                                    <input type="hidden" id="testResultId" name="testResultId">
                                </td>
                            </tr>
                            <tr>
                                <th style="text-align: center">
                                    <label for="MaterialTypeName">ÌíàÎ™©Ïú†Ìòï</label>
                                </th>
                                <td>
                                    <input type="text" class="form-control2" id="MaterialTypeName" name="MaterialTypeName" readonly />
                                </td>
                                <th style="text-align: center">
                                    <label for="MaterialCode">ÌíàÎ™©ÏΩîÎìú</label>
                                </th>
                                <td>
                                    <input type="text" class="form-control2" id="MaterialCode" name="MaterialCode" readonly />
                                </td>
                            </tr>
                            <tr>
                                <th style="text-align: center">
                                    <label for="MaterialName">ÌíàÎ™©Î™Ö</label>
                                </th>
                                <td>
                                    <input type="text" class="form-control2" id="MaterialName" name="MaterialName" readonly />
                                </td>
                                <th style="text-align: center">
                                    <label for="OrderNum">ÏûëÏóÖÏßÄÏãúÎ≤àÌò∏</label>
                                </th>
                                <td>
                                    <input class="form-control2" id="OrderNum" name="OrderNum" readonly />
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </form>
            </div>
            <div class="table-wrap" style="margin-top:5px;">
                <table class="write-table">
                    <tbody>
                        <tr>
                            <th style="text-align: center">
                                <label for="TestDate">Í≤ÄÏÇ¨Ïùº</label>
                            </th>
                            <td>
                                <input style="width:200px" type="date" id="TestDate" name="testDate" />
                            </td>
                            <th style="text-align: center">
                                <label for="TestName">Í≤ÄÏÇ¨Ïûê</label>
                            </th>
                            <td>
                                <input style="width:160px" class="form-control2" id="TestName" name="testName" readonly />
                                <a class="btn" title="Ï†ÑÏ≤¥Ï†ÅÌï©" id="btnAllItem">
                                    Ï†ÑÏ≤¥Ï†ÅÌï©
                                </a>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
            <div class="container-fluid" style="margin-top:5px;">
                <div id="prod_test_grid" style="height: 200px;"></div>
            </div>

            <div class="table-wrap" style="margin-top:5px;">
                <table class="write-table">
                    <tbody>
                        <tr>
                            <th style="text-align: center">
                                <label for="judgGroup">Ï¢ÖÌï© ÌåêÏ†ï</label>
                            </th>
                            <td colspan="3">
                                <select class="form-control2" id="judgGroup" name="judgGroup"  ></select>
                            </td>
                        </tr>
                        <tr>
                            <th style="text-align: center">
                                <label for="ctRemark">Í≤ÄÏ≤¥Ïùò Ï±ÑÏ∑®Î∞©Î≤ï</label>
                            </th>
                            <td colspan="3">
                                <textarea style="height:36px" id="ctRemark" name="ctRemark"></textarea>
                            </td>
                        </tr>
                        <tr>
                            <th style="text-align: center">
                                <label for="ntRemark">Í≤ÄÏÇ¨Í≤∞Í≥ºÏùò ÌÜµÏßÄÎ∞©Î≤ï</label>
                            </th>
                            <td colspan="3">
                                <textarea style="height:36px" id="ntRemark" name="ntRemark"></textarea>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <div class="popup-button">
                <button type="button" class="btn-popup" id="btnTestSave" ><span data-labelCd="Ï†ÄÏû•">Ï†ÄÏû•</span></button>
                <button type="button" class="btn-popup" id="modal-close-button"><span data-labelCd="Îã´Í∏∞">Îã´Í∏∞</span></button>
            </div>
        </div>
    </script>

    <script type="text/x-tmpl" id="barcode_tmpl">
        <div class="content_wrap popup">

            <section class="pt-2">
                    <div class="table_box sub">
                        <form id="productionOrderForm">
                            <input type="hidden" id="id" name="id" value="{%=o.id%}">

                            <div class="table_box sub" >
                                <div class="row" id = "barcodeArea">

                                    <div class="col-12">
                                        <div class="title_box">
                                            <div class="left_align">
                                                ÏûëÏóÖÏßÄÏãúÎ≤àÌò∏
                                                <button type="button" class="btn-cancel" id="btnPrintWorkOrderBarcode" data-labelCd="ÌîÑÎ¶∞Ìä∏">ÌîÑÎ¶∞Ìä∏</button>
                                            </div>
                                        </div>
                                        <div class="col-12" id="workOrderContainerDiv">

                                            <table class="table_1" style="width: 400px;border-collapse: collapse;">
                                                <tr>
                                                    <td class="tac">ÌíàÎ™©ÏΩîÎìú</td>
                                                    <td>{%=o.mat_code%}</td>
                                                    <td class="tac">ÏõåÌÅ¨ÏÑºÌÑ∞</td>
                                                    <td>{%=o.workcenter%}</td>
                                                </tr>
                                                <tr>
                                                    <td class="tac">ÏÉùÏÇ∞ÌíàÎ™Ö</td>
                                                    <td colspan="3">{%=o.mat_name%}</td>
                                                </tr>
                                                <tr>
                                                    <td class="tac">ÏñëÌíàÏàòÎüâ</td>
                                                    <td>{%=o.good_qty%}</td>
                                                    <td class="tac">ÏÉùÏÇ∞Îã®ÏúÑ</td>
                                                    <td>{%=o.unit%}</td>
                                                </tr>

                                                <tr>
                                                    <td class="tac">ÏÉùÏÇ∞ÏùºÏûê</td>
                                                    <td colspan="3">{%=o.prod_date%} {%=o.end_time%}</td>
                                                </tr>
                                                <tr>
                                                    <td class="tac">Ïú†Ìö®Í∏∞Ìïú</td>
                                                    <td colspan="3">{%=o.ValidDays%}</td>
                                                </tr>
                                                <tr>
                                                    <td colspan="4" class="barcode_td">
                                                        <svg id='svgBarcodeWorkOrderNumber'></svg>
                                                    </td>
                                                </tr>
                                            </table>



                                        </div>
                                    </div>



                                </div>
                            </div>
                        </form>
                    </div>

            </section>

            <section class="popupcontent" >
                <div class="align_left">
                    <!--<button type="button" class="btn-popup" id="btn_save" ><span data-labelCd="Ï†ÄÏû•">Ï†ÄÏû•</span></button>-->
                    <button type="button" class="btn-popup" id="modal-close-button"><span data-labelCd="Îã´Í∏∞">Îã´Í∏∞</span></button>
                    <button type="button" class="btn-popup" id="modal-printAll-button"><span data-labelCd="Ï†ÑÏ≤¥Ï∂úÎ†•">Ï†ÑÏ≤¥Ï∂úÎ†•</span></button>
                </div>
            </section>

        </div>
    </script>
</th:block>


<th:block layout:fragment="scripts">
    <script type="text/javascript" src="/resource/jsBarcode/JsBarcode.all.min.js"></script>
    <script type="text/javascript">

        class ProdResultPage {
            constructor() {
                this.grid = null;
                this.chasuGrid = null;
                this.defectGrid = null;
                this.inputLotGrid = null;
                this.consumedGrid = null;
                this.jobres = null;
                this.selectedIndex = null;
                this.modifiedItems = [];
                this.$tabBasic = $('#tabBasic');
                this.baseUrl = '/api/production/prod_result';
                this.init();
            }

            init() {
                let _this = this;

                this.grid = new wijmo.grid.FlexGrid('#prod-result-grid', {
                    autoGenerateColumns: false,
                    selectionMode: wijmo.grid.SelectionMode.Row,
                    headersVisibility: wijmo.grid.HeadersVisibility.Column,
                    formatItem: (sender, e) => {
                        if (e.panel.cellType === wijmo.grid.CellType.ColumnHeader) {
                            e.cell.style.textAlign = 'center';
                        }
                    },
                    isReadOnly: true,
                    showMarquee: true,
                    columns: [
                        {binding: 'order_num', header: 'ÏûëÏßÄÎ≤àÌò∏', width: 150, align: 'center'},
                        {binding: 'prod_date', header: 'ÏÉùÏÇ∞Ïùº', width: 120, align: 'center'},
                        {binding: 'mat_type', header: 'ÌíàÎ™©Íµ¨Î∂Ñ', width: 100, align: 'center'},
                        {binding: 'workcenter', header: 'ÏõåÌÅ¨ÏÑºÌÑ∞', width: 100, align: 'left'},
                        {binding: 'work_idx', header: 'ÏûëÏóÖÏàúÏÑú', width: 100, align: 'center'},
                        {binding: 'job_state', header: 'ÏÉÅÌÉú', width: 100, align: 'center'},
                        {binding: 'mat_code', header: 'ÌíàÎ™©ÏΩîÎìú', width: 100, align: 'left'},
                        {binding: 'mat_name', header: 'ÌíàÎ™©', width: 200, align: 'left'},
                        {binding: 'unit', header: 'Îã®ÏúÑ', width: 80, align: 'center'},
                        {binding: 'order_qty', header: 'ÏßÄÏãúÎüâ', width: 100, align: 'right'},
                        {binding: 'good_qty', header: 'ÏñëÌíàÎüâ', width: 100, align: 'right'},
                        {binding: 'defect_qty', header: 'Î∂ÄÏ†ÅÌï©Îüâ', width: 100, align: 'right'},
                        {binding: 'description', header: 'ÎπÑÍ≥†', width: 190, align: 'left'}
                    ],
                    itemsSource: new wijmo.collections.CollectionView([]),
                    itemFormatter: function (panel, row, col, cell) {
                        if (panel.cellType === wijmo.grid.CellType.Cell) {
                            let column = panel.columns[col];
                            let item = panel.rows[row].dataItem;

                            // ÏÉÅÌÉú Í∞íÏóê Îî∞Îùº Ïä§ÌÉÄÏùº Ï†ÅÏö©
                            if (column.binding === 'job_state') {
                                if (item.state === 'working') {
                                    cell.style.backgroundColor = '#00ff21';
                                    cell.style.color = '#000'
                                } else if (item.state === 'finished') {
                                    cell.style.backgroundColor = '#0026ff';
                                    cell.style.color = '#FFFFFF'
                                }
                            }
                            if (column.binding === 'order_qty') {
                                cell.style.backgroundColor = '#00ff21';
                            }
                            if (column.binding === 'good_qty') {
                                cell.style.backgroundColor = '#dcf0f8';
                            }
                            if (column.binding === 'defect_qty') {
                                cell.style.backgroundColor = '#f8d2cb';
                            }
                        }
                    },
                    selectionChanged: function (e) {
                        let selectedRow = _this.grid.selection.row;

                        let dataSource = _this.grid.itemsSource instanceof wijmo.collections.CollectionView
                            ? _this.grid.itemsSource.sourceCollection
                            : _this.grid.itemsSource;

                        if (!dataSource || !Array.isArray(dataSource) || dataSource.length === 0) {
                            console.warn("üö® itemsSourceÍ∞Ä ÎπÑÏñ¥ ÏûàÍ±∞ÎÇò Îç∞Ïù¥ÌÑ∞Í∞Ä ÏóÜÏùå.");
                            return;
                        }

                        if (selectedRow >= 0) { // ÏÑ†ÌÉùÎêú ÌñâÏù¥ ÏûàÏùÑ ÎïåÎßå Ï†ÄÏû•
                            _this.selectedIndex = selectedRow;
                        }
                        let item = _this.grid.rows[selectedRow]?.dataItem; // ÏÑ†ÌÉùÎêú Îç∞Ïù¥ÌÑ∞ Í∞ÄÏ†∏Ïò§Í∏∞
                        if (item) {
                            let jr_pk = item.id;
                            let mat_pk = item.mat_pk;
                            let prodDate = item.prod_date;
                            let workcenterId = item.workcenter_id;
                            _this.jobres = item;
                            _this.showBasicInfo(jr_pk);
                            _this.showDefectList('total');
                            _this.showChasuList(jr_pk);


                            if (_this.currentTab === 'tabChasu') {
                                let $tabChasu = $('#tabChasu');
                                $tabChasu.find('#ordqty').text(Number(_this.$tabBasic.find('#order_qty').val()).toLocaleString());
                                $tabChasu.find('#chasuLotSize').val(_this.$tabBasic.find('#lot_size').val());

                            } else if (_this.currentTab === 'tabConsumed') {
                                _this.showInputLotList();
                                _this.showConsumedList(jr_pk, mat_pk, prodDate);
                            }
                        }
                    }
                });
                new FlexGridContextMenu(this.grid);
                this.grid.downloadFileName = 'ÏÉùÏÇ∞ ÎÇ¥Ïó≠';

                this.chasuGrid = new wijmo.grid.FlexGrid('#chasu-grid', {
                    autoGenerateColumns: false,
                    selectionMode: wijmo.grid.SelectionMode.ListBox,
                    frozenColumns: 1, // Ïó¥ Í≥†Ï†ï
                    headersVisibility: wijmo.grid.HeadersVisibility.All,
                    selectionChanged: (e) => {
                        // FlexGridÍ∞Ä Ï¥àÍ∏∞ÌôîÎêòÍ≥† itemsSourceÍ∞Ä ÏÑ§Ï†ïÎêòÏóàÎäîÏßÄ ÌôïÏù∏
                        if (this.chasuGrid && this.chasuGrid.selectedRows) {
                            const selectedRows = this.chasuGrid.selectedRows;
                            if (selectedRows.length > 0) {
                                const item = selectedRows[0].dataItem;
                                // ÌÅ¥ÎûòÏä§ Î©îÏÑúÎìú Ìò∏Ï∂ú
                                this.showDefectList('chasu');
                                this.setButtonState();
                            }
                        }
                    },

                    formatItem: (sender, e) => {
                        if (e.panel.cellType === wijmo.grid.CellType.ColumnHeader) {
                            e.cell.style.textAlign = 'center';
                        }
                    },
                    columns: [
                        {binding: 'chasu', header: 'Ï∞®Ïàò', width: 100, align: 'center', isReadOnly: true},
                        {binding: 'lot_no', header: 'LOT', width: 200, align: 'center', isReadOnly: true},
                        {
                            binding: 'good_qty',
                            header: 'ÏñëÌíàÎüâ',
                            width: 100,
                            align: 'right',
                            format: 'n0',
                            isReadOnly: false,
                            cssClass: 'background-blue'
                        },
                        {
                            binding: 'defect_qty',
                            header: 'Î∂ÄÏ†ÅÌï©Îüâ',
                            width: 100,
                            align: 'right',
                            format: 'n0',
                            isReadOnly: false,
                            cssClass: 'background-defect'
                        },
                        {binding: 'input_time', header: 'ÏûÖÎ†•ÏãúÍ∞Ñ', width: 100, align: 'center', isReadOnly: true},
                    ],
                    itemsSource: new wijmo.collections.CollectionView([]),
                    itemFormatter: function (panel, row, col, cell) {
                        const column = panel.columns[col];
                        if (panel.cellType === wijmo.grid.CellType.Cell) {
                            // Ïª¨Îüº Ïä§ÌÉÄÏùº Ï†ÅÏö©
                            if (column.binding === 'good_qty') {
                                cell.style.backgroundColor = '#dcf0f8';
                            }
                            if (column.binding === 'defect_qty') {
                                cell.style.backgroundColor = '#f8d2cb';
                            }
                        }
                        if (panel.cellType === wijmo.grid.CellType.ColumnHeader) {
                            // Ïª¨Îüº Ïä§ÌÉÄÏùº Ï†ÅÏö©
                            if (column.binding === 'good_qty') {
                                cell.style.color = '#5567ff';
                            }
                            if (column.binding === 'defect_qty') {
                                cell.style.color = '#5567ff';
                            }
                        }
                    },
                });
                let selector = new wijmo.grid.selector.Selector(this.chasuGrid, {
                    itemChecked: function () {

                    }
                })

                // ÌïòÎã® Ìï©Í≥Ñ Ìñâ Ï∂îÍ∞Ä
                this.chasuGrid.columnFooters.rows.push(new wijmo.grid.GroupRow());

                // Îç∞Ïù¥ÌÑ∞ Î≥ÄÍ≤Ω Ïãú Ìï©Í≥Ñ ÏóÖÎç∞Ïù¥Ìä∏
                this.chasuGrid.collectionView.collectionChanged.addHandler(() => {
                    _this.updateFooter();
                });

                // Context Menu Ï∂îÍ∞Ä
                new FlexGridContextMenu(this.chasuGrid);
                this.chasuGrid.downloadFileName = 'Ï∞®ÏàòÎ≥Ñ ÏÉùÏÇ∞ ÎÇ¥Ïó≠';


                this.defectGrid = new wijmo.grid.FlexGrid('#defect-grid', {
                    autoGenerateColumns: false,
                    selectionMode: wijmo.grid.SelectionMode.Cell, // Îã§Ï§ë ÏÑ†ÌÉù Î∂àÍ∞Ä
                    headersVisibility: wijmo.grid.HeadersVisibility.Column,
                    columns: [
                        {binding: 'defect_type', header: 'Î∂ÄÏ†ÅÌï©Ïú†Ìòï', width: 200, align: 'center', isReadOnly: true},
                        {
                            binding: 'defect_qty',
                            header: 'Î∂ÄÏ†ÅÌï©Îüâ',
                            width: 130,
                            align: 'right',
                            format: 'n0',
                            isReadOnly: false, // Ìé∏Ïßë Í∞ÄÎä•
                        },
                        {
                            binding: 'defect_remark',
                            header: 'ÎπÑÍ≥†',
                            width: 450,
                            align: 'center',
                            isReadOnly: false, // Ìé∏Ïßë Í∞ÄÎä•
                        }
                    ],
                    itemsSource: new wijmo.collections.CollectionView([]), // Îπà Îç∞Ïù¥ÌÑ∞Î°ú Ï¥àÍ∏∞Ìôî
                    itemFormatter: (panel, row, col, cell) => {
                        const column = panel.columns[col];
                        if (panel.cellType === wijmo.grid.CellType.Cell) {
                            if (column.binding === 'defect_qty') {
                                cell.style.textAlign = 'right';
                            }
                        }
                        if (panel.cellType === wijmo.grid.CellType.ColumnHeader) {
                            // Ïª¨Îüº Ïä§ÌÉÄÏùº Ï†ÅÏö©
                            if (column.binding === 'defect_qty') {
                                cell.style.color = '#5567ff';
                            }
                            if (column.binding === 'defect_remark') {
                                cell.style.color = '#5567ff';
                            }
                        }
                    }
                });


                // Îç∞Ïù¥ÌÑ∞ Î≥ÄÍ≤Ω Ïù¥Î≤§Ìä∏ Ï≤òÎ¶¨
                this.defectGrid.cellEditEnded.addHandler((sender, e) => {
                    let modifiedItem = sender.rows[e.row].dataItem; // Î≥ÄÍ≤ΩÎêú Ìñâ Îç∞Ïù¥ÌÑ∞ Í∞ÄÏ†∏Ïò§Í∏∞

                    if (modifiedItem && !this.modifiedItems.includes(modifiedItem)) {
                        this.modifiedItems.push(modifiedItem); // ÏàòÏ†ïÎêú Ìï≠Î™© Ï†ÄÏû•
                    }
                });



                // Ïª¨Îüº Ìë∏ÌÑ∞ ÌôúÏÑ±Ìôî
                this.defectGrid.columnFooters.rows.push(new wijmo.grid.Row());

                // Îç∞Ïù¥ÌÑ∞ Î≥ÄÍ≤Ω Ïãú Ìï©Í≥Ñ ÏóÖÎç∞Ïù¥Ìä∏
                this.defectGrid.collectionView.collectionChanged.addHandler(() => {
                    _this.updateFooter();
                });


                this.inputLotGrid = new wijmo.grid.FlexGrid('#input-lot-grid', {
                    autoGenerateColumns: false,
                    selectionMode: wijmo.grid.SelectionMode.Row,
                    frozenColumns: 0, // Ïó¥ Í≥†Ï†ï
                    headersVisibility: wijmo.grid.HeadersVisibility.Column,
                    allowSorting: true, // Î™®Îì† Ïª¨Îüº Ï†ïÎ†¨ Í∞ÄÎä•
                    columns: [
                        {binding: 'mat_type_name', header: 'Ï†úÌíàÍµ¨Î∂Ñ', width: 100, align: 'left', isReadOnly: true},
                        {binding: 'mat_code', header: 'ÌíàÎ™©ÏΩîÎìú', width: 100, align: 'left', isReadOnly: true},
                        {binding: 'mat_name', header: 'ÌíàÎ™©', width: 250, align: 'left', isReadOnly: true},
                        {binding: 'unit_name', header: 'Îã®ÏúÑ', width: 80, align: 'center', isReadOnly: true},
                        {binding: 'lot_number', header: 'Î°úÌä∏Î≤àÌò∏', width: 150, align: 'center', isReadOnly: true},
                        {binding: 'StoreHouseName', header: 'Ï∞ΩÍ≥†', width: 150, align: 'left', isReadOnly: true},
                        {
                            binding: 'cur_stock',
                            header: 'ÌòÑÏû¨Ïû¨Í≥†',
                            width: 100,
                            align: 'right',
                            format: 'n0',
                            isReadOnly: true
                        },
                        {
                            binding: 'req_qty',
                            header: 'Ìà¨ÏûÖÏöîÏ≤≠Îüâ',
                            width: 100,
                            align: 'right',
                            format: 'n0',
                            isReadOnly: true
                        },
                        {
                            binding: 'consumed_qty',
                            header: 'ÏÉùÏÇ∞ÏÜåÎ™®Îüâ',
                            width: 100,
                            align: 'right',
                            format: 'n0',
                            isReadOnly: true
                        },
                        {binding: 'start_date', header: 'Ìà¨ÏûÖÏùºÏãú', width: 200, align: 'center', isReadOnly: true}
                    ],
                    itemsSource: new wijmo.collections.CollectionView([]), // Îπà Îç∞Ïù¥ÌÑ∞Î°ú Ï¥àÍ∏∞Ìôî
                    itemFormatter: (panel, row, col, cell) => {
                        if (panel.cellType === wijmo.grid.CellType.ColumnHeader) {
                            cell.style.textAlign = 'center';
                        }
                    }
                });

                // Ìï©Í≥Ñ ÌëúÏãúÎ•º ÏúÑÌïú Ïª¨Îüº Ìë∏ÌÑ∞ Ï∂îÍ∞Ä
                this.inputLotGrid.columnFooters.rows.push(new wijmo.grid.GroupRow());

                // Îç∞Ïù¥ÌÑ∞ Î≥ÄÍ≤Ω Ïãú Ìï©Í≥Ñ ÏóÖÎç∞Ïù¥Ìä∏
                this.inputLotGrid.collectionView.collectionChanged.addHandler(() => {
                    _this.updateFooter();
                });

                this.consumedGrid = new wijmo.grid.FlexGrid('#consumed-grid', {
                    autoGenerateColumns: false,
                    selectionMode: wijmo.grid.SelectionMode.Row,
                    frozenColumns: 0, // Ïó¥ Í≥†Ï†ï
                    headersVisibility: wijmo.grid.HeadersVisibility.Column,
                    allowSorting: true, // Î™®Îì† Ïª¨Îüº Ï†ïÎ†¨ Í∞ÄÎä•
                    columns: [
                        {binding: 'mat_type_name', header: 'Ï†úÌíàÍµ¨Î∂Ñ', width: 100, align: 'left', isReadOnly: true},
                        {binding: 'mat_code', header: 'ÌíàÎ™©ÏΩîÎìú', width: 100, align: 'left', isReadOnly: true},
                        {binding: 'mat_name', header: 'ÌíàÎ™©', width: 250, align: 'left', isReadOnly: true},
                        {binding: 'unit', header: 'Îã®ÏúÑ', width: 80, align: 'center', isReadOnly: true},
                        {binding: 'lotUseYn', header: 'LOTÍ¥ÄÎ¶¨ Ïú†Î¨¥', width: 120, align: 'center', isReadOnly: true},
                        {
                            binding: 'lot_size',
                            header: 'Î°úÌä∏ size',
                            width: 120,
                            align: 'right',
                            format: 'n0',
                            isReadOnly: true
                        },
                        {
                            binding: 'current_qty_sum',
                            header: 'Î°úÌä∏Ìà¨ÏûÖÎüâ',
                            width: 100,
                            align: 'right',
                            format: 'n0',
                            isReadOnly: true
                        },
                        {
                            binding: 'bom_consumed',
                            header: 'ÏÜåÏöîÎüâ(BOM)',
                            width: 120,
                            align: 'right',
                            format: 'n0',
                            isReadOnly: true
                        },
                        {
                            binding: 'consumed_qty',
                            header: 'Ïã§ÏÉùÏÇ∞ÏÜåÎ™®Îüâ',
                            width: 120,
                            align: 'right',
                            format: 'n0',
                            isReadOnly: false
                        },
                        {
                            binding: 'currentStock',
                            header: 'ÌòÑÏû¨Ïû¨Í≥†',
                            width: 100,
                            align: 'right',
                            format: 'n0',
                            isReadOnly: true
                        }
                    ],
                    itemsSource: new wijmo.collections.CollectionView([]), // Îπà Îç∞Ïù¥ÌÑ∞Î°ú Ï¥àÍ∏∞Ìôî
                    itemFormatter: (panel, row, col, cell) => {
                        if (panel.cellType === wijmo.grid.CellType.ColumnHeader) {
                            cell.style.textAlign = 'center';
                        }
                    }
                });

                // ÌïÑÌÑ∞
                AjaxUtil.fillSelectOptions($('#cboMaterialType'), 'system_code', 'all', false, 'mat_type');
                AjaxUtil.fillSelectOptions($('#cboShift'), 'shift', 'choose', false); // Í∑ºÎ¨¥Ï°∞
                AjaxUtil.fillSelectOptions($('#cboWorkCenter'), 'workcenter', 'choose', false); // ÏõåÌÅ¨ÏÑºÌÑ∞

                // formÎÇ¥Î∂Ä
                AjaxUtil.fillSelectOptions($('#shift_code'), 'shift', 'choose', false); // Í∑ºÎ¨¥Ï°∞
                AjaxUtil.fillSelectOptions($('#workcenter_id'), 'workcenter', 'choose', false); // ÏõåÌÅ¨ÏÑºÌÑ∞

                $('#workcenter_id').change(function () {
                    if ($('#state').val() == 'ordered') {
                        AjaxUtil.fillSelectOptions($('#equipment_id'), 'equipment', 'choose', false, '', '', $('#workcenter_id').val()); // ÏÑ§ÎπÑ
                        _this.showDefectList('total');
                    }
                });
            }

            // ÌïòÎã® Ìï©Í≥Ñ ÏóÖÎç∞Ïù¥Ìä∏ Ìï®Ïàò
            updateFooter() {
                let goodQtySum = 0;
                let defectQtySum = 0;

                let totalDefectQty = 0;

                let totalCurStock = 0;
                let totalReqQty = 0;
                let totalConsumedQty = 0;

                // chasuGrid Ìï©Í≥Ñ Í≥ÑÏÇ∞ (ÏñëÌíàÎüâ & Î∂ÄÏ†ÅÌï©Îüâ)
                if (this.chasuGrid && this.chasuGrid.collectionView) {
                    this.chasuGrid.collectionView.items.forEach(item => {
                        goodQtySum += item.good_qty || 0; // undefinedÏùº Í≤ΩÏö∞ 0 Ï≤òÎ¶¨
                        defectQtySum += item.defect_qty || 0; // undefinedÏùº Í≤ΩÏö∞ 0 Ï≤òÎ¶¨
                    });

                    // columnFootersÏùò Ï≤´ Î≤àÏß∏ ÌñâÏùÑ Í∞ÄÏ†∏ÏôÄ Ìï©Í≥Ñ ÏóÖÎç∞Ïù¥Ìä∏
                    let footerRow = this.chasuGrid.columnFooters.rows[0];

                    this.chasuGrid.columnFooters.setCellData(footerRow.index, 'lot_no', 'Ìï©Í≥Ñ');
                    this.chasuGrid.columnFooters.setCellData(footerRow.index, 'good_qty', goodQtySum);
                    this.chasuGrid.columnFooters.setCellData(footerRow.index, 'defect_qty', defectQtySum);
                }

                // defectGrid Ìï©Í≥Ñ Í≥ÑÏÇ∞
                if (this.defectGrid && this.defectGrid.collectionView) {
                    this.defectGrid.collectionView.items.forEach(item => {
                        totalDefectQty += item.defect_qty || 0;
                    });

                    let footerRow = this.defectGrid.columnFooters.rows[0];

                    this.defectGrid.columnFooters.setCellData(footerRow.index, 'defect_type', 'Ìï©Í≥Ñ');
                    this.defectGrid.columnFooters.setCellData(footerRow.index, 'defect_qty', totalDefectQty);
                }

                // inputLotGrid Ìï©Í≥Ñ Í≥ÑÏÇ∞ (ÌòÑÏû¨Ïû¨Í≥†, Ìà¨ÏûÖÏöîÏ≤≠Îüâ, ÏÉùÏÇ∞ÏÜåÎ™®Îüâ)
                if (this.inputLotGrid && this.inputLotGrid.collectionView) {
                    this.inputLotGrid.collectionView.items.forEach(item => {
                        totalCurStock += item.cur_stock || 0;
                        totalReqQty += item.req_qty || 0;
                        totalConsumedQty += item.consumed_qty || 0;
                    });

                    let footerRow = this.inputLotGrid.columnFooters.rows[0];

                    this.inputLotGrid.columnFooters.setCellData(footerRow.index, 'StoreHouseName', 'Ìï©Í≥Ñ');
                    this.inputLotGrid.columnFooters.setCellData(footerRow.index, 'cur_stock', totalCurStock);
                    this.inputLotGrid.columnFooters.setCellData(footerRow.index, 'req_qty', totalReqQty);
                    this.inputLotGrid.columnFooters.setCellData(footerRow.index, 'consumed_qty', totalConsumedQty);
                }
            }


            // LOT Îç∞Ïù¥ÌÑ∞ ÏÑ§Ï†ï Ïãú Í∏∞Î≥∏Í∞í Ï∂îÍ∞Ä
            setDefaultData(items) {
                items.forEach(item => {
                    item.good_qty = item.good_qty || 0; // ÏñëÌíàÎüâ Í∏∞Î≥∏Í∞í 0
                    item.defect_qty = item.defect_qty || 0; // Î∂ÄÏ†ÅÌï©Îüâ Í∏∞Î≥∏Í∞í 0
                });
            }

            // ÏãúÍ∞ÑÏûÖÎ†• validate
            validateTime(timeColumn) {
                let _this = this;
                DataValidation.validateTime(timeColumn);
                this.consumedGrid.setValue(timeColumn.dindex, timeColumn.key, timeColumn.value);
            }

            // Î≤ÑÌäº ÌôúÏÑ±Ìôî ÏÑ§Ï†ï
            setButtonState() {
                let pk = $('#tabBasic').find('#id').val();
                let $buttons = $('.tab-content').find('button');

                //$buttons.each(function () {
                //    if (!$(this).is(':disabled')) {
                //        $(this).attr('disabled', 'disabled');
                //    }
                //});


                $('#btnGridSetting2').removeAttr('disabled');
                $('#btnGridSetting3').removeAttr('disabled');

                $('#btnExcel2').removeAttr('disabled');
                $('#btnExcel3').removeAttr('disabled');
                let chasu = this.chasuGrid.selectedItems;
                if (chasu.length > 0) {
                    chasu = chasu[0].chasu;
                } else {
                    chasu = 0;
                }
                if (pk) {
                    let state = $('#tabBasic').find('#state').val(); // ordered, working, finished
                    $('#btnConsumedView').removeAttr('disabled');
                    if (state == 'ordered' || state == 'stopped') {
                        $('#btnWorkStart').removeAttr('disabled');
                        $('#btnSave').removeAttr('disabled');
                        $('#btnTest').removeAttr('disabled');
                        $('#btnDel').removeAttr('disabled');
                        $('#btnLOTbarcode').attr('disabled', 'disabled');
                        $('#btnAddChasu').attr('disabled', 'disabled');
                        $('#btnSaveChasu').attr('disabled', 'disabled');
                        $('#btnDeleteChasu').attr('disabled', 'disabled');
                    } else if (state == 'working') {
                        $('#btnWorkStart').attr('disabled', 'disabled');

                        $('#btnWorkStop').removeAttr('disabled');
                        $('#btnSave').removeAttr('disabled');
                        $('#btnTest').removeAttr('disabled');
                        $('#btnDel').removeAttr('disabled');
                        $('#btnWorkFinish').removeAttr('disabled');
                        $('#btnAddChasu').removeAttr('disabled');
                        $('#btnSaveChasu').removeAttr('disabled');
                        $('#btnDeleteChasu').removeAttr('disabled');
                        $('#btnDefectSave').removeAttr('disabled');
                        $('#btnConsumedSave').removeAttr('disabled');
                        $('#btnAddMat').removeAttr('disabled');
                        $('#btnLOTbarcode').attr('disabled', false);
                    } else if (state == 'finished') {
                        $('#btnLOTbarcode').attr('disabled', false);
                        $('#btnConsumedSave').attr('disabled', 'disabled');
                        $('#btnDel').attr('disabled', 'disabled');
                        $('#btnFinishCancel').removeAttr('disabled');
                    }
                }
            }

            // ÏûëÏóÖÎ™©Î°ù Ï°∞Ìöå
            searchMainData() {
                let _this = this;

                let param = {
                    'date_from': $('#date_from').val(),
                    'date_to': $('#date_to').val(),
                    'shift_code': $('#cboShift').val(),
                    'workcenter_pk': $('#cboWorkCenter').val(),
                    'mat_type': $('#cboMaterialType').val(),
                    'is_include_comp': $('#chxCompYn').is(':checked')
                };

                let result = AjaxUtil.getSyncData(this.baseUrl + '/read', param);
                if (result.data != null) {
                    _this.grid.itemsSource = result.data;
                }

                $('#selected_order_num').val('');
                $('#basicForm')[0].reset();


                $('#basicForm').find('input, select, textarea').each(function () {
                    if (!$(this).is(':disabled')) {
                        $(this).attr('disabled', 'disabled');
                    }
                });

                this.setButtonState();

                $('#svgBarcode').empty();
            }

            // ÏÉùÏÇ∞Ï†ïÎ≥¥ Ï°∞Ìöå
            showBasicInfo(jr_pk) {
                let _this = this;
                let param = {
                    'jr_pk': jr_pk
                };

                let res = AjaxUtil.getSyncData(this.baseUrl + '/detail', param);
                let result = res.data
                if (result) {

                    $('#selected_order_num').val(result.order_num);

                    AjaxUtil.fillSelectOptions($('#equipment_id'), 'equipment', 'choose', false, '', '', result.workcenter_id); // ÏÑ§ÎπÑ

                    FormUtil.BindDataForm(result, $('#basicForm'));
                    $('#bom_output_amount').val(result.bom_output_amount);
                    if (!result.end_date)
                        $('#end_date').val(page.today);

                    $('#job_state').removeClass('working-status');
                    $('#job_state').removeClass('finished-status');

                    if (result.state === 'working') {
                        $('#job_state').addClass('working-status');
                    } else if (result.state === 'finished') {
                        $('#job_state').addClass('finished-status');
                    }

                    if (result.state !== 'ordered') {
                        $('#workcenter_id').on('focus', function () {
                            this.initialSelect = this.selectedIndex;
                        });

                        $('#workcenter_id').on('change', function () {
                            this.selectedIndex = this.initialSelect;
                        });
                    }
                    let total_prod_qty = result.good_qty + result.defect_qty + result.loss_qty + result.scrap_qty;
                    //$('#lblTotalOutput').text(total_prod_qty);

                    $('#ordqty').text(result.order_qty.toLocaleString());
                    $('#chasuLotSize').val(result.lot_size);

                    this.setButtonState();

                    // Î∞îÏΩîÎìú Ï∂úÎ†•
                    // ÏûëÏóÖÏßÄÏãúÎ≤àÌò∏ Î∞îÏΩîÎìú ÏÑ§Ï†ï
                    //
                    let wcontent = tmpl('workorder_table_tmpl', result);
                    let $workOrderContainerDiv = $('#workOrderContainerDiv');
                    let $wcontent = $(wcontent);
                    $workOrderContainerDiv.html($wcontent);

                    //order_num
                    //let barcodeLabelText = result.lot_num + "(" + result.mat_name + ")";
                    let barcodeLabelText = result.order_num + "(" + result.mat_name + ")";
                    if (result.order_num) {
                        JsBarcode("#svgBarcodeWorkOrderNumber", result.order_num, {
                            format: 'code128', // Î∞îÏΩîÎìú Ìè¨Îß∑ / default: code128 / options: EAN, UPC, CODE39, ITF-14, MSI, Pharmacode, Codabar (Í∞Å ÏòµÏÖòÎì§Ïóê ÎåÄÌïú ÏÑ§Î™ÖÏùÄ ÏÇ¨Ïù¥Ìä∏ Ï∞∏Ï°∞)
                            width: 2, // ÎÑàÎπÑ / default: 2
                            height: 100, // ÎÜíÏù¥ / default: 100
                            displayValue: true, // ÌÖçÏä§Ìä∏ ÌëúÏãú Ïó¨Î∂Ä / default: true
                            text: barcodeLabelText, // Îç∞Ïù¥ÌÑ∞ ÎåÄÏã† ÌäπÏ†ï ÌÖçÏä§Ìä∏ ÌëúÏãú / default: undefined
                            fontOptions: '', // Ìè∞Ìä∏ ÏÑ§Ï†ï / default: '' / options: bold, italic, bold italic
                            font: 'monospace', // Ìè∞Ìä∏ / default: monospace / options: fantasy, etc... ÏÇ¨Ïù¥Ìä∏ Ï∞∏Ï°∞
                            textAlign: 'center', // ÌÖçÏä§Ìä∏ ÏúÑÏπò / default: center / options: left, center, right
                            textPosition: 'bottom', // ÌÖçÏä§Ìä∏ ÏúÑÏπò / default: bottom / options: top, bottom
                            textMargin: 2, // Î∞îÏΩîÎìúÏôÄ ÌÖçÏä§Ìä∏ ÏÇ¨Ïù¥ Ïó¨Î∞± / default: 2
                            fontSize: 12, // Ìè∞Ìä∏ ÌÅ¨Í∏∞ / default: 20
                            background: '#ffffff', // Î∞îÏΩîÎìú Î∞∞Í≤Ω ÏÉâ / default: #ffffff
                            lineColor: '#000000', // Î∞îÏΩîÎìú ÎùºÏù∏ ÏÉâ / default: #000000
                            margin: 10, // Î∞îÏΩîÎìú ÏòÅÏó≠ Ï£ºÎ≥Ä Ïó¨Î∞± / default: 10
                        });

                        $('#btnPrintWorkOrderBarcode').click(function (e) {
                            let popupWindow = window.open("barcode_print", "_blank", "width=800px");
                            let css = $('#print_css')[0].outerHTML;

                            let html = $workOrderContainerDiv.html();
                            popupWindow.document.write(css);
                            popupWindow.document.write(html);
                            popupWindow.print();
                            return false;
                        });

                    }

                    let lcontent = tmpl('lotnumber_table_tmpl', result);
                    let $lcontent = $(lcontent);
                    let $LotNumberContainerDiv = $('#LotNumberContainerDiv');
                    $LotNumberContainerDiv.html($lcontent);
                    if (result.lot_num) {
                        barcodeLabelText = result.lot_num + "(" + result.mat_name + ")";
                        JsBarcode("#svgBarcodeLotNumber", result.lot_num, {
                            format: 'code128', // Î∞îÏΩîÎìú Ìè¨Îß∑ / default: code128 / options: EAN, UPC, CODE39, ITF-14, MSI, Pharmacode, Codabar (Í∞Å ÏòµÏÖòÎì§Ïóê ÎåÄÌïú ÏÑ§Î™ÖÏùÄ ÏÇ¨Ïù¥Ìä∏ Ï∞∏Ï°∞)
                            width: 2, // ÎÑàÎπÑ / default: 2
                            height: 100, // ÎÜíÏù¥ / default: 100
                            displayValue: true, // ÌÖçÏä§Ìä∏ ÌëúÏãú Ïó¨Î∂Ä / default: true
                            text: barcodeLabelText, // Îç∞Ïù¥ÌÑ∞ ÎåÄÏã† ÌäπÏ†ï ÌÖçÏä§Ìä∏ ÌëúÏãú / default: undefined
                            fontOptions: '', // Ìè∞Ìä∏ ÏÑ§Ï†ï / default: '' / options: bold, italic, bold italic
                            font: 'monospace', // Ìè∞Ìä∏ / default: monospace / options: fantasy, etc... ÏÇ¨Ïù¥Ìä∏ Ï∞∏Ï°∞
                            textAlign: 'center', // ÌÖçÏä§Ìä∏ ÏúÑÏπò / default: center / options: left, center, right
                            textPosition: 'bottom', // ÌÖçÏä§Ìä∏ ÏúÑÏπò / default: bottom / options: top, bottom
                            textMargin: 2, // Î∞îÏΩîÎìúÏôÄ ÌÖçÏä§Ìä∏ ÏÇ¨Ïù¥ Ïó¨Î∞± / default: 2
                            fontSize: 12, // Ìè∞Ìä∏ ÌÅ¨Í∏∞ / default: 20
                            background: '#ffffff', // Î∞îÏΩîÎìú Î∞∞Í≤Ω ÏÉâ / default: #ffffff
                            lineColor: '#000000', // Î∞îÏΩîÎìú ÎùºÏù∏ ÏÉâ / default: #000000
                            margin: 10, // Î∞îÏΩîÎìú ÏòÅÏó≠ Ï£ºÎ≥Ä Ïó¨Î∞± / default: 10
                        });

                        $('#btnPrintLotNumberBarcode').click(function (e) {
                            let popupWindow = window.open("barcode_print", "_blank", "width=800px");
                            let css = $('#print_css')[0].outerHTML;

                            let html = $LotNumberContainerDiv.html();
                            popupWindow.document.write(css);
                            popupWindow.document.write(html);
                            popupWindow.print();
                            return false;
                        });
                    }


                }
            }

            // ÏÉùÏÇ∞Ï†ïÎ≥¥ Ï†ÄÏû•
            saveBasicInfo() {
                let _this = this;
                let url = this.baseUrl + '/save';

                let previousIndex = _this.selectedIndex;

                let data = FormUtil.extractForm($('#basicForm'));
                let fnSuccess = function (res) {
                    if (res.success) {
                        Notify.success('Ï†ÄÏû•ÎêòÏóàÏäµÎãàÎã§.');
                        _this.searchMainData();
                        _this.grid.select(previousIndex, 0);
                        _this.showBasicInfo(res.data.jr_pk);
                    }
                }

                // ÌïÑÏàòÏûÖÎ†• check routine
                if (!data.prod_date) {
                    Alert.alert('', 'ÏÉùÏÇ∞ÏùºÏùÑ ÏÑ†ÌÉùÌï¥Ï£ºÏÑ∏Ïöî.');
                    return;
                } else if (!data.shift_code) {
                    Alert.alert('', 'Í∑ºÎ¨¥Ï°∞Î•º ÏÑ†ÌÉùÌï¥Ï£ºÏÑ∏Ïöî.');
                    return;
                } else if (!data.workcenter_id) {
                    Alert.alert('', 'ÏõåÌÅ¨ÏÑºÌÑ∞Î•º ÏÑ†ÌÉùÌï¥Ï£ºÏÑ∏Ïöî.');
                    return;
                }

                if (!data.good_qty) data.good_qty = 0;
                if (!data.defect_qty) data.defect_qty = 0;

                AjaxUtil.postAsyncData(url, data, fnSuccess);
            }

            // ÏÉùÏÇ∞Ï†ïÎ≥¥ ÏÇ≠Ï†ú
            delBasicInfo() {
                let _this = this;
                let url = this.baseUrl + '/del';

                let data = FormUtil.extractForm($('#basicForm'));

                let fnSuccess = function (res) {
                    if (res.success) {
                        Notify.success('ÏÇ≠Ï†úÎêòÏóàÏäµÎãàÎã§.');
                        _this.searchMainData();
                        _this.setButtonState();
                    } else {
                        Alert.alert('ÏûëÏóÖÏßÄÏãú ÏÇ≠Ï†ú', res.message);
                    }
                }

                // ÌïÑÏàòÏûÖÎ†• check routine
                if (data.state === 'finished') {
                    Alert.alert('', 'ÏôÑÎ£åÎêú ÏûëÏóÖÏùÄ ÏÇ≠Ï†úÌï† Ïàò ÏóÜÏäµÎãàÎã§.');
                    return;
                } else if (parseFloat(data.good_qty) + parseFloat(data.defect_qty)) {
                    Alert.alert('', 'ÏÉùÏÇ∞ ÏàòÎüâÏù¥ Ï°¥Ïû¨ÌïòÎäî ÏûëÏóÖÏùÄ ÏÇ≠Ï†úÌï† Ïàò ÏóÜÏäµÎãàÎã§.');
                    return;
                } else {
                    Alert.confirm('ÏûëÏóÖÏßÄÏãú ÏÇ≠Ï†ú', 'ÌòÑÏû¨ ÏûëÏóÖÏßÄÏãú(' + data.order_num + ')Î•º ÏÇ≠Ï†úÌïòÏãúÍ≤†ÏäµÎãàÍπå?',
                        function () {
                            AjaxUtil.postAsyncData(url, data, fnSuccess);
                        },
                        function () {
                        }
                    )
                }
            }

            // ÏûëÏóÖÏãúÏûë
            workStart() {
                let _this = this;

                let url = this.baseUrl + '/work_start';
                let data = FormUtil.extractForm($('#basicForm'));
                let defectGridList = this.defectGrid.collectionView.items;
                let previousIndex = _this.selectedIndex;
                console.log('workStart', defectGridList);

                let fnSuccess = function (res) {
                    if (res.success) {
                        Notify.success('ÏûëÏóÖÏù¥ ÏãúÏûëÎêòÏóàÏäµÎãàÎã§.');
                        _this.saveDefectList(defectGridList, 'workStart', res.data.jr_pk); // ÏûëÏóÖÏãúÏûë Ïãú Ìï¥Îãπ ÏõåÌÅ¨ÏÑºÌÑ∞Ïóê Îì±Î°ùÎêú Í≥µÏ†ïÎ≥Ñ Î∂ÄÏ†ÅÌï© ÎÇ¥Ïó≠ Ï†ÄÏû•
                        _this.searchMainData();
                        _this.grid.select(previousIndex, 0);
                        _this.showBasicInfo(res.data.jr_pk);
                    }
                }

                // ÌïÑÏàòÏûÖÎ†•
                if (!data.prod_date) {
                    Alert.alert('', 'ÏÉùÏÇ∞ÏùºÏùÑ ÏÑ†ÌÉùÌï¥Ï£ºÏÑ∏Ïöî.');
                    return;
                } else if (!data.shift_code) {
                    Alert.alert('', 'Í∑ºÎ¨¥Ï°∞Î•º ÏÑ†ÌÉùÌï¥Ï£ºÏÑ∏Ïöî.');
                    return;
                } else if (!data.workcenter_id) {
                    Alert.alert('', 'ÏõåÌÅ¨ÏÑºÌÑ∞Î•º ÏÑ†ÌÉùÌï¥Ï£ºÏÑ∏Ïöî.');
                    return;
                }

                // ÏãúÏûëÏãúÍ∞Ñ ÏóÜÏùÑ Ïãú ÏûêÎèô ÏÑ∏ÌåÖ
                if (!data.start_time) {
                    let now = new Date();
                    let now_time = ('0' + now.getHours()).slice(-2) + ':' + ('0' + now.getMinutes()).slice(-2);
                    data.start_time = now_time;
                }

                AjaxUtil.postAsyncData(url, data, fnSuccess);
            }

            // ÏûëÏóÖÏôÑÎ£å
            workFinish() {
                let _this = this;

                let url = this.baseUrl + '/work_finish';
                let data = FormUtil.extractForm($('#basicForm'));
                let previousIndex = _this.selectedIndex;
                let fnSuccess = function (res) {
                    if (!res.success) {
                        Alert.alert('', res.message);
                    } else {
                        Notify.success('ÏûëÏóÖÏù¥ ÏôÑÎ£åÎêòÏóàÏäµÎãàÎã§.');
                        _this.searchMainData();
                        _this.grid.select(previousIndex, 0);
                        _this.showBasicInfo(res.data.jr_pk);
                    }
                }

                let orderQty = parseFloat($('#order_qty').val());
                let defect_qty = $('#defect_qty').val();
                defect_qty = isNaN(defect_qty) ? 0 : defect_qty;

                let inputQty = parseFloat($('#good_qty').val()) + parseFloat(defect_qty);
                let bom_output_amount = parseFloat($('#bom_output_amount').val());

                // ÌïÑÏàòÏûÖÎ†•
                if (!data.prod_date) {
                    Alert.alert('', 'ÏÉùÏÇ∞ÏùºÏùÑ ÏÑ†ÌÉùÌï¥Ï£ºÏÑ∏Ïöî.');
                    return;
                } else if (!data.end_date) {
                    Alert.alert('', 'Ï¢ÖÎ£åÏùºÏùÑ ÏÑ†ÌÉùÌï¥Ï£ºÏÑ∏Ïöî.');
                    return;
                } else if (!data.start_time) {
                    Alert.alert('', 'ÏÉùÏÇ∞ÏãúÏûëÏãúÍ∞ÑÏùÑ ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.');
                    return;
                } else if (!data.shift_code) {
                    Alert.alert('', 'Í∑ºÎ¨¥Ï°∞Î•º ÏÑ†ÌÉùÌï¥Ï£ºÏÑ∏Ïöî.');
                    return;
                } else if (!data.workcenter_id) {
                    Alert.alert('', 'ÏõåÌÅ¨ÏÑºÌÑ∞Î•º ÏÑ†ÌÉùÌï¥Ï£ºÏÑ∏Ïöî.');
                    return;
                }

                // Ï¢ÖÎ£åÏãúÍ∞Ñ ÏóÜÏùÑ Ïãú ÏûêÎèô ÏÑ∏ÌåÖ
                if (!data.end_time) {
                    let now = new Date();
                    let nowTime = ('0' + now.getHours()).slice(-2) + ':' + ('0' + now.getMinutes()).slice(-2);
                    data.end_time = nowTime;

                    $('#end_time').val(nowTime);
                }

                // ÏûëÏóÖÏãúÍ∞Ñ check
                if (data.prod_date + data.start_time > data.end_date + data.end_time) {
                    Alert.alert('', 'ÏûëÏóÖÏãúÍ∞ÑÏùÑ ÌôïÏù∏Ìï¥Ï£ºÏÑ∏Ïöî.');
                    return;
                }

                //ÏûëÏóÖÏßÄÏãúÏóê Î∂àÎüâÎüâÍ≥º Ï∞®ÏàòÏùò Î∂àÎüâÎüâ Ìï© ÎßûÏ∂îÍ∏∞
                let chassu_grid = _this.chasuGrid.collectionView.items;
                let chasu_def_qty = 0;

                for (let i = 0; i < chassu_grid.length; i++) {
                    if (chassu_grid[i].defect_qty != null) {
                        chasu_def_qty += parseFloat(chassu_grid[i].defect_qty);
                    }
                }

                if (parseFloat(chasu_def_qty) !== parseFloat(defect_qty)) {
                    Alert.alert('ÏûëÏóÖÏôÑÎ£å Ïò§Î•ò', 'Ï¥ùÎ∂ÄÏ†ÅÌï©ÎüâÍ≥º Ï∞®ÏàòÎ≥Ñ Î∂ÄÏ†ÅÌï©ÎüâÏùÑ ÌôïÏù∏Ìï¥Ï£ºÏÑ∏Ïöî.');
                    return;
                }


                // ÏßÄÏãúÎüâ ÎåÄÎπÑ ÏûÖÎ†•Îüâ check
                if (orderQty !== inputQty) {
                    Alert.confirm('', 'ÏßÄÏãúÎüâÍ≥º Ï¥ùÏÉùÏÇ∞Îüâ Ìï©Ïù¥ ÏùºÏπòÌïòÏßÄ ÏïäÏäµÎãàÎã§. \n ÏôÑÎ£å Ï≤òÎ¶¨ÌïòÏãúÍ≤†ÏäµÎãàÍπå?',
                        function () {
                            AjaxUtil.postAsyncData(url, data, fnSuccess);
                        },
                        function () {
                        }
                    )
                } else {
                    AjaxUtil.postAsyncData(url, data, fnSuccess);
                }
            }

            // ÏûëÏóÖÏôÑÎ£åÏ∑®ÏÜå
            workFinishCancel() {
                let _this = this;
                let previousIndex = _this.selectedIndex;
                let url = this.baseUrl + '/finish_cancel';
                let jr_pk = $('#tabBasic').find('#id').val();
                let fnSuccess = function (res) {
                    if (res.success) {
                        Notify.success('Ï∑®ÏÜåÎêòÏóàÏäµÎãàÎã§.');
                        _this.searchMainData();
                        _this.grid.select(previousIndex, 0);
                        _this.showBasicInfo(res.data.jr_pk);
                    }
                }

                let data = {
                    'jr_pk': jr_pk,
                }

                AjaxUtil.postAsyncData(url, data, fnSuccess);
            }

            // ÏÉùÏÇ∞Ï∞®Ïàò Î™©Î°ù Ï°∞Ìöå
            showChasuList(jr_pk) {
                let _this = this;

                let param = {
                    'jr_pk': jr_pk,
                }

                let result = AjaxUtil.getSyncData(this.baseUrl + '/chasu_list', param);
                if (result.data) {
                    _this.setDefaultData(result.data); // Í∏∞Î≥∏Í∞í ÏÑ§Ï†ï
                    _this.chasuGrid.itemsSource = new wijmo.collections.CollectionView(result.data); // Îç∞Ïù¥ÌÑ∞ Î∞îÏù∏Îî©
                    _this.updateFooter(); // ÌïòÎã® Ìï©Í≥Ñ ÏóÖÎç∞Ïù¥Ìä∏
                }
            }

            // Ï∞®ÏàòÏ∂îÍ∞Ä
            addChasu() {
                let _this = this;

                let jr_pk = this.$tabBasic.find('#id').val();
                let workcenter_id = this.$tabBasic.find('#workcenter_id').val()
                let lotSize = $('#chasuLotSize').val();

                if (!workcenter_id) {
                    Alert.alert('Ï∞®ÏàòÏ†ÄÏû•Ïò§Î•ò', 'Í∏∞Î≥∏Ï†ïÎ≥¥ ÌÉ≠Ïùò ÏõåÌÅ¨ÏÑºÌÑ∞Î•º ÏÑ†ÌÉùÌï¥Ï£ºÏÑ∏Ïöî.');
                    return;
                }
                if (lotSize === "" || lotSize === "0") {
                    Alert.alert('Ï∞®ÏàòÏ∂îÍ∞ÄÏò§Î•ò', 'Ï∞®ÏàòÏùò LOT size Î•º ÌôïÏù∏ÌïòÏÑ∏Ïöî');
                    return;
                }


                let data = {jr_pk: jr_pk, good_qty: lotSize, defect_qty: 0, loss_qty: 0, scrap_qty: 0};
                let addChasuCallbackSuccess = function (result) {
                    if (result.success) {
                        Notify.success('Ï†ÄÏû•ÎêòÏóàÏäµÎãàÎã§.');
                        _this.showChasuList(result.data.jr_pk);


                        let dataSource = _this.grid.itemsSource instanceof wijmo.collections.CollectionView
                            ? _this.grid.itemsSource.sourceCollection
                            : _this.grid.itemsSource;
                        let updatedItem = dataSource[parseInt(_this.selectedIndex)];

                        if (updatedItem) {
                            // `good_qty` Í∞í ÏóÖÎç∞Ïù¥Ìä∏
                            updatedItem.good_qty = result.data.good_qty_sum;

                            // 3. Wijmo GridÏóê Î≥ÄÍ≤ΩÏÇ¨Ìï≠ Î∞òÏòÅ
                            _this.grid.collectionView.commitEdit(); // Îç∞Ïù¥ÌÑ∞ Î≥ÄÍ≤Ω ÌôïÏ†ï
                            _this.grid.invalidate(); // ÌôîÎ©¥ Îã§Ïãú Í∑∏Î¶º (Í∞ïÏ†ú ÏÉàÎ°úÍ≥†Ïπ® X)
                        }

                        _this.showBasicInfo(result.data.jr_pk);

                    } else {
                        Alert.alert('Ï∞®Ïàò Ï∂îÍ∞Ä Ïò§Î•ò', result.message);
                    }
                }
                let url = this.baseUrl + '/chasu_add';
                AjaxUtil.postAsyncData(url, data, addChasuCallbackSuccess);
            }

            // Ï∞®ÏàòÏÇ≠Ï†ú
            deleteChasu() {
                let _this = this;
                let url = this.baseUrl + '/chasu_del';
                let jr_pk = this.$tabBasic.find('#id').val();
                let selectedItems = this.chasuGrid.selectedItems; // Ï≤¥ÌÅ¨Îêú Ìï≠Î™© Í∞ÄÏ†∏Ïò§Í∏∞

                if (selectedItems.length === 0) {
                    Alert.alert('Ï∞®Ïàò ÏÇ≠Ï†úÏò§Î•ò', 'ÏÑ†ÌÉùÎêú Ï∞®ÏàòÍ∞Ä ÏóÜÏäµÎãàÎã§.');
                    return;
                }

                let fnSuccess = function (res) {
                    if (res.success) {
                        Alert.alert('ÎßàÏßÄÎßâ Ï∞®Ïàò ÏÇ≠Ï†ú', 'ÏÇ≠Ï†úÎêòÏóàÏäµÎãàÎã§.');
                        _this.showChasuList(res.data.jr_pk);

                        // Wijmo GridÏóêÏÑú Ìï¥Îãπ Ìñâ Ï∞æÍ∏∞
                        let dataSource = _this.grid.itemsSource instanceof wijmo.collections.CollectionView
                            ? _this.grid.itemsSource.sourceCollection
                            : _this.grid.itemsSource;
                        let updatedItem = dataSource[parseInt(_this.selectedIndex)];

                        console.log('res.data', res.data);

                        if (updatedItem) {
                            // `good_qty` Í∞í ÏóÖÎç∞Ïù¥Ìä∏
                            updatedItem.good_qty = res.data.good_qty_sum;
                            updatedItem.defect_qty = res.data.defect_qty_sum;

                            // 3. Wijmo GridÏóê Î≥ÄÍ≤ΩÏÇ¨Ìï≠ Î∞òÏòÅ
                            _this.grid.collectionView.commitEdit(); // Îç∞Ïù¥ÌÑ∞ Î≥ÄÍ≤Ω ÌôïÏ†ï
                            _this.grid.invalidate(); // ÌôîÎ©¥ Îã§Ïãú Í∑∏Î¶º (Í∞ïÏ†ú ÏÉàÎ°úÍ≥†Ïπ® X)
                        }

                        _this.showBasicInfo(res.data.jr_pk);

                        // Î≥ÄÍ≤Ω ÏÇ¨Ìï≠ Î∞òÏòÅ
                        _this.chasuGrid.collectionView.refresh();
                    } else {
                        Alert.alert('Ï∞®Ïàò ÏÇ≠Ï†ú Ïò§Î•ò', res.message);
                    }
                };

                let lastChasu = Math.max(...this.chasuGrid.collectionView.items.map(item => item.chasu));
                let lastItem = this.chasuGrid.collectionView.items.find(item => item.chasu === lastChasu);
                if (lastItem) {
                    Alert.confirm(
                        'Ï∞®Ïàò ÏÇ≠Ï†ú',
                        `ÎßàÏßÄÎßâ Ï∞®Ïàò(${lastChasu}Ï∞®Ïàò) ${lastItem.lot_no}Î•º ÏÇ≠Ï†úÌïòÏãúÍ≤†ÏäµÎãàÍπå?`,
                        function () {
                            let data = {'jr_pk': jr_pk};
                            AjaxUtil.postAsyncData(url, data, fnSuccess);
                        }
                    );
                }
            }


            // Ï∞®Ïàò ÏàòÎüâ Î≥ÄÍ≤Ω Ï†ÄÏû•, ÏÑ†ÌÉùÎêú Ï∞®ÏàòÎßå ÏóÖÎç∞Ïù¥Ìä∏
            saveChasu() {
                let _this = this;
                let items = this.chasuGrid.selectedItems;

                if (items.length === 0) {
                    return;
                }

                let jr_pk = _this.$tabBasic.find('#id').val();
                let item = items[0];
                let mp_id = item.id;
                let good_qty = item.good_qty;
                let defect_qty = item.defect_qty;

                if (good_qty === "0" || good_qty === "") {
                    Alert.alert('Ï∞®Ïàò ÏñëÌíàÎüâ ÏàòÏ†ï', 'ÏûòÎ™ªÎêú ÏàòÎüâÏùÑ ÏûÖÎ†•ÌïòÏÖ®ÏäµÎãàÎã§.');
                    return;
                }

                let data = {
                    jr_pk: jr_pk,
                    mp_id: mp_id,
                    good_qty: good_qty,
                    defect_qty: defect_qty
                };

                let fnSuccess = function (res) {
                    if (res.success) {
                        // result.good_qty_sum, result.defect_qty_sum, result.lot_number
                        Alert.alert('', 'ÏàòÏ†ï ÎêòÏóàÏäµÎãàÎã§');
                        _this.showChasuList(res.data.jr_pk);

                        // Wijmo GridÏóêÏÑú Ìï¥Îãπ Ìñâ Ï∞æÍ∏∞
                        let dataSource = _this.grid.itemsSource instanceof wijmo.collections.CollectionView
                            ? _this.grid.itemsSource.sourceCollection
                            : _this.grid.itemsSource;
                        let updatedItem = dataSource[parseInt(_this.selectedIndex)];

                        if (updatedItem) {
                            // `good_qty` Í∞í ÏóÖÎç∞Ïù¥Ìä∏
                            updatedItem.good_qty = res.data.good_qty_sum;
                            updatedItem.defect_qty = res.data.defect_qty_sum;

                            // 3. Wijmo GridÏóê Î≥ÄÍ≤ΩÏÇ¨Ìï≠ Î∞òÏòÅ
                            _this.grid.collectionView.commitEdit(); // Îç∞Ïù¥ÌÑ∞ Î≥ÄÍ≤Ω ÌôïÏ†ï
                            _this.grid.invalidate(); // ÌôîÎ©¥ Îã§Ïãú Í∑∏Î¶º (Í∞ïÏ†ú ÏÉàÎ°úÍ≥†Ïπ® X)
                        }

                        _this.showBasicInfo(res.data.jr_pk);
                    } else {
                        Alert.alert('', res.message);
                    }
                };
                let url = this.baseUrl + '/chasu_save';
                AjaxUtil.postAsyncData(url, data, fnSuccess);
            }

            object_copy(val) {
                var coped_object = {};
                for (var i in val) {
                    coped_object[i] = val[i];
                }
                return coped_object;
            }

            showBarcode() {
                let _this = this;
                // Î∞îÏΩîÎìú Ï∂úÎ†•
                // ÏûëÏóÖÏßÄÏãúÎ≤àÌò∏ Î∞îÏΩîÎìú ÏÑ§Ï†ï
                //
                let select_jr = _this.grid.selectedItems[0];
                let select_chasu = _this.chasuGrid.selectedItems;
                let select_jr_array = []
                let totalHtml = []

                if (select_chasu.length > 0) {
                    for (var i = 0; i < select_chasu.length; i++) {
                        select_jr_array.push(this.object_copy(select_jr))
                        select_jr_array[i]['chasu_good_qty'] = select_chasu[i].good_qty;

                    }
                }

                let content = tmpl('barcode_tmpl', select_jr);
                let $content = $(content);

                // Î∞îÏΩîÎìú Í∞ØÏàòÎßåÌÅº Ï∂îÍ∞Ä
                for (var i = 0; i < select_jr_array.length; i++) {
                    $content.find('#barcodeArea').append(
                        "<div class='col-12'>"
                        + "<div class='title_box'>"
                        + "   <div class='left_align'>"
                        + "        Lot number"
                        + "        <button type='button' class='btn-cancel' id='btnPrintLotNumberBarcode' data-labelCd='ÌîÑÎ¶∞Ìä∏'>ÌîÑÎ¶∞Ìä∏</button>"
                        + "    </div>"
                        + "</div>"
                        + "<div class='col-12' id='LotNumberContainerDiv'>"
                        + "    <table class='table_1' style='width: 400px;border-collapse: collapse;'>"
                        + "        <tr>"
                        + "            <td class='tac'>ÌíàÎ™©ÏΩîÎìú</td>"
                        + "            <td>" + select_jr_array[i].mat_code + "</td>                                 "
                        + "          <td class='tac'>ÏõåÌÅ¨ÏÑºÌÑ∞</td>                               "
                        + "          <td>" + select_jr_array[i].workcenter + "</td>                                  "
                        + "      </tr>                                                           "
                        + "      <tr>                                                            "
                        + "          <td class='tac'>ÏÉùÏÇ∞ÌíàÎ™Ö</td>                               "
                        + "          <td colspan='3'>" + select_jr_array[i].mat_name + "</td>                        "
                        + "      </tr>                                                           "
                        + "      <tr>                                                            "
                        + "          <td class='tac'>ÏñëÌíàÏàòÎüâ</td>                               "
                        + "          <td>" + select_jr_array[i].chasu_good_qty + "</td>                              "
                        + "          <td class='tac'>ÏÉùÏÇ∞Îã®ÏúÑ</td>                               "
                        + "          <td>" + select_jr_array[i].unit + "</td>                                        "
                        + "      </tr>                                                           "
                        + "                                                                      "
                        + "      <tr>                                                            "
                        + "          <td class='tac'>ÏÉùÏÇ∞ÏùºÏûê</td>                               "
                        + "          <td colspan='3'>" + select_jr_array[i].prod_date + " " + select_chasu[i].input_time + "</td>       "
                        + "      </tr>                                                           "
                        + "      <tr>                                                            "
                        + "          <td class='tac'>Ïú†Ìö®Í∏∞Ìïú</td>                               "
                        + "          <td colspan='3'>" + select_jr_array[i].ValidDays + "</td>                       "
                        + "      </tr>                                                           "
                        + "      <tr>                                                            "
                        + "          <td colspan='4' class='barcode_td'>                         "
                        + "              <svg id='svgBarcodeLotNumber'></svg>                    "
                        + "          </td>                                                       "
                        + "      </tr>                                                           "
                        + "  </table>                                                            "
                        + "                                                                      "
                        + "        </div>"
                        + "    </div> "
                    )
                }

                let modalContainer = null;
                modalContainer = new PopupDraggable('Î∞îÏΩîÎìú Ï∂úÎ†•');
                modalContainer.open({width: 600, height: 650, $content});

                // scroll Ï≤òÎ¶¨
                $('.ax-modal-body').css('overflow', 'auto');

                let $workOrderContainerDiv = $content.find('#workOrderContainerDiv');

                //order_num
                let barcodeLabelText = select_jr.order_num + "(" + select_jr.mat_name + ")";

                $content.find('#svgBarcodeWorkOrderNumber').JsBarcode(select_jr.order_num, {
                    format: 'code128', // Î∞îÏΩîÎìú Ìè¨Îß∑ / default: code128 / options: EAN, UPC, CODE39, ITF-14, MSI, Pharmacode, Codabar (Í∞Å ÏòµÏÖòÎì§Ïóê ÎåÄÌïú ÏÑ§Î™ÖÏùÄ ÏÇ¨Ïù¥Ìä∏ Ï∞∏Ï°∞)
                    width: 2, // ÎÑàÎπÑ / default: 2
                    height: 100, // ÎÜíÏù¥ / default: 100
                    displayValue: true, // ÌÖçÏä§Ìä∏ ÌëúÏãú Ïó¨Î∂Ä / default: true
                    text: barcodeLabelText, // Îç∞Ïù¥ÌÑ∞ ÎåÄÏã† ÌäπÏ†ï ÌÖçÏä§Ìä∏ ÌëúÏãú / default: undefined
                    fontOptions: '', // Ìè∞Ìä∏ ÏÑ§Ï†ï / default: '' / options: bold, italic, bold italic
                    font: 'monospace', // Ìè∞Ìä∏ / default: monospace / options: fantasy, etc... ÏÇ¨Ïù¥Ìä∏ Ï∞∏Ï°∞
                    textAlign: 'center', // ÌÖçÏä§Ìä∏ ÏúÑÏπò / default: center / options: left, center, right
                    textPosition: 'bottom', // ÌÖçÏä§Ìä∏ ÏúÑÏπò / default: bottom / options: top, bottom
                    textMargin: 2, // Î∞îÏΩîÎìúÏôÄ ÌÖçÏä§Ìä∏ ÏÇ¨Ïù¥ Ïó¨Î∞± / default: 2
                    fontSize: 12, // Ìè∞Ìä∏ ÌÅ¨Í∏∞ / default: 20
                    background: '#ffffff', // Î∞îÏΩîÎìú Î∞∞Í≤Ω ÏÉâ / default: #ffffff
                    lineColor: '#000000', // Î∞îÏΩîÎìú ÎùºÏù∏ ÏÉâ / default: #000000
                    margin: 10, // Î∞îÏΩîÎìú ÏòÅÏó≠ Ï£ºÎ≥Ä Ïó¨Î∞± / default: 10
                });

                $content.find('#btnPrintWorkOrderBarcode').click(function (e) {
                    let popupWindow = window.open("barcode_print", "_blank", "width=800px");
                    let css = $('#print_css')[0].outerHTML;

                    let html = $workOrderContainerDiv.html();
                    popupWindow.document.write(css);
                    popupWindow.document.write(html);
                    popupWindow.print();
                    return false;
                });

                totalHtml.push($workOrderContainerDiv.html())

                for (var i = 0; i < select_jr_array.length; i++) {
                    let lotContainer = $content.find('#LotNumberContainerDiv').eq(i)


                    let $LotNumberContainerDiv = lotContainer

                    if (select_chasu.length > 0) {
                        barcodeLabelText = select_chasu[i].lot_no + "(" + select_jr_array[i].mat_name + ")";
                        $content.find("#svgBarcodeLotNumber").eq(i).JsBarcode(select_chasu[i].lot_no, {
                            format: 'code128', // Î∞îÏΩîÎìú Ìè¨Îß∑ / default: code128 / options: EAN, UPC, CODE39, ITF-14, MSI, Pharmacode, Codabar (Í∞Å ÏòµÏÖòÎì§Ïóê ÎåÄÌïú ÏÑ§Î™ÖÏùÄ ÏÇ¨Ïù¥Ìä∏ Ï∞∏Ï°∞)
                            width: 2, // ÎÑàÎπÑ / default: 2
                            height: 100, // ÎÜíÏù¥ / default: 100
                            displayValue: true, // ÌÖçÏä§Ìä∏ ÌëúÏãú Ïó¨Î∂Ä / default: true
                            text: barcodeLabelText, // Îç∞Ïù¥ÌÑ∞ ÎåÄÏã† ÌäπÏ†ï ÌÖçÏä§Ìä∏ ÌëúÏãú / default: undefined
                            fontOptions: '', // Ìè∞Ìä∏ ÏÑ§Ï†ï / default: '' / options: bold, italic, bold italic
                            font: 'monospace', // Ìè∞Ìä∏ / default: monospace / options: fantasy, etc... ÏÇ¨Ïù¥Ìä∏ Ï∞∏Ï°∞
                            textAlign: 'center', // ÌÖçÏä§Ìä∏ ÏúÑÏπò / default: center / options: left, center, right
                            textPosition: 'bottom', // ÌÖçÏä§Ìä∏ ÏúÑÏπò / default: bottom / options: top, bottom
                            textMargin: 2, // Î∞îÏΩîÎìúÏôÄ ÌÖçÏä§Ìä∏ ÏÇ¨Ïù¥ Ïó¨Î∞± / default: 2
                            fontSize: 12, // Ìè∞Ìä∏ ÌÅ¨Í∏∞ / default: 20
                            background: '#ffffff', // Î∞îÏΩîÎìú Î∞∞Í≤Ω ÏÉâ / default: #ffffff
                            lineColor: '#000000', // Î∞îÏΩîÎìú ÎùºÏù∏ ÏÉâ / default: #000000
                            margin: 10, // Î∞îÏΩîÎìú ÏòÅÏó≠ Ï£ºÎ≥Ä Ïó¨Î∞± / default: 10
                        });

                        $content.find('#btnPrintLotNumberBarcode').eq(i).click(function (e) {
                            let popupWindow = window.open("barcode_print", "_blank", "width=800px");
                            let css = $('#print_css')[0].outerHTML;

                            let html = $LotNumberContainerDiv.html();
                            popupWindow.document.write(css);
                            popupWindow.document.write(html);
                            popupWindow.print();
                            return false;
                        });
                    }

                    totalHtml.push($LotNumberContainerDiv.html())
                }
                $content.find('#modal-printAll-button').click(function (e) {
                    let popupWindow = window.open("barcode_print", "_blank", "width=800px");
                    let css = $('#print_css')[0].outerHTML;

                    let html = totalHtml;

                    popupWindow.document.write(css);
                    popupWindow.document.write(html);
                    popupWindow.print();
                    return false;
                });
            }

            // Î∂ÄÏ†ÅÌï©Î™©Î°ù Ï°∞Ìöå
            showDefectList(type) {
                let _this = this;

                let jr_pk = _this.grid.selectedItems[0].id
                let workcenter_id = _this.grid.selectedItems[0].workcenter_id

                let param = {
                    'jr_pk': jr_pk,
                    'workcenter_id': workcenter_id,
                    'type': type
                }

                if (type === 'chasu') {
                    param['chasu'] = _this.chasuGrid.selectedItems[0].chasu
                }

                let result = AjaxUtil.getSyncData(this.baseUrl + '/defect_list', param);
                if (result.data) {
                    console.log('showDefectListÏùò result.data', result.data);
                    let count = result.data.length;

                    _this.defectGrid.itemsSource = result.data;
                    let chasu_def_qty = 0;
                    for (let i = 0; i < count; i++) {
                        if (_this.defectGrid.selectedItems[i]) { // ÏÑ†ÌÉùÎêú ÏïÑÏù¥ÌÖúÏù¥ ÏûàÎäî Í≤ΩÏö∞Îßå
                            chasu_def_qty += parseFloat(_this.defectGrid.selectedItems[i].defect_qty || 0);
                        }
                    }
                }
            }

            // Î∂ÄÏ†ÅÌï©Î™©Î°ù Ï†ÄÏû•
            saveDefectList(defectGridList, action) {
                let _this = this;

                if (defectGridList.length === 0) {
                    Alert.alert('ÏïåÎ¶º', 'ÏàòÏ†ïÎêú Îç∞Ïù¥ÌÑ∞Í∞Ä ÏóÜÏäµÎãàÎã§.');
                    return;
                }

                let url = this.baseUrl + '/defect_save';
                let jr_pk = $('#tabBasic').find('#id').val();
                let workcenterId = $('#tabBasic').find('#workcenter_id').val();

                let defectList = [];
                let dataDefault = {
                    'defect_id': '',
                    'defect_type': '',
                    'defect_qty': '',
                    'defect_remark': '',
                }

                defectGridList.forEach(function (item) {
                    let defectItem = {};
                    $.each(dataDefault, function (key) {
                        defectItem[key] = item[key]
                    });

                    if (!defectItem.defect_qty) {
                        defectItem.defect_qty = 0;
                    }

                    defectList.push(defectItem);
                });

                console.log('saveDefectListÏùò defectGridList', defectGridList);


                let data = {
                    'jr_pk': jr_pk,
                    'defect_list': JSON.stringify(defectList),
                }

                let fnSuccess = function (res) {
                    if (res.success) {
                        if (action !== 'workStart') {
                            Notify.success('Ï†ÄÏû•ÎêòÏóàÏäµÎãàÎã§');
                        }
                        $('#tabBasic').find('#defect_qty').val(res.data.total_defect);
                        // ÏÑ†ÌÉùÎêú Ìï≠Î™© Í∞ÄÏ†∏Ïò§Í∏∞
                        let selectedItem = _this.grid.selectedItems[0];
                        if (selectedItem) {
                            // Îç∞Ïù¥ÌÑ∞ ÏàòÏ†ï
                            selectedItem.defect_qty = res.data.total_defect;

                            // Î≥ÄÍ≤Ω ÏÇ¨Ìï≠ Î∞òÏòÅ
                            if (!(_this.grid.itemsSource instanceof wijmo.collections.CollectionView)) {
                                _this.grid.itemsSource = new wijmo.collections.CollectionView(_this.grid.itemsSource);
                            }
                            _this.grid.itemsSource.refresh();
                        }
                        _this.showDefectList('total');
                    } else {
                        Alert.alert('Î∂ÄÏ†ÅÌï©Ìíà Îì±Î°ù', res.message);
                    }
                }

                AjaxUtil.postAsyncData(url, data, fnSuccess);
            }

            getModifiedList() {
                // ÏµúÏã† Î≥ÄÍ≤Ω ÏÇ¨Ìï≠ÏùÑ Î∞òÏòÅÌïòÍ∏∞ ÏúÑÌï¥ `commitEdit()` Ìò∏Ï∂ú
                this.defectGrid.collectionView.commitEdit();

                return this.modifiedItems.length > 0 ? [...this.modifiedItems] : [];
            }


            // Ìà¨ÏûÖÎ™©Î°ù Ï°∞Ìöå
            showConsumedList(jr_pk, prod_pk, prodDate) {

                let _this = this;

                let param = {
                    'jr_pk': jr_pk,
                    'prod_pk': prod_pk,
                    'prod_date': prodDate,

                };

                let result = AjaxUtil.getSyncData(this.baseUrl + '/consumed_list', param);
                if (result.data != null) {
                    _this.consumedGrid.itemsSource = result.data;


                    let goodQty = parseFloat($('#tabBasic').find('#good_qty').val());
                    let defectQty = parseFloat($('#tabBasic').find('#defect_qty').val());
                    let lossQty = parseFloat($('#tabBasic').find('#loss_qty').val());
                    let scrapQty = parseFloat($('#tabBasic').find('#scrap_qty').val());

                    if (isNaN(goodQty)) goodQty = 0;
                    if (isNaN(defectQty)) defectQty = 0;
                    if (isNaN(lossQty)) lossQty = 0;
                    if (isNaN(scrapQty)) scrapQty = 0;

                    let totalProdQty = goodQty + defectQty + lossQty + scrapQty;
                    //$('#lblTotalOutput').text(totalProdQty.toLocaleString());
                }
            }

            // Ìà¨ÏûÖÎ™©Î°ù Ï†ÄÏû•
            saveConsumedList() {
                let _this = this;

                let url = this.baseUrl + '/consumed_save';
                let jr_pk = $('#tabBasic').find('#id').val();
                let mp_pk = $('#tabBasic').find('#mp_id').val();
                let prodDate = $('#tabBasic').find('#prod_date').val();
                let bom_output_amount = $('#bom_output_amount').val();
                let gridDataList = this.consumedGrid.sourceCollection;
                let consumedList = [];
                let dataDefault = {
                    'mat_pk': '',
                    'bom_consumed': '',
                    'consumed_qty': '',
                    'consumed': '',
                    'consumed_start': '',
                    'consumed_end': '',
                }

                if (gridDataList.length == 0) {
                    Alert.alert('', 'ÌíàÎ™©ÏùÑ Ï∂îÍ∞ÄÌï¥Ï£ºÏÑ∏Ïöî.');
                    return;
                }

                for (var i = 0; i < gridDataList.length; i++) {
                    let item = gridDataList[i];
                    let consumedItem = {};

                    $.each(dataDefault, function (key) {
                        if (item[key]) {
                            consumedItem[key] = item[key];
                        } else {
                            consumedItem[key] = '';
                        }
                    });

                    consumedList.push(consumedItem);
                }

                let data = {
                    'jr_pk': jr_pk,
                    'mp_pk': mp_pk,
                    'prod_date': prodDate,
                    'bom_output_amount': bom_output_amount,
                    'Q': JSON.stringify(consumedList)
                };

                let fnSuccess = function (res) {
                    if (res.success) {
                        Notify.success('Ï†ÄÏû•ÎêòÏóàÏäµÎãàÎã§');
                        _this.showConsumedList(jr_pk);
                    }
                }

                AjaxUtil.postAsyncData(url, data, fnSuccess);
            }

            // Ìà¨ÏûÖÎ™©Î°ù ÌíàÎ™©Ï∂îÍ∞Ä
            addMaterial() {
                let _this = this;

                if (this.jobres.state === "ordered") {
                    Alert.alert('LOT Ìà¨ÏûÖÏò§Î•ò', 'ÏûëÏóÖÏù¥ ÏãúÏûëÎêòÏßÄ ÏïäÏïòÏäµÎãàÎã§.');
                    return;
                }


                let valid = true;
                let matList = this.consumedGrid.sourceCollection;
                let poppage = new PopupMaterialPage();
                let addColumn = {};

                let searchcallback = function (mat) {
                    matList.forEach(function (item) {
                        if (mat.id === item.mat_pk) {
                            valid = false;
                        }
                    });

                    if (valid) {
                        addColumn['mat_pk'] = mat.id;
                        addColumn['mat_name'] = mat.Name;
                        addColumn['unit'] = mat.unit_name;
                        addColumn['bom_consumed'] = '';
                        addColumn['consumed'] = '';
                        addColumn['consumed_start'] = '';
                        addColumn['consumed_end'] = '';

                        _this.consumedGrid.addRow(
                            addColumn,
                            'last',
                            {focus: 'END'}
                        );
                    } else {
                        Alert.alert('', 'Ìï¥Îãπ ÌíàÎ™©ÏùÄ Ïù¥ÎØ∏ Ï∂îÍ∞ÄÎêòÏñ¥ÏûàÏäµÎãàÎã§.');
                    }
                };

                poppage.show(searchcallback);
            }

            // Ìà¨ÏûÖÎ°úÌä∏Î™©Î°ù
            addMaterialLot() {
                let _this = this;
                let jr_pk = $('#tabBasic').find('#id').val();

                let valid = true;
                let poppage = new PopupConsumMatLotPage();
                let lot_info = {};

                let searchcallback = function (lot) {
                    if (lot.length === 1) {
                        // Îã®Ïùº Î°úÌä∏Ìà¨ÏûÖ
                        if (valid) {
                            lot_info['lot_id'] = lot[0].id;
                            lot_info['lot_number'] = lot[0].lot_number;
                            lot_info['input_qty'] = lot[0].input_qty;

                            $('#txtInputLot').val(lot[0].lot_number);
                            _this.showLotInput(lot[0].lot_number);

                        } else {
                            Alert.alert('', 'Ìï¥Îãπ Î°úÌä∏Îäî Ïù¥ÎØ∏ Ï∂îÍ∞ÄÎêòÏñ¥ÏûàÏäµÎãàÎã§.');
                        }
                    } else if (lot.length > 1) {
                        _this.multiSaveLotInput(lot);
                    }
                };

                poppage.show(jr_pk, searchcallback);
            }

            // Ìà¨ÏûÖÎ°úÌä∏ÏÇ≠Ï†ú
            delMaterialLot() {
                let _this = this;
                let select_grid = _this.inputLotGrid.selectedItems;
                let jr_pk = $('#tabBasic').find('#id').val();
                let url = this.baseUrl + '/del_lot_list';

                if (select_grid.length === 0) {
                    Alert.alert('', 'Ìà¨ÏûÖÏöîÏ≤≠ Ï†úÏô∏Ìï† Í∑∏Î¶¨ÎìúÎ•º ÏÑ†ÌÉùÌï¥Ï£ºÏÑ∏Ïöî.');
                    return;
                }
                if (select_grid[0].consumed_qty > 0) {
                    Alert.alert('', 'Ïù¥ÎØ∏ Ìà¨ÏûÖÎêú ÏöîÏ≤≠ÎÇ¥Ïó≠ÏùÄ ÏÇ≠Ï†úÌï† Ïàò ÏóÜÏäµÎãàÎã§.');
                    return;
                }

                let mpi_pk = select_grid[0].mpi_id
                let data = {
                    'mpi_pk': mpi_pk,
                }

                let fnSuccess = function (res) {
                    if (res.success) {
                        Notify.success('ÏÇ≠Ï†úÎêòÏóàÏäµÎãàÎã§.');
                        _this.showInputLotList();

                        _this.showConsumedList(jr_pk);

                        $('#txtInputLot').val('');
                    } else {
                        Alert.alert('', res.message);
                    }
                }

                Alert.confirm('Ìà¨ÏûÖÏöîÏ≤≠ÎÇ¥Ïó≠ ÏÇ≠Ï†ú', 'ÌòÑÏû¨ Ìà¨ÏûÖÏöîÏ≤≠ÎÇ¥Ïó≠ÏùÑ(Î°úÌä∏Î≤àÌò∏ : ' + select_grid[0].lot_number + ')Î•º ÏÇ≠Ï†úÌïòÏãúÍ≤†ÏäµÎãàÍπå?',
                    function () {
                        AjaxUtil.postAsyncData(url, data, fnSuccess);
                    },
                    function () {
                    }
                )
            }

            // Ìà¨ÏûÖÎ°úÌä∏Ï†ïÎ≥¥
            showLotInput(lot_number) {
                let _this = this;

                if (this.jobres.state == "ordered") {
                    Alert.alert('LOT Ìà¨ÏûÖÏò§Î•ò', 'ÏûëÏóÖÏù¥ ÏãúÏûëÎêòÏßÄ ÏïäÏïòÏäµÎãàÎã§.');
                    return;
                }

                let valid = true;
                //let matList = this.consumedGrid.getList();
                let poppage = new PopupLotInputPage();
                let lot_info = {};

                let callback = function (lot) {
                    if (valid) {
                        lot_info['lot_id'] = lot.lot_id;
                        lot_info['lot_number'] = lot.lot_number;
                        lot_info['input_qty'] = lot.input_qty;

                        _this.saveLotInput(lot.lot_id, lot.input_qty);
                    } else {
                        Alert.alert('', 'Ìï¥Îãπ Î°úÌä∏Îäî Ïù¥ÎØ∏ Ï∂îÍ∞ÄÎêòÏñ¥ÏûàÏäµÎãàÎã§.');
                    }
                };

                poppage.show(lot_number, callback);
            }

            multiSaveLotInput(lot) {
                let _this = this;

                if (this.jobres.state == "ordered") {
                    Alert.alert('LOT Ìà¨ÏûÖÏò§Î•ò', 'ÏûëÏóÖÏù¥ ÏãúÏûëÎêòÏßÄ ÏïäÏïòÏäµÎãàÎã§.');
                    return;
                }

                let url = this.baseUrl + '/multi_add_lot_input';
                let jr_pk = $('#tabBasic').find('#id').val();
                let mp_pk = $('#tabBasic').find('#mp_id').val();

                let data = {
                    'jr_pk': jr_pk,
                    'mp_pk': mp_pk,
                    'Q': JSON.stringify(lot),
                };

                let fnSuccess = function (res) {
                    if (res.success) {
                        Notify.success('Ï†ÄÏû•ÎêòÏóàÏäµÎãàÎã§');
                        _this.showInputLotList();

                        _this.showConsumedList(jr_pk);

                        $('#txtInputLot').val('');
                    } else {
                        Alert.alert('', res.message);
                    }
                }

                AjaxUtil.postAsyncData(url, data, fnSuccess);

            }

            // Ìà¨ÏûÖÎ°úÌä∏ Ï†ÄÏû•
            saveLotInput(lot_id, input_qty) {
                let _this = this;

                let url = this.baseUrl + '/add_lot_input';
                let jr_pk = $('#tabBasic').find('#id').val();
                let mp_pk = $('#tabBasic').find('#mp_id').val();

                let data = {
                    'jr_pk': jr_pk,
                    'mp_pk': mp_pk,
                    'lot_id': lot_id,
                    'input_qty': input_qty,
                };

                let fnSuccess = function (res) {
                    if (res.success) {
                        Notify.success('Ï†ÄÏû•ÎêòÏóàÏäµÎãàÎã§');
                        _this.showInputLotList();

                        _this.showConsumedList(jr_pk);

                        $('#txtInputLot').val('');
                    } else {
                        Alert.alert('', res.message);
                    }
                }

                AjaxUtil.postAsyncData(url, data, fnSuccess);
            }

            // Ìà¨ÏûÖÎ°úÌä∏ Ï°∞Ìöå
            showInputLotList() {
                let _this = this;
                let jr_pk = this.jobres.id;

                let param = {
                    'jr_pk': jr_pk,
                };

                let result = AjaxUtil.getSyncData(this.baseUrl + '/input_lot_list', param);
                if (result.success) {
                    _this.inputLotGrid.itemsSource = result.data
                    _this.updateFooter();
                }
            }

            //Ï†úÌíà Í≤ÄÏÇ¨
            showInputTestPopup() {
                let _this = this;
                let jr_pk = $('#tabBasic').find('#id').val();
                if (!jr_pk > 0) {
                    Alert.alert('Ï†úÌíàÍ≤ÄÏÇ¨', 'Ï†úÌíà Îç∞Ïù¥ÌÑ∞Î•º ÏÑ†ÌÉùÌï¥ Ï£ºÏÑ∏Ïöî. ', function () {
                    });
                    return;
                }
                let items = _this.grid.selectedItems;
                let item = items[0];
                let content = tmpl('inputTestPopup', {});
                let $content = $(content);
                let modalContainer = new PopupDraggable('Ï†úÌíàÍ≤ÄÏÇ¨');
                modalContainer.open({width: 1000, height: 670, $content});

                this.prodTestGrid = new wijmo.grid.FlexGrid('#prod_test_grid', {
                    autoGenerateColumns: false,
                    selectionMode: wijmo.grid.SelectionMode.Row,
                    frozenColumns: 0,
                    frozenRows: 0,
                    allowSorting: true,
                    headersVisibility: wijmo.grid.HeadersVisibility.Column,
                    formatItem: (s, e) => {
                        if (e.panel.cellType === wijmo.grid.CellType.RowHeader) {
                            // Ìó§ÎçîÏóê ÏàúÎ≤à
                            e.cell.textContent = (e.row + 1).toString();
                        }
                        if (e.panel.cellType === wijmo.grid.CellType.ColumnHeader) {
                            e.cell.style.textAlign = 'center';
                        }
                        // Ìó§Îçî Ïä§ÌÉÄÏùº Ï†ÅÏö©
                        if (e.panel.cellType === wijmo.grid.CellType.ColumnHeader
                            && s.columns[e.col].binding === 'result1' || s.columns[e.col].binding === 'result2') {
                            e.cell.style.color = '#5567ff'; // Í∏ÄÏûê ÏÉâÍπî Î≥ÄÍ≤Ω
                        }
                        if (e.panel.cellType === wijmo.grid.CellType.Cell) {
                            const col = s.columns[e.col];
                            const item = e.panel.rows[e.row].dataItem;

                            // result1 Ïó¥
                            if (col.binding === 'result2') {
                                e.cell.style.backgroundColor = item.result1 === 'X' ? '#ffd800' : '';
                            }
                        }

                    },
                    columns: [
                        {binding: 'name', header: 'Í≤ÄÏÇ¨Ìï≠Î™©', width: 130, align: 'left'},
                        {binding: 'specText', header: 'Í≤ÄÏÇ¨Í∏∞Ï§Ä', width: 130, align: 'left'},
                        {binding: 'result1', header: 'Í≤ÄÏÇ¨Í≤∞Í≥º(ÏûÖÎ†•)', width: 300, align: 'left', isReadOnly: false},
                        {binding: 'result2', header: 'ÌåêÏ†ïÍ≤∞Í≥º(Ï†ÅÌï©/Î∂ÄÏ†ÅÌï©)', width: 150, align: 'center'}
                    ],
                    itemsSource: new wijmo.collections.CollectionView([]),
                });

                this.prodTestGrid.addEventListener(this.prodTestGrid.hostElement, 'click', (e) => {
                    const ht = this.prodTestGrid.hitTest(e);
                    if (ht.cellType === wijmo.grid.CellType.Cell) {
                        const col = this.prodTestGrid.columns[ht.col];
                        const item = this.prodTestGrid.rows[ht.row]?.dataItem;

                        if (col.binding === 'result2') {
                            // Îç∞Ïù¥ÌÑ∞ Í∞íÏùÑ ÌÜ†Í∏Ä
                            item.result2 = item.result2 === 'O' ? 'X' : 'O';
                            // Î≥ÄÍ≤ΩÎêú Í∞íÏùÑ Î∞òÏòÅ
                            this.prodTestGrid.collectionView.refresh();
                        }
                    }
                });

                let $OrderNum = $content.find('#OrderNum');
                let $MaterialTypeName = $content.find('#MaterialTypeName');
                let $MaterialName = $content.find('#MaterialName');
                let $MaterialCode = $content.find('#MaterialCode');
                let $btnTestSave = $content.find('#btnTestSave');
                let $btnAllItem = $content.find('#btnAllItem');
                let $TestDate = $content.find('#TestDate');
                let $TestName = $content.find('#TestName');
                let $judgGroup = $content.find('#judgGroup');
                let $ctRemark = $content.find('#ctRemark');
                let $ntRemark = $content.find('#ntRemark');
                let $cboTestMaster = $content.find('#cboTestMaster');
                let $testResultId = $content.find('#testResultId');

                $MaterialTypeName.val(item.mat_type);
                $MaterialName.val(item.mat_name);
                $MaterialCode.val(item.mat_code);
                $OrderNum.val(item.order_num);

                $TestDate.val(CommonUtil.getYYYYMMDD());
                $TestName.val(userinfo.username);

                AjaxUtil.fillSelectOptions($cboTestMaster, 'test_master', 'choose', false, '');
                // $cboTestMaster.val(13)
                AjaxUtil.fillSelectOptions($judgGroup, 'system_code', 'choose', false, 'judg_code');

                let fnLoadTestList = function (jr_pk) {
                    let fnsuccess = function (result) {
                        if (result.data !== null) {
                            _this.prodTestGrid.itemsSource.sourceCollection = result.data.pdList;

                            if (result.data.testDate != null) {
                                $TestDate.val(result.data.testDate);
                            }
                            if (result.data.CheckName != null) {
                                $TestName.val(result.data.CheckName);
                            }
                            if (result.data.testResultId != null) {
                                $testResultId.val(result.data.testResultId);
                            }

                            // Í≤ÄÏÇ¨ Ïú†Ìòï Í∞ïÏ†ú ÏÑ§Ï†ï ÌõÑ ÎπÑÌôúÏÑ±Ìôî
                            if (result.data.testMasterId != null) {
                                $cboTestMaster.val(result.data.testMasterId).prop("disabled", true);
                            } else {
                                $cboTestMaster.val("").prop("disabled", true); // Í≤ÄÏÇ¨ Ïú†ÌòïÏù¥ ÏóÜÏúºÎ©¥ ÎπÑÌôúÏÑ±Ìôî
                            }

                            $judgGroup.val(result.data.JudgeCode);
                            $ntRemark.val(result.data.ntRemark);
                            $ctRemark.val(result.data.ctRemark);
                        }
                    };

                    let testParam = {
                        jr_pk: jr_pk,
                        action: 'prod_test_list'
                    };
                    AjaxUtil.getAsyncData(_this.baseUrl + '/prod_test_list', testParam, fnsuccess);
                };

                // fnLoadTestList Ïã§Ìñâ (ÏÑúÎ≤Ñ Îç∞Ïù¥ÌÑ∞ Î°úÎìú ÌõÑ Í≤ÄÏÇ¨Ïú†Ìòï Í∞íÏù¥ ÏÑ§Ï†ïÎê®)
                fnLoadTestList(jr_pk);

                // Ï†ÑÏ≤¥ Ï†ÅÌï© Î≤ÑÌäº
                $btnAllItem.click(function (e) {
                    _this.prodTestGrid.itemsSource.sourceCollection.forEach(function (item) {
                        item.result2 = 'O';
                    });
                    _this.prodTestGrid.collectionView.refresh();
                })

                // Ï†úÌíàÍ≤ÄÏÇ¨ Ï†ÄÏû•
                $btnTestSave.click(function (e) {
                    let testItems = _this.prodTestGrid.itemsSource.sourceCollection;

                    if (testItems.length === 0) {
                        Alert.alert('Ï†úÌíàÍ≤ÄÏÇ¨Ï†ÄÏû•', 'Ï†ÄÏû•Ìï† Ï†úÌíàÏù¥ ÏóÜÏäµÎãàÎã§.', function () {
                        });
                        return;
                    }

                    if ($cboTestMaster.val() === '') {
                        Alert.alert('Ï†úÌíàÍ≤ÄÏÇ¨Ï†ÄÏû•', 'Í≤ÄÏÇ¨Ïú†ÌòïÏùÑ ÏÑ†ÌÉùÌïòÏÑ∏Ïöî.', function () {
                        });
                        return;
                    }
                    let url = _this.baseUrl + '/test_save';
                    let sendData = {
                        jr_pk: jr_pk,
                        test_date: $TestDate.val(),
                        test_mast_id: $cboTestMaster.val(),
                        test_result_id: $testResultId.val(),
                        material_id: item.mat_pk,
                        judg_grp: $judgGroup.val(),
                        ctRemark: $ctRemark.val(),
                        ntRemark: $ntRemark.val(),
                        Q: JSON.stringify(testItems)
                    };

                    let testSaveCallback = function (result) {
                        if (result.success) {
                            Notify.success('Ï†ÄÏû•ÌñàÏäµÎãàÎã§.');
                            $content.find('#modal-close-button').click();
                        } else {
                            Notify.error('ÏóêÎü¨Í∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.');
                        }
                    };
                    AjaxUtil.postAsyncData(url, sendData, testSaveCallback);
                });
            }
        }

        let page = null;

        $(document).ready(function (e) {
            page = new ProdResultPage();

            let date_from = CommonUtil.getYYYYMMDD();
            let today = CommonUtil.getYYYYMMDD();
            page.today = today;

            $('#date_from').val(date_from);
            $('#date_to').val(today);


            // Î≥¥Í∏∞/Í∞êÏ∂îÍ∏∞ Î≤ÑÌäº
            $('#btnWorkListToggle').click(function (e) {
                $("#prodResultList").toggle(300);
            });
            $('#btnToggle').click(function (e) {
                $("#input_lot_div").toggle(300);
            });
            $("#input_lot_div").toggle(300);

            $('#btnTest').click(function (e) {
                page.showInputTestPopup();
            });

            // Í≤ÄÏÉâ Î≤ÑÌäº1
            $('#btnMainSearch').click(function (e) {
                page.jobres = null;
                page.searchMainData();
            });

            // tabÌÅ¥Î¶≠
            let target;
            $('.tab-links a').click(function (e) {
                let jr_pk = $('#tabBasic').find('#id').val();
                let workcenter_pk = $('#tabBasic').find('#workcenter_id').val();

                target = e.currentTarget.name;
                page.currentTab = target;

                if (target === 'tabDefect') {
                    if (jr_pk && workcenter_pk) page.showDefectList('total');
                } else if (target === 'tabConsumed') {
                    if (jr_pk) {
                        page.showInputLotList();
                        page.showConsumedList(jr_pk);
                    }
                }
            });

            // ÏÉùÏÇ∞Ï†ïÎ≥¥ Ï†ÄÏû•
            $('#btnSave').click(function (e) {
                page.saveBasicInfo();
            });

            // ÏÉùÏÇ∞Ï†ïÎ≥¥ ÏÇ≠Ï†ú
            $('#btnDel').click(function (e) {
                page.delBasicInfo();
            });

            // ÏûëÏóÖÏãúÏûë
            $('#btnWorkStart').click(function (e) {
                page.workStart();
            });

            // ÏûëÏóÖÏôÑÎ£å
            $('#btnWorkFinish').click(function (e) {
                page.workFinish();
            });

            // ÏûëÏóÖÏôÑÎ£åÏ∑®ÏÜå
            $('#btnFinishCancel').click(function (e) {
                page.workFinishCancel();
            });

            // Ï∞®ÏàòÏ∂îÍ∞Ä
            $('#btnAddChasu').click(function (e) {
                page.addChasu();
            });

            // Ï∞®ÏàòÏ†ÄÏû•
            $('#btnSaveChasu').click(function (e) {
                let chasuData = page.chasuGrid.itemsSource ? page.chasuGrid.itemsSource.sourceCollection : [];
                if (chasuData.length === 0) {
                    Alert.alert('', 'Ï∞®ÏàòÎ•º Ï∂îÍ∞ÄÌï¥Ï£ºÏÑ∏Ïöî.');
                } else {
                    page.saveChasu();
                }
            });

            // Ï∞®ÏàòÏÇ≠Ï†ú
            $('#btnDeleteChasu').click(function (e) {
                let chasuData = page.chasuGrid.itemsSource ? page.chasuGrid.itemsSource.sourceCollection : [];
                if (chasuData.length === 0) {
                    Alert.alert('', 'Ï∞®ÏàòÎ•º Ï∂îÍ∞ÄÌï¥Ï£ºÏÑ∏Ïöî.');
                } else {
                    page.deleteChasu();
                }
            });

            // Ï∞®Ïàò lotÎ∞îÏΩîÎìú ÌåùÏóÖ
            $('#btnLOTbarcode').click(function (e) {
                page.showBarcode();
            });
            // Ï∞®Ïàò lotÎ∞îÏΩîÎìú ÌåùÏóÖ
            $('#btnJRbarcode').click(function (e) {
                page.showBarcode();
            });

            // Ï†ÄÏû• Î©îÏÑúÎìú Ìò∏Ï∂ú
            $('#btnDefectSave').click(function (e) {
                const modifiedList = page.getModifiedList(); // ÏàòÏ†ïÎêú Îç∞Ïù¥ÌÑ∞ Í∞ÄÏ†∏Ïò§Í∏∞
                page.saveDefectList(modifiedList); // Ï†ÄÏû• Î©îÏÑúÎìú Ìò∏Ï∂ú
            });

            // Ìà¨ÏûÖÎÇ¥Ïó≠ Ï†ÄÏû•
            $('#btnConsumedSave').click(function (e) {
                page.saveConsumedList();
            });

            // ÌíàÎ™©Ï∂îÍ∞Ä
            $('#btnAddMat').click(function (e) {
                page.addMaterial();
            });

            // Ìà¨ÏûÖÎÇ¥Ïó≠ Ï°∞Ìöå
            $('#btnConsumedView').click(function (e) {
                let jr_pk = $('#tabBasic').find('#id').val();
                if (jr_pk)
                    page.showConsumedList(jr_pk);
            });

            $('#defect_qty').click(function (e) {
                $(".tab-wrap .tab-links [name='tabDefect']").trigger('click');
            });

            $('#btnInputLotList').click(function (e) {
                let jr_pk = $('#tabBasic').find('#id').val();
                page.showInputLotList();
            });

            $('#btnInputLotSelect').click(function (e) {
                page.addMaterialLot();
            });

            $('#btnLotSelectDel').click(function (e) {
                page.delMaterialLot();
            });

            $('#btnInputLotSave').click(function (e) {

                let lot_number = $('#txtInputLot').val();
                page.showLotInput(lot_number);
            });

            // ÏùºÎ∞ò Î∞îÏΩîÎìú Ïä§Ï∫êÎÑà Ïù¥Î≤§Ìä∏
            $('#txtInputLot').keydown(function (e) {
                if (e.keyCode == 9) {
                    let lot_number = $('#txtInputLot').val();
                    page.showLotInput(lot_number);

                }
            });


            $('#txtInputLot').keydown(function (event) {
                let jr_pk = $('#tabBasic').find('#id').val();
                let lot_number = $('#txtInputLot').val();
                let keyCode = event.keyCode || event.which;
                if (event.key === 'Enter' || keyCode === 13) {
                    page.showLotInput(lot_number);
                }
            });

            page.searchMainData();

        });
    </script>
</th:block>
</html>

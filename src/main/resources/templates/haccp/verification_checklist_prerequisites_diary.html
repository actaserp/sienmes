<html layout:decorate="~{layout_page}">

<th:block layout:fragment="content">
<div class="layout-contents">
    <input type="hidden" id="bhId" th:value="${bh_id}" />
    <input type="hidden" id="data_date" th:value="${data_date}" />
    <input type="hidden" id="search_cond" th:value="${searchcond}" />
    <input type="hidden" id="viewMode" th:value="${view_mode}" />
    <div class="page-title-wrap">
        <div class="left">
            <h2>Í≤ÄÏ¶ùÏ†êÍ≤ÄÌëú-ÏÑ†ÌñâÏöîÍ±¥(ÏÜåÍ∑úÎ™®HACCP)</h2>
            <a title="Î∂ÅÎßàÌÅ¨" class="bookmark toggle">
                ÎÇ¥ Î©îÎâ¥
            </a>
        </div>
        <ul class="page-navi">
            <li><img src="/images/icon/ico-nav-home.svg" alt="ÌôàÏïÑÏù¥ÏΩò"></li>
            <li>HACCP Í¥ÄÎ¶¨</li>
            <li>Í≤ÄÏ¶ùÏ†êÍ≤ÄÌëú-ÏÑ†ÌñâÏöîÍ±¥(ÏÜåÍ∑úÎ™®HACCP)</li>
        </ul>
    </div>

    <section class="section">
        <div class="section-card-wrap">
            <div class="col-5">
                <table class="write-table">
                    <tbody>
                    <tr>
                        <th style="text-align: center">
                            <label for="title">ÏùºÏßÄÎ™Ö</label>
                        </th>
                        <td>
                            <input class="form-control2 tac" type="text" id="title" name="title"/>
                        </td>
                    </tr>
                    <tr>
                        <th style="text-align: center">
                            <label for="dataDate">Ï†êÍ≤ÄÏùº</label>
                        </th>
                        <td>
                            <input class="form-control2 tac" type="date" id="dataDate" name="dataDate"
                                   disabled/>
                        </td>
                    </tr>
                    <tr>
                        <th style="text-align: center">
                            <label for="firstName">ÏûëÏÑ±Ïûê</label>
                        </th>
                        <td>
                            <input class="form-control2 tac" type="text" id="firstName" name="firstName"
                                   disabled/>
                        </td>
                    </tr>
                    </tbody>
                </table>
            </div>
            <div class="col-6">
                <div id="approveBox"></div>
            </div>
        </div>
    </section>

    <section class="section">
        <div class="section-top">
            <div class="search-wrap">
                <h3>Ï†êÍ≤Ä Î™©Î°ù</h3>
            </div>
            <div class="button-wrap">
                <button type="button" class="btn" id="btnDiaryPrint">ÏùºÏßÄÏ∂úÎ†•</button>
                <button type="button" class="btn" id="btnReqAppr">Í≤∞Ïû¨ÏÉÅÏã†</button>
                <button type="button" class="btn" id="btnAppr" style="display:none;">ÏäπÏù∏</button>
                <button type="button" class="btn" id="btnReject" style="display:none;">Î∞òÎ†§</button>
                <button type="button" class="btn" id="btnSave">Ï†ÄÏû•</button>
                <button type="button" class="btn" id="btnDelete">ÏÇ≠Ï†ú</button>
                <button type="button" class="btn" id="btnList">Î™©Î°ù</button>
            </div>
        </div>
        <div class="grid_box" id="main_grid">
            <div id="check_item_result_grid" style="height: 570px;"></div>
        </div>
    </section>
    <section class="section">
        <div class="section-top">
            <div class="search-wrap" style="justify-content: flex-start; align-items: flex-end;">
                <dl>
                    <dt>
                        <label for="standard">
                            Í∏∞Ï§ÄÏ†êÏàò
                        </label>
                    </dt>
                    <dd>
                        <div class="srch-box">
                            <input class="form-control2 tac" type="number" value=0 id="standard" name="standard" disabled/>
                        </div>
                    </dd>
                </dl>
                <dl>
                    <dt>
                        <label for="result_sum">
                            Î∞∞Ï†êÌï©Í≥Ñ
                        </label>
                    </dt>
                    <dd>
                        <div class="srch-box">
                            <input class="form-control2 tac" type="number" value=0 id="result_sum" name="result_sum" disabled/>
                        </div>
                    </dd>
                </dl>
                <dl>
                    <dt>
                        <label for="is_ok">
                            Ï†ÅÌï©Ïó¨Î∂Ä
                        </label>
                    </dt>
                    <dd>
                        <div class="srch-box">
                            <input class="form-control2 tac" type="text" value="Î∂ÄÏ†ÅÌï©" id="is_ok" name="is_ok" disabled />
                        </div>
                    </dd>
                </dl>
            </div>
        </div>
    </section>
</div>

<script type="text/x-tmpl" id="imagePopup">
    <div class="content_wrap modal-content popup">
    	<div class ="row">
	        <div class="col-12">
	            <div class="input-group">
	                <div class="input-group-prepend">
	                    <span class="input-group-text fit_box_t5" data-labelCd="Ï†êÍ≤ÄÌï≠Î™©Î™Ö">Ï†êÍ≤ÄÌï≠Î™©Î™Ö</span>
	                </div>
	                <input class="form-control2 tac" type="text" id="pop_item_name" disabled="disabled" />
	            </div>
	        </div>
	     </div>
        <section class="pt-2 ">
            <div id="image_div" style="text-align:center;">
  	            <img src="{%=o.src%}"/>
            </div>
        </section>
    </div>
</script>
</th:block>

<th:block layout:fragment="scripts">
<th:block th:replace="/common/approve_box :: approve_box"></th:block>
<th:block th:replace="/common/popup_select_user_code :: popup_select_user_code"></th:block>
<script type="text/javascript">
    class CheckResultDiaryPage {
        constructor() {
            this.grid = null;
            this.approveBoxUtil = null;
            this.resultGrid = null;
            this.checkMasterName = 'Í≤ÄÏ¶ùÏ†êÍ≤ÄÌëú-ÏÑ†ÌñâÏöîÍ±¥(ÏÜåÍ∑úÎ™®haccp)'
            this.baseUrl = '/api/haccp/verifi_check_prereq';
            this.init();
        }

        init() {
            let _this = this;
            
			this.gparam = {
				bh_id : $('#bhId').val(),
				data_date : $('#data_date').val(),
				search_cond: $('#search_cond').val(),
				view_mode: $('#viewMode').val(),
			};

            this.resultGrid = new wijmo.grid.FlexGrid('#check_item_result_grid', {
                autoGenerateColumns: false,
                selectionMode: wijmo.grid.SelectionMode.Row,
                frozenColumns: 0,
                frozenRows: 0,
                allowSorting: false,
                headersVisibility: wijmo.grid.HeadersVisibility.Column,
                allowMerging: wijmo.grid.AllowMerging.Cells,
                itemsSource: new wijmo.collections.CollectionView([]),
                autoRowHeights: true,
                columns: [
                    { binding: 'id', header: 'Î≤àÌò∏', width: 100, align: 'right', visible: false },
                    { binding: 'index_order', header: 'ÏàúÎ≤à', width: 50, align: 'center', isReadOnly: true },
                    { binding: 'group1', header: 'Íµ¨Î∂Ñ1', width: 130, align: 'left', visible: false },
                    { binding: 'group2', header: 'Íµ¨Î∂Ñ2', width: 130, align: 'left', visible: false },
                    { binding: 'group3', header: 'Íµ¨Î∂Ñ3', width: 130, align: 'left', visible: false },
                    { binding: 'item_name', header: 'Ï†êÍ≤ÄÌï≠Î™©Î™Ö', width: 650, align: 'left', isReadOnly: true },
                    {
                        binding: 'result1',
                        header: 'Î∞∞Ï†ê(ÏûÖÎ†•)',
                        width: 150,
                        align: 'center',
                        isReadOnly: false,
                        dataType: wijmo.DataType.Number
                    },
                    { binding: 'result2', header: 'ÎπÑÍ≥†', width: 130, align: 'left', isReadOnly: false },
                    {
                        binding: 'not_appli',
                        header: 'Ìï¥ÎãπÏóÜÏùå',
                        width: 100,
                        align: 'center',
                        isReadOnly: false,
                        dataType: wijmo.DataType.Boolean
                    }
                ],
                formatItem: (s, e) => {
                    let col = s.columns[e.col];
                    let item = s.rows[e.row].dataItem;

                    if (e.panel.cellType === wijmo.grid.CellType.ColumnHeader) {
                        e.cell.style.textAlign = 'center';
                    }

                    if (e.panel.cellType === wijmo.grid.CellType.Cell) {
                        e.cell.style.whiteSpace = "normal";
                        e.cell.style.wordBreak = "break-word";
                        e.cell.style.overflow = "visible";
                        e.cell.style.display = "flex";             // Flexbox Ï†ÅÏö©
                        e.cell.style.alignItems = "center";        // ÏàòÏßÅ Í∞ÄÏö¥Îç∞ Ï†ïÎ†¨
                    }

                    // item_name Ïª¨ÎüºÎßå ÏôºÏ™Ω Ï†ïÎ†¨, ÎÇòÎ®∏ÏßÄÎäî Í∞ÄÏö¥Îç∞ Ï†ïÎ†¨
                    if (col.binding === "item_name" || col.binding === "result2") {
                        e.cell.style.justifyContent = "flex-start";  // ÏôºÏ™Ω Ï†ïÎ†¨
                    } else {
                        e.cell.style.justifyContent = "center";  // Í∑∏ Ïô∏Îäî Ï§ëÏïô Ï†ïÎ†¨
                    }

                    // **üí° ÌäπÏ†ï Ïª¨ÎüºÎßå Î∞∞Í≤ΩÏÉâ Î≥ÄÍ≤Ω (ex. result1 Ïª¨ÎüºÎßå)**
                    if (e.panel.cellType === wijmo.grid.CellType.Cell && col.binding === "result1") {
                        if (item.not_appli || item.result1 === "Ìï¥ÎãπÏóÜÏùå") {
                            e.cell.style.backgroundColor = "#f8d2cb"; // Îπ®Í∞ÑÏÉâ Î∞∞Í≤Ω
                        } else {
                            e.cell.style.backgroundColor = "#dcf0f8"; // ÌååÎûÄÏÉâ Î∞∞Í≤Ω
                        }
                    }
                }
            });

            this.resultGrid.lostFocus.addHandler(() => {
                this.resultGrid.collectionView.commitEdit(); // Ìé∏Ïßë Ï¢ÖÎ£å Î∞è Ï†ÄÏû•
            });

            this.resultGrid.beginningEdit.addHandler((s, e) => {
                let col = s.columns[e.col];
                let item = s.rows[e.row].dataItem;

                if (col.binding === "not_appli") {
                    let cell = s.hostElement.querySelector(`.wj-cell[data-c="${e.col}"][data-r="${e.row}"]`);
                    let checkbox = cell ? cell.querySelector("input[type='checkbox']") : null;

                    // Ï≤¥ÌÅ¨Î∞ïÏä§Í∞Ä Ï°¥Ïû¨ÌïòÏßÄ ÏïäÍ±∞ÎÇò, ÌÅ¥Î¶≠Îêú ÏöîÏÜåÍ∞Ä Ï≤¥ÌÅ¨Î∞ïÏä§Í∞Ä ÏïÑÎãàÎ©¥ Ìé∏Ïßë Î∞©ÏßÄ
                    if (!checkbox || e.nativeEvent.target !== checkbox) {
                        e.cancel = true;
                    }
                }

                if (col.binding === "result1" && (item.not_appli || item.result1 === "Ìï¥ÎãπÏóÜÏùå")) {
                    e.cancel = true; // Ìé∏Ïßë Î∞©ÏßÄ
                }
            });

            this.resultGrid.cellEditEnded.addHandler((s, e) => {
                let col = s.columns[e.col];
                let item = s.rows[e.row].dataItem;

                if (col.binding === "result1" && item.result1 > item.max_value) {
                    item.result1 = item.max_value; // max_value Ï¥àÍ≥º Ïãú ÏûêÎèô ÏàòÏ†ï
                    this.resultGrid.collectionView.commitEdit(); // Ï¶âÏãú Ï†ÄÏû• Î∞è UI Î∞òÏòÅ
                    this.resultGrid.invalidate(); // UI ÏóÖÎç∞Ïù¥Ìä∏
                }

                this.resultGrid.collectionView.commitEdit(); // Ï¶âÏãú Ï†ÄÏû• Î∞è UI Î∞òÏòÅ
                this.resultGrid.invalidate(); // UI ÏóÖÎç∞Ïù¥Ìä∏
            });

            this.resultGrid.hostElement.addEventListener('click', (e) => {
                const ht = this.resultGrid.hitTest(e);
                if (ht.cellType === wijmo.grid.CellType.Cell) {
                    const col = this.resultGrid.columns[ht.col];
                    const item = this.resultGrid.rows[ht.row]?.dataItem;

                    if (!$('#viewMode').val()) {
                        if (col.binding === 'result1' && item.result_type === 'OX') {
                            switch (item.result1) {
                                case null:
                                    item.result1 = 'O';
                                    break;
                                case 'O':
                                    item.result1 = 'X';
                                    break;
                                case 'X':
                                    item.result1 = null;
                                    break;
                            }
                            // this.resultGrid.collectionView.refresh();
                        }

                        if (col.binding === 'not_appli') {
                            item.not_appli = !item.not_appli;
                            item.result1 = item.not_appli ? "Ìï¥ÎãπÏóÜÏùå" : "";
                            this.resultGrid.collectionView.refresh();
                            this.resultGrid.invalidate(); // UI ÏóÖÎç∞Ïù¥Ìä∏
                            this.setDynamicStandard();
                            this.setResultCollector();
                            this.calcIsOk();
                        }

                        if (col.binding === 'item_name') {
                            // _this.showImagePopup(item.id, item.item_name);
                        }
                    }
                }
            });

            this.resultGrid.collectionView.collectionChanged.addHandler((s, e) => {
                if (e.action === wijmo.collections.NotifyCollectionChangedAction.Change) {

                    this.setDynamicStandard();
                    this.setResultCollector();
                    this.calcIsOk();

                    this.resultGrid.invalidate();
                }
            });


            if ($('#viewMode').val()) {
                this.resultGrid.columns.find(c => c.binding === "result2").isReadOnly = true;
                this.resultGrid.columns.find(c => c.binding === "not_appli").visible = false;
            }
        }
        
        showImagePopup(dataPk, item_name){
			let url = '/api/common/attach_file/detailFiles';
            let data = {
                'attachName': 'check_item_image',
                'TableName': 'check_item',
                'DataPk': dataPk
            }
            let attach_file = AjaxUtil.getSyncData(url, data);
            
			if (attach_file.data[0]) {
				let data = { src: "/api/check/check_item/ImgShow?dataPk=" + dataPk };
				
	            let content = tmpl("imagePopup", data);
	            let $content = $(content);
	            let modalContainer = new PopupDraggable("ÏÑ∏Î∂Ä Ï†êÍ≤ÄÍ∏∞Ï§Ä");
	            
	            let img = new Image();
		        img.src = data.src;
		        img.onload = function () {
		            let maxWidth = window.innerWidth * 0.8; // 80% of window width
		            let maxHeight = window.innerHeight * 0.8; // 80% of window height
		
		            let imgWidth = img.width;
		            let imgHeight = img.height;
		
		            let ratio = Math.min(maxWidth / imgWidth, maxHeight / imgHeight);
		
		            // Set new image dimensions
		            let newImgWidth = imgWidth * ratio;
		            let newImgHeight = imgHeight * ratio;
		
		            $content.find('img').css({
		                'width': newImgWidth + 'px',
		                'height': newImgHeight + 'px',
		                'max-width': '100%',
	                	'max-height': '100%'
		            });
		
		            modalContainer.open({ width: newImgWidth, height: newImgHeight, $content });
		            $content.find('#pop_item_name').val(item_name);
		        };
            }
		}

        setDynamicStandard() {
            let standard_val = 0;
            this.resultGrid.collectionView.items.forEach(item => {
                if (item.result_type === 'N' && !item.not_appli) {
                    standard_val += Number(item.max_value);
                }
            });
            $('#standard').val(standard_val);
        }

        setResultCollector() {
            let value = 0;
            this.resultGrid.collectionView.items.forEach(item => {
                if (!item.not_appli && item.result1 !== "Ìï¥ÎãπÏóÜÏùå") {
                    value += Number(item.result1);
                }
            });
            $('#result_sum').val(value);
        }
		
		calcIsOk(){
			let _this = this;
			
			let standard_val = $('#standard').val();
			let sum_val = $('#result_sum').val();
			
			var percent = Math.round(sum_val/standard_val*100);
			
			if(percent>=85){
				$('#is_ok').val('Ï†ÅÌï©');
				$('#is_ok').css("color","blue");
			}
			else{
				$('#is_ok').val('Î∂ÄÏ†ÅÌï©');
				$('#is_ok').css("color","red");
			}
		}

        checkAllItem() {
            this.resultGrid.collectionView.items.forEach(item => {
                if (item.result_type === 'N' && !item.not_appli) {
                    item.result1 = item.max_value;
                }
            });
            this.resultGrid.collectionView.refresh();
        }
        
        // ÏùºÏßÄ Ï°∞Ìöå
        searchMainData() {
            let _this = this;
            $('#btnDiaryPrint').hide();
            $('#btnDelete').hide();

            $('#firstName').val(userinfo.username);
            $('#title').val(_this.checkMasterName);

            if ($('#bhId').val() > 0) {
                let param = {
                    'bh_id': $('#bhId').val(),
                };

                let result = AjaxUtil.getSyncData(_this.baseUrl + '/read', param);

                if (result != null) {
                    let headInfo = result.data.head_info;
                    let diaryInfo = result.data.diary_info;
                    //let actionInfo = result.data.action_info;

                    $('#title').val(headInfo.Title);
                    $('#dataDate').val(headInfo.DataDate);
                    $('#firstName').val(headInfo.FirstName);

                    _this.resultGrid.itemsSource.sourceCollection =diaryInfo;

		            _this.setDynamicStandard();
                    _this.setResultCollector();
					_this.calcIsOk();
                    _this.viewModeSetting(headInfo)
                } 

            }else {
                _this.searchItemList();
            }

            // head_id, task_code, src_data_pk, src_table_name, dept_id, shift
            _this.approveBoxUtil = new ApproveBoxUtil(0, _this.checkMasterName, $('#bhId').val(), 'bundle_head', false, false);
            _this.approveBoxUtil.print($('#viewMode').val());
            if (_this.approveBoxUtil.isApprUser()) {
                // Í≤∞Ïû¨ÏûêÏùò Í≤ΩÏö∞ Î≤ÑÌäº Ï≤òÎ¶¨
                $('#btnAppr').show();
                $('#btnReject').show();
            }
        }
        
        searchItemList() {
            let _this = this;

            let param = {
                //'action': 'read',
                'srch_check_name': _this.checkMasterName
            }
            
            let check_master_info = AjaxUtil.getSyncData('/api/check/check_master/read', param);
            _this.check_master_id = check_master_info.data[0].id

            let data = {
                //'action': 'read',
                'check_master_id': _this.check_master_id,
                'check_date': $('#dataDate').val(),
                'start_date': $('#dataDate').val(),
                'end_date': $('#dataDate').val(),
            }

            let result = AjaxUtil.getSyncData('/api/check/check_item/read', data);

			// ÏµúÏ¥à Îì±Î°ù Ïãú Í∏∞Ï§ÄÏ†êÏàò
			var standard_val = 0;
            result.data.forEach(function (item, idx) {
                item.result1 = null;
                standard_val += Number(item.max_value);
            })
            
            $('#standard').val(standard_val);
            
            _this.calcIsOk();

            _this.resultGrid.itemsSource.sourceCollection =result.data;

        }

        viewModeSetting(headInfo) {
             // Îç∞Ïù¥ÌÑ∞Ïóê Îî∞Î•∏ Î≤ÑÌäº ÏÑ§Ï†ï
            if ($('#viewMode').val().toLowerCase() === 'true') {
                //Î≥¥Í∏∞ Î™®ÎìúÏùº Í≤ΩÏö∞ CRUD Î≤ÑÌäº Ïà®ÍπÄ
                $('#btnDiaryPrint').hide();
                $('#btnReqAppr').hide();
                $('#btnSave').hide();
                $('#btnDelete').hide();
                $('#btnAllItem').hide();
                if (headInfo.State === 'approval') {
                    $('#btnDiaryPrint').show();
                }

                $('#title').attr('disabled', 'disabled');
                $('#dataDate').attr('disabled', 'disabled');

            }
            else {
                // State : ÏûëÏÑ±, ÎØ∏Í≤∞Ïû¨, ÏäπÏù∏, Î∞òÎ†§, Ïû¨ÏÉÅÏã†
                $('#btnDelete').show();
                $('#btnDiaryPrint').hide();
                if (headInfo.State === 'process' || headInfo.State === 'reprocess') {
                    $('#btnReqAppr').hide();
                    $('#btnSave').hide();
                    $('#btnDelete').hide();
                    $('#btnAllItem').hide();
                } else if (headInfo.State === 'approval') {
                    $('#btnDiaryPrint').show();
                    $('#btnReqAppr').hide();
                    $('#btnSave').hide();
                    $('#btnDelete').hide();
                    $('#btnAllItem').hide();
                }

                if (parseInt($('#bhId').val(), 10) > 0) {
                    $('#dataDate').attr('disabled', 'disabled');
                } else {
                    $('#btnDelete').hide();
                }
            }
        }

        // ÏùºÏßÄ Ï∂úÎ†•
        printDiary() {
            let param = {
                'title': $('#title').val(),
                'bh_id': $('#bhId').val(),
            };

            let result = AjaxUtil.postSyncData(this.baseUrl + '/print', param, function () { });
            if (result.success) {
                CommonUtil.openWindow('/api/files/pdf_viewer?file_id=' + result.file_id)
            }
            else {
                Alert.alert('', 'ÏùºÏßÄ ÏÉùÏÑ± Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§. Í¥ÄÎ¶¨ÏûêÏóêÍ≤å Î¨∏ÏùòÌïòÏÑ∏Ïöî.');
            }
        }

        //Í≤∞Ïû¨
        appr(isAppr) {
            let _this = this;
            _this.approveBoxUtil.approval(isAppr, function () {
                $('#btnList').click();
            });
        }

        //Í≤∞Ïû¨ÏÉÅÏã†
        reqAppr() {
            let _this = this;
            let title = $('#title').val();
            let url = '/gui/' + gui.gui_code + '/edit';
            let urlParam = {
                'bh_id': $('#bhId').val(),
                'data_date': $('#dataDate').val(),
            };

            let ret = _this.approveBoxUtil.request($('#bhId').val(), title, url, JSON.stringify(urlParam));
            if (ret.success) {
                Notify.success('Í≤∞Ïû¨ÏÉÅÏã†ÌïòÏòÄÏäµÎãàÎã§.');
                $('#btnList').click();
            }
        }

        //Ï†ÄÏû•
        save(isAppr) {
            let _this = this;
            let resultNullCheck = false;

            this.resultGrid.collectionView.items.forEach(item => {
                if ((item.result1 == null || item.result1 === '') && !item.not_appli && item.result_type === 'N') {
                    resultNullCheck = true;
                }
            });

            let callback = function () {

                let items = _this.resultGrid.collectionView.items.map(item => ({
                    id: item.id,
                    result1: item.result1,
                    result2: item.result2
                }));
          
                let data = {
                    bh_id: $('#bhId').val(),
                    check_master_id: _this.check_master_id,
                    title: $('#title').val(),
                    data_date: $('#dataDate').val(),
                    Q: JSON.stringify(items),
                };
                
                let fnSuccess = function (resp) {
                    if (resp.success) {
                        $('#bhId').val(resp.data.id);
                        if (isAppr) {
                            // Í≤∞Ïû¨ÏöîÏ≤≠
                            _this.reqAppr();
                        } else {
                            // ÏûÑÏãúÏ†ÄÏû•
                            Notify.success('Ï†ÄÏû•ÌïòÏòÄÏäµÎãàÎã§.');
                            $('#btnDelete').show();
                            $('#dataDate').attr('disabled', 'disabled');
                            _this.searchMainData();
                        }
                    } else {
                        Alert.alert('', resp.message);
                    }
                };
                let action = $('#bhId').val() > 0 ? '/save' : '/insert';
                
                AjaxUtil.postAsyncData(_this.baseUrl + action, data, fnSuccess);
            }

            if (resultNullCheck) {
                Alert.alert("", "Ï†êÍ≤ÄÍ≤∞Í≥ºÎ•º Î™®Îëê ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.");
                return;
            }
            if (isAppr) {
                Alert.confirm('', 'Í≤∞Ïû¨ÏÉÅÏã†ÌïòÏãúÍ≤†ÏäµÎãàÍπå?', function () {
                    callback();
                });
            }
            else {
                Alert.confirm('', 'Ï†ÄÏû•ÌïòÏãúÍ≤†ÏäµÎãàÍπå?', function () {
                    callback();
                });
            }
        }

        //ÏÇ≠Ï†ú
        delete() {
            let _this = this;
            Alert.confirm('', 'ÏÇ≠Ï†úÌïòÏãúÍ≤†ÏäµÎãàÍπå?', function () {
                // ÏÇ≠Ï†ú ÏÑúÎπÑÏä§ Ìò∏Ï∂ú
                let param = {
                    bh_id: $('#bhId').val(),
                }
                let fnSuccess = function (resp) {
                    if (resp.success) {
                        Notify.success('ÏÇ≠Ï†úÌïòÏòÄÏäµÎãàÎã§.');
                        $('#btnList').click();
                    } else {
                        Alert.alert('', resp.message);
                    }
                };
                AjaxUtil.postAsyncData(_this.baseUrl + '/delete', param, fnSuccess);
            });
        }

    }

    let page = null;

    $(document).ready(function (e) {
        page = new CheckResultDiaryPage();

			
        $('#dataDate').val(page.gparam.data_date);

        $('#btnAllItem').click(function (e) {
            page.checkAllItem();
        });

        // ÏùºÏûê Î≥ÄÍ≤Ω
        $('#dataDate').change(function () {
            page.searchMainData();
        });

        // ÏùºÏßÄ Ï∂úÎ†•
        $('#btnDiaryPrint').on('click', function () {
            page.printDiary();
        });

        // Í≤∞Ïû¨ÏÉÅÏã†
        $('#btnReqAppr').on('click', function () {
            page.save(true);
        });

        // ÏäπÏù∏
        $('#btnAppr').on('click', function () {
            page.appr(true);
        });

        // Î∞òÎ†§
        $('#btnReject').on('click', function () {
            page.appr(false);
        });

        // ÏûÑÏãúÏ†ÄÏû•
        $('#btnSave').on('click', function () {
            page.save(false);
        });

        // ÏÇ≠Ï†ú
        $('#btnDelete').on('click', function () {
            page.delete();
        });

        // Î™©Î°ù
        $('#btnList').on('click', function () {
            if (page.gparam.appr_view) {
                location.href = encodeURI('/gui/' + page.gparam.appr_view + '?searchcond=' + page.gparam.search_cond);
            }
            else {
                location.href = encodeURI('/gui/' + gui.gui_code + '?searchcond=' + page.gparam.search_cond);
            }
        });
        
        page.searchMainData();
        
        //multiLine trueÎ°ú Ïù∏Ìï¥ Í∑∏Î¶¨Îìú Î∞ë Ïß§Î¶º Î≤ÑÍ∑∏ -> Í∑∏Î¶¨Îìú ÎÜíÏù¥ ÎèôÏ†Å Ï°∞Ï†ï
        //page.setResultGridHeight();

    });
</script>
</th:block>
</html>

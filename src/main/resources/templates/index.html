<!DOCTYPE html>
<html lang="ko" xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="utf-8"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1, minimum-scale=1, maximum-scale=1">
    <link rel="icon" type="image/png" href="/images/logo/actas_log_a.png">
    <title th:text="${ system_title }"></title>
    <link rel="stylesheet" href="/resource/windowContainer/css/jquery.scrollbar.min.css">
    <link rel="stylesheet" href="/resource/windowContainer/css/bootstrap.min.css">
    <link rel="stylesheet" href="/resource/windowContainer/css/nth-icons.css">
    <link rel="stylesheet" href="/resource/windowContainer/css/nth-tabs.css">
    <link rel="stylesheet" href="/resource/ax5ui/ax5ui.all.css">
    <link rel="stylesheet" href="/css/animate.css">
    <link rel="stylesheet" href="/css/main.css">
    <link rel="stylesheet" href="/css/theme-top-mes.css">
    <!--    <link rel="stylesheet" href="/css/theme-left-mes.css">-->
    <link rel="stylesheet" type="text/css" href="/css/import.css">
    <script src="/js/vendor/jquery-3.6.0.js"></script>
    <script src="/js/vendor/jquery-ui.min.js"></script>
    <script src="/js/ui.js"></script> <!-- Common js -->
    <script src="/js/utilscript.js"></script> <!-- ë°•ê´‘ì—´ -->

    <script th:inline="javascript">
        var spjangList = /*[[${session.spjangList}]]*/ [];

    </script>

    <style>
        .left {
            cursor: pointer;
        }

        .menu_area {
            transition: transform 0.3s ease-in-out, opacity 0.3s ease-in-out;
            transform: translateX(0); /* ê¸°ë³¸ ìœ„ì¹˜ */
            opacity: 1;
            width: 250px; /* ë©”ë‰´ ë„ˆë¹„ */
            position: absolute; /* ì™¼ìª½ ê³ ì • */
            left: 0;
            visibility: visible;
            pointer-events: auto;
        }

        /* ë©”ë‰´ê°€ ì‚¬ë¼ì§ˆ ë•Œ */
        .menu_area.hidden {
            transform: translateX(-250px); /* ë¶€ë“œëŸ½ê²Œ ì™¼ìª½ìœ¼ë¡œ ì‚¬ë¼ì§ */
            opacity: 0;
            visibility: hidden;
            pointer-events: none; /* í´ë¦­ ë°©ì§€ */
        }

        /* ì»¨í…ì¸  ì˜ì—­ */
        .con_area {
            transition: width 0.3s ease-in-out, left 0.3s ease-in-out;
            width: calc(100% - 250px); /* ê¸°ë³¸ì ìœ¼ë¡œ ë©”ë‰´ ë„ˆë¹„ë§Œí¼ ì¤„ì–´ë“  ìƒíƒœ */
            left: 250px; /* ë©”ë‰´ê°€ ìˆì„ ë•Œ ê¸°ë³¸ ìœ„ì¹˜ */
        }

        /* ë©”ë‰´ê°€ ì‚¬ë¼ì§€ë©´ ì»¨í…ì¸  ì˜ì—­ í™•ì¥ */
        .menu_area.hidden + .con_area {
            width: 100%;
            left: 0;
        }

        /* ë¶€ë“œëŸ½ê²Œ ë‚˜ì˜¤ëŠ” ì• ë‹ˆë©”ì´ì…˜ */
        @keyframes menuFadeIn {
            0% {
                transform: translateX(-250px);
                opacity: 0;
            }
            100% {
                transform: translateX(0);
                opacity: 1;
            }
        }

    </style>
</head>

<body>
<div class="page-wrapper sub-page">
    <div class="dashboard-layout-header">
        <header>
            <div class="left">
                <div class="logo">
                    <img src="/images/logo/actas_log.png" alt="ë¡œê³ ">
                    <h1>MES</h1>
                </div>
            </div>
            <div class="right">
                <div id="navbarBarMenu2" style="margin-left: 10px;">
                    <div class="open_menu">
                        <span class="bar"></span>
                        <span class="bar"></span>
                        <span class="bar"></span>
                    </div>
                </div>
                <div class="header-info">
                    <div class="weather">
                        <div class="wt-main">
                            <p id="area"></p>
                            <div class="wt-graphic">
                                <img id="weatherIcon" src="" alt="">
                                <!--                            <p id="temperature"></p> &lt;!&ndash; ê¸°ì¡´ì˜ <span> íƒœê·¸ë¥¼ ì œê±° -->
                                <p id="temperature"></p>
                            </div>
                        </div>
                        <div class="wt-detail">
                            <ul>
                                <li>
                                    <img src="/images/icon/ico-umbrella.svg" alt="ê°•ìˆ˜">
                                    <p id="precipitationProbability"></p>
                                </li>
                                <li>
                                    <img src="/images/icon/ico-water.svg" alt="ìŠµë„">
                                    <p id="humidity"></p>
                                </li>
                                <li>
                                    <img src="/images/icon/ico-wind.svg" alt="í’ì†">
                                    <p id="windSpeed"></p>
                                </li>
                            </ul>
                        </div>
                    </div>
                    <!-- ì•ŒëŒ -->
                    <a href="#" class="alarm" title="ì•ŒëŒ">
                        <img src="/images/icon/ico-bell.svg" alt="ì•ŒëŒ ì•„ì´ì½˜">
                        <span>ì•ŒëŒ</span>
                        <span class="num">0</span>
                    </a>
                    <div class="alarm-box" style="width: 1000px;">
                        <ul class="alarm-tab-links">
                            <li class="active">
                                <a href="#alarm-tab1" title="ì£¼ë¬¸ì˜ë¢°">ì£¼ë¬¸ì˜ë¢°(0)</a> <!-- ë™ì ìœ¼ë¡œ ì—…ë°ì´íŠ¸ -->
                            </li>
                        </ul>
                        <div class="alarm-tab-contents">
                            <div class="alarm-tab-item" id="alarm-tab1">
                                <div class="table-wrap">
                                    <table>
                                        <caption>ì•ŒëŒ í…Œì´ë¸”</caption>
                                        <colgroup>
                                            <col class="wp30"> <!-- ë‚ ì§œ -->
                                            <col class="wp45"> <!-- ì—…ì²´ ì´ë¦„ -->
                                            <col class="wp25"> <!-- ì£¼ë¬¸ ìƒíƒœ -->
                                        </colgroup>
                                        <thead>
                                        <tr>
                                            <th>ë‚  ì§œ</th>
                                            <th>ì—…ì²´ ì´ë¦„</th>
                                            <th>ì£¼ë¬¸ ìƒíƒœ</th>
                                        </tr>
                                        </thead>
                                        <tbody>
                                        <!-- ì•Œë¦¼ ë°ì´í„°ê°€ ì—¬ê¸° ë™ì ìœ¼ë¡œ ì¶”ê°€ë¨ -->
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                            <a href="#" title="í™•ì¸" class="btn-gray" id="AlarmOk" onclick="AlarmOk()">í™•ì¸</a>
                        </div>
                    </div>
                    <!-- ì•ŒëŒ -->
                    <!-- ì‚¬ìš©ì ë¡œê·¸ì¸ ìƒíƒœ-->
                    <div id="spjangSelectWrapper">
                        <!-- ì‚¬ì—…ì¥ ë¦¬ìŠ¤íŠ¸ -->
                    </div>
                    <a class="user" title="ì‚¬ìš©ì">
                        <span style="padding:0 5px">Â·</span>
                        <span th:text="${ groupname }"></span>
                        <span style="padding:0 5px">Â·</span>
                        <span id="userName2" th:text="${ username }"></span>
                        <span>(</span>
                        <span id="userName3" th:text="${ userid }"></span>
                        <span>)</span>
                        <span style="padding-right: 8px">ë‹˜</span>
                    </a>
                    <div class="user-box">
                        <ul>
                            <li>
                                <a id="myinfo" href="#" title="ë‚´ ì •ë³´" data-popup="popup1">ë‚´ ì •ë³´</a>
                            </li>
                            <li id="logout">
                                <a href="#" title="ë¡œê·¸ì•„ì›ƒ">ë¡œê·¸ì•„ì›ƒ</a>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
        </header>
        <!--header [E]-->
    </div>

    <div class="menu_area">
        <div class="dashboard-layout-contents">

            <!-- [ëŒ€ì‹œë³´ë“œ] ì™¼ìª½ ì»¨í…ì¸  ì˜ì—­ -->
            <div class="dashboard-layout-left menu_wrap">
                <!-- (ë ˆì´ì•„ì›ƒ) ì‚¬ì´ë“œë°”  -->
                <div class="dashboard-layout-sidebar tabs" data-tab="tabWrap">
                    <ul class="layout-sidebar-tab">
                        <li class="active">
                            <a href="#menu" title="ì „ì²´ë©”ë‰´">ì „ì²´ ë©”ë‰´</a>
                        </li>
                        <li>
                            <a href="#bookmark" title="ë‚´ë©”ë‰´">ë‚´ ë©”ë‰´</a>
                        </li>
                    </ul>
                    <div class="layout-sidebar-tabcont">
                        <nav class="layout-nav sidebar-tabcont" id="menu">
                            <ul class="dep1">
                                <li class="dep1-1">
                                    <a href="#a" title="ëª¨ë‹ˆí„°ë§" class="ico-lnb01">
                                        ëª¨ë‹ˆí„°ë§
                                    </a>
                                    <ul class="dep2" id="dep2-monitoring">

                                    </ul>
                                </li>
                                <li class="dep1-1">
                                    <a href="#a" title="ê¸°ì¤€ì •ë³´" class="ico-lnb05">
                                        ê¸°ì¤€ì •ë³´
                                    </a>
                                    <ul class="dep2" id="dep2-information">

                                    </ul>
                                </li>
                                <li class="dep1-1">
                                    <a href="#a" title="ì˜ì—… ê´€ë¦¬" class="ico-lnb02">
                                        ì˜ì—… ê´€ë¦¬
                                    </a>
                                    <ul class="dep2" id="dep2-sales-management">

                                    </ul>
                                </li>
                                <li class="dep1-1">
                                    <a href="#a" title="ìì¬ ê´€ë¦¬" class="ico-lnb03">
                                        ìì¬ ê´€ë¦¬
                                    </a>
                                    <ul class="dep2" id="dep2-purchase-materials">

                                    </ul>
                                </li>
                                <li class="dep1-1">
                                    <a href="#a" title="ìƒì‚° ê´€ë¦¬" class="ico-lnb03">
                                        ìƒì‚° ê´€ë¦¬
                                    </a>
                                    <ul class="dep2" id="dep2-production-management">

                                    </ul>
                                </li>
                                <li class="dep1-1">
                                    <a href="#a" title="í’ˆì§ˆ ê´€ë¦¬" class="ico-lnb04">
                                        í’ˆì§ˆ ê´€ë¦¬
                                    </a>
                                    <ul class="dep2" id="dep2-quality">

                                    </ul>
                                </li>
                                <li class="dep1-1">
                                    <a href="#a" title="ë³´ê³ ì„œ ê´€ë¦¬" class="ico-lnb04">
                                        ë³´ê³ ì„œ ê´€ë¦¬
                                    </a>
                                    <ul class="dep2" id="dep2-report">

                                    </ul>
                                </li>
                                <li class="dep1-1">
                                    <a href="#a" title="ì…ì¶œê¸ˆ ê´€ë¦¬" class="ico-lnb04">
                                        ì…ì¶œê¸ˆ ê´€ë¦¬
                                    </a>
                                    <ul class="dep2" id="dep2-transaction">

                                    </ul>
                                </li>
                                <li class="dep1-1">
                                    <a href="#a" title="ê·¼íƒœê´€ë¦¬" class="ico-lnb04">
                                        ê·¼íƒœ ê´€ë¦¬
                                    </a>
                                    <ul class="dep2" id="dep2-clock-inout">

                                    </ul>
                                </li>
                                <li class="dep1-1">
                                    <a href="#a" title="ì‹œìŠ¤í…œì„¤ì •" class="ico-lnb05">
                                        ì‹œìŠ¤í…œ ì„¤ì •
                                    </a>
                                    <ul class="dep2" id="dep2-system-settings">

                                    </ul>
                                </li>
                            </ul>

                        </nav> <!-- // nav end -->
                        <div class="layout-bookmark sidebar-tabcont" id="bookmark">
                            <ul class="bookmark-list" id="bookmark-menu">

                            </ul>
                        </div>
                    </div>
                    <div class="layout-sidebar-bottom">
                        <!--   <img src="/images/logo/logo-kt.svg" alt="kt logo">-->
                    </div>
                </div>
            </div><!-- //dashboard-layout-left end-->

            <!-- [ëŒ€ì‹œë³´ë“œ] ì˜¤ë¥¸ìª½ ì»¨í…ì¸  ì˜ì—­ -->
            <!-- //dashboard-layout-right end-->
        </div>
    </div>
    <div class="con_area">
        <!--      <div class="contents">-->
        <div class="nth-tabs" id="main-tabs"></div>
        <!--      </div>-->
    </div>

    <div class="footer">
        <!--footer [S]-->
        <span class="footer-left" id="link_privatepolicy" data-commonCd="ê°œì¸ì •ë³´ ì²˜ë¦¬ë°©ì¹¨">ê°œì¸ì •ë³´ ì²˜ë¦¬ë°©ì¹¨</span>
        <span class="footer-left" id="link_emailreject" data-commonCd="ì´ë©”ì¼ ë¬´ë‹¨ìˆ˜ì§‘ ê±°ë¶€">ì´ë©”ì¼ ë¬´ë‹¨ìˆ˜ì§‘ ê±°ë¶€</span>
        <span class="footer-right">Copyright â“’ (ì£¼)ì—‘íƒ€ìŠ¤. All Rights Reserved.</span>
        <!--footer [E]-->
    </div>
</div>

<script type="text/javascript" src="/resource/jquery.min.js"></script>
<script type="text/javascript" src="/resource/jquery-validation/1.17.0/jquery.validate.min.js"></script>

<script type="text/javascript">
    $('html').attr('lang', sessionStorage.getItem('lang_code'));
</script>
<script type="text/javascript" src="/resource/windowContainer/js/jquery.scrollbar.min.js"></script>
<script type="text/javascript" src="/resource/windowContainer/js/bootstrap.min.js"></script>
<script type="text/javascript" src="/resource/ax5ui/ax5ui.all.min.js?v=1000"></script>

<!-- ë©”ë‰´íƒ­ ì´ë™ script -->
<script type="text/javascript" src="/resource/windowContainer/js/html5sortable.js"></script>
<script type="text/javascript" src="/js/nth-tabs.js?v=1030"></script>

<th:block th:replace="system_js :: system_js"></th:block>

<script src="/js/common.js?v=1060"></script>
<script type="text/javascript" src="/js/yumenu.js?v=1070"></script>
<script type="text/javascript" src="/js/yuscript.js?v=1060"></script>
<script type="text/javascript" src="/js/ax5commUtil.js?v=1070"></script>
<script type="text/javascript">
    let nthTabs = null;
    let default_menu = null;

    $(document).ready(function () {

        $(".left").click(function () {
            nthTabs.delAllTab();
            // window.location.reload();
        });


        // let lang_cd = i18n.getLanguageCode();
        //i18n.initializeCommonData(lang_cd);
        // i18n.initializeMenuData(lang_cd);

        // ë©”ë‰´ ë§¤í•‘(FrontFolder_id)

        nthTabs = $('#main-tabs').nthTabs();

        const dep2Mappings = {
            1: '#dep2-monitoring',
            2: '#dep2-information',
            3: '#dep2-sales-management',
            4: '#dep2-purchase-materials',
            5: '#dep2-production-management',
            6: '#dep2-quality',
            7: '#dep2-report',
            8: '#dep2-transaction',
            9: '#dep2-system-settings',
            10: '#dep2-clock-inout',
            12: '#dep2-approval'
        };

        function loadMenu(FrontFolderId, $FrontFolderElement) {
            $.ajax({
                url: '/api/system/menus', // menus APIë¥¼ í†µí•´ ì „ì²´ ë©”ë‰´ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜´
                type: 'GET',
                success: function (response) {
                    // FrontFolder_idë¥¼ ê¸°ë°˜ìœ¼ë¡œ í´ë” í•„í„°ë§
                    const folders = response.data.filter(folder => folder.frontfolder_id === parseInt(FrontFolderId));

                    if (folders.length > 0) {
                        // í•´ë‹¹ FrontFolderIdì— í•´ë‹¹í•˜ëŠ” í´ë”ê°€ ìˆìœ¼ë©´ ëŒ€ ë©”ë‰´ë¥¼ ë‹¤ì‹œ ë³´ì—¬ì¤Œ
                        $FrontFolderElement.closest('.dep1-1').css('display', 'block');

                        folders.forEach(function (folder) {
                            let $li = $('<li class="dep2-1"></li>');
                            let $a = $('<a href="#"></a>').text(folder.folder_name);
                            $li.append($a);

                            let $subUl = $('<ul class="dep3 documents" style="display: none;"></ul>');
                            $li.append($subUl);

                            // í•´ë‹¹ í´ë”ì˜ í•˜ìœ„ ë©”ë‰´ í•­ëª© ì¶”ê°€
                            folder.nodes.forEach(function (item) {
                                let $itemLi = $('<li class="dep3-custom-list-style"></li>');
                                let $itemA = $('<a href="#" menuurl="' + item.url + '" data-bookmark="' + item.isbookmark + '" data-objid="' + item.objId + '" title="' + item.objNm + '"></a>').text(item.objNm);

                                $itemLi.append($itemA);
                                $subUl.append($itemLi);
                            });

                            $FrontFolderElement.append($li);

                            // dep2 í´ë¦­ ì‹œ dep3 í•­ëª©ì´ 1ê°œë©´ ë°”ë¡œ íƒ­ ì¶”ê°€í•˜ê³  dep3 ìˆ¨ê¹€
                            $a.on('click', function (e) {
                                e.preventDefault();

                                // dep3 í•­ëª© ì°¾ê¸°
                                var $dep3 = $li.find('.dep3 li');

                                if ($dep3.length > 1) {

                                } else if ($dep3.length === 1) {
                                    $('.dep2-1').removeClass('on');
                                    $('.dep3 li').removeClass('on');
                                    $li.addClass('on');

                                    var $a = $dep3.find('a');
                                    var val = $a.text();
                                    var menuurl = $a.attr('menuurl');
                                    var objid = $a.attr('data-objid');
                                    // var _bookmark = $a.attr('data-bookmark');

                                    if (nthTabs.isExistsTab('#' + objid)) {
                                        nthTabs.toggleTab('#' + objid);
                                    } else {
                                        nthTabs.addTab({
                                            id: objid,
                                            title: val,
                                            url: '/gui/' + objid + '/default',
                                            active: true,
                                            allowClose: true,
                                            // isbookmark: _bookmark
                                        });
                                        // nthTabs.bindBookmarkEvent(objid, _bookmark);
                                    }

                                    // dep3 ë¦¬ìŠ¤íŠ¸ ìˆ¨ê¹€
                                    $subUl.hide(); // dep3 í•­ëª©ì´ 1ê°œì¼ ë•Œ ìˆ¨ê¹€
                                    return false;
                                }
                            });
                        });

                        $FrontFolderElement.find('.dep3').on('click', 'a', function (e) {
                            e.preventDefault();

                            // ëª¨ë“  dep3ì˜ liì—ì„œ on í´ë˜ìŠ¤ ì œê±°
                            $('.dep3 li').removeClass('on');

                            // í˜„ì¬ í´ë¦­í•œ liì— on í´ë˜ìŠ¤ ì¶”ê°€
                            var $clickedDep3 = $(this).parent('li');
                            $clickedDep3.addClass('on');

                            // dep3ê°€ 1ê°œì¸ dep2ì—ì„œ on í´ë˜ìŠ¤ ì œê±°
                            $('.dep2-1.on').removeClass('on');

                            var val = $(this).text();
                            var menuurl = $(this).attr('menuurl');
                            var objid = $(this).attr('data-objid');
                            var _bookmark = $(this).attr('data-bookmark');

                            if (nthTabs.isExistsTab('#' + objid)) {
                                nthTabs.toggleTab('#' + objid);
                            } else {
                                nthTabs.addTab({
                                    id: objid,
                                    title: val,
                                    url: '/gui/' + objid + '/default',
                                    active: true,
                                    allowClose: true,
                                    isbookmark: _bookmark
                                });
                                nthTabs.bindBookmarkEvent(objid, _bookmark);
                            }
                        });
                    }
                }
            });
        }


        Object.keys(dep2Mappings).forEach(FrontFolderId => {
            loadMenu(FrontFolderId, $(dep2Mappings[FrontFolderId]));
        });


        $('#navbarBarMenu2 .open_menu').click(function () {
            $(this).toggleClass('menu_open'); // ë©”ë‰´ ìˆ¨ê¹€ í† ê¸€

            $('.menu_area').toggleClass('hidden');
            const isMenuHidden = $('.menu_area').hasClass('hidden');

            $('.con_area, .tab-content').css({
                'width': isMenuHidden ? '100%' : 'calc(100% - 250px)', // ë©”ë‰´ê°€ ë‹«íˆë©´ ì „ì²´ í™•ì¥
                'left': isMenuHidden ? '0' : '250px' // ì™¼ìª½ìœ¼ë¡œ í™•ì¥
            });
        });

        // ë¶ë§ˆí¬ ë° default_menuë¥¼ í•œ ë²ˆì— ì²˜ë¦¬
        $.getJSON('/api/system/bookmark', function (result) {
            let _data = result.data;
            var litagbook = '';

            // ë¶ë§ˆí¬ ë©”ë‰´ ìƒì„±
            for (var i = 0; i < _data.length; i++) {
                litagbook += '<li><a href="#" data-objid="' + _data[i].code + '" menuurl="' + _data[i].url + '">' + i18n.getMenuText(_data[i].name) + '</a></li>';
            }

            $('#bookmark-menu').html(litagbook);

            // í´ë¦­ ì´ë²¤íŠ¸ ë°”ì¸ë”©
            $('#bookmark-menu').on('click', 'a', function (e) {
                e.preventDefault();
                $('#bookmark-menu li').removeClass('on');
                $(this).parent('li').addClass('on');

                var val = $(this).text();
                var menuurl = $(this).attr('menuurl');
                var objid = $(this).attr('data-objid');
                var _bookmark = 'true';

                if (nthTabs.isExistsTab('#' + objid)) {
                    nthTabs.toggleTab('#' + objid);
                } else {
                    nthTabs.addTab({
                        id: objid,
                        title: val,
                        url: '/gui/' + objid + '/default',
                        active: true,
                        allowClose: true,
                        isbookmark: _bookmark
                    });
                }
            });

            // default_menu ì²˜ë¦¬
            $.getJSON('/api/system/usergroup/defaultmenu', function (result) {
                default_menu = result.data.gmenu;
                let title = result.data.MenuName;

                let _bookmark = 'false';
                _data.forEach(function (item) {
                    if (item.code === default_menu) {
                        _bookmark = 'true';
                    }
                });

                // default_menu íƒ­ ì¶”ê°€
                nthTabs.addTab({
                    id: default_menu,
                    title: title,
                    url: '/gui/' + default_menu + '/default',
                    active: true,
                    allowClose: false,
                    // isbookmark: _bookmark
                });

            }).fail(function (e) {
                console.error('Failed to retrieve default menu data.');
            });

        }).fail(function (e) {
            Notify.error('Failed to retrieve bookmark data.');
        });


        $('.scrollbar-inner').scrollbar();
        //
        // var parentClass = $(this).parent('li');
        // if (!$(this).hasClass('on')) {
        //     $('.documents a').removeClass('on');
        //     $(this).addClass('on');
        // }
        // if (parentClass.attr('class') == 'documents') {
        //     $('.gnb li').removeClass('open');
        //     $('.gnb li > ul').slideUp(100);
        // }
        // if (localStorage.getItem('theme-top') === null && localStorage.getItem('theme-left') === null) {
        //     dynamicLinkCss('/css/theme-top-mes', '/css/theme-left-mes');
        // } else {
        //     dynamicLinkCss(localStorage.getItem('theme-top'), localStorage.getItem('theme-left'));
        // }

        //let _mainUrl = 'wm_dashboard_summary';
        // let _mainUrl = default_menu;
        // // ëª¨ë°”ì¼ êµ¬ë¶„
        // if ('B' == 'F') {
        //     _mainUrl = '#OBJ0000000199';
        //     $('#navbarBarMenu1').show();
        //     $('#navbarBarMenu2').hide();
        //     $('.menu_wrap').addClass('mobile_menu_wrap');
        //     $('.menu_area').addClass('mobile_menu_area');
        //     $('.con_area').addClass('mobile_con_area');
        // } else {
        //     $('#navbarBarMenu1').hide();
        //     $('#navbarBarMenu2').show();
        // }
        //
        // // ë©”ë‰´ ìë™ìœ¼ë¡œ ë‹«íˆê²Œ
        // if ($(window).innerWidth() < 800) {
        //     $('body').addClass('open');
        //     $('.wrap').addClass('menu_close');
        //     $('.con_area').addClass('open');
        // }
        //
        // var jsmedia = window.matchMedia("screen and (max-width:799px)");
        // jsmedia.addListener(function (e) {
        //     if (e.matches) {
        //         $('body').addClass('open');
        //         $('.wrap').addClass('menu_close');
        //         $('.con_area').addClass('open');
        //         $('.menu_wrap').addClass('mobile_menu_wrap');
        //         $('.menu_area').addClass('mobile_menu_area');
        //         $('.con_area').addClass('mobile_con_area');
        //     } else {
        //         $('body').removeClass('open');
        //         $('.wrap').removeClass('menu_close');
        //         $('.con_area').removeClass('open');
        //         $('.menu_wrap').removeClass('mobile_menu_wrap');
        //         $('.menu_area').removeClass('mobile_menu_area');
        //         $('.con_area').removeClass('mobile_con_area');
        //     }
        // });
        //
        // //$('#mainlogotitle').text("");
        // $('#mainlogotitle').on('click', function () {
        //     nthTabs.toggleTab(_mainUrl);
        // });
        //
        // //menu slide(left open)
        // $('.open_menu').click(function () {
        //     $(this).toggleClass('menu_close');
        //     $('.wrap').toggleClass('menu_close');
        // });
        // //menu slide(left open)
        // $('.open_menu').click(function () {
        //     $('.con_area').toggleClass('open');
        //     $('.left_area').toggleClass('open');
        //     $('body').toggleClass('open');
        // });

        // TABë©”ë‰´ Context Menu
        $('#tabdragdrop').on('contextmenu', 'li', function (e) {
            if ($(this).attr('not-allow-close') === undefined) {
                $('.otherAuthmaintab').show();
                if ($(this).hasClass('active')) {
                    $('.otherAuthtab').show();
                } else {
                    $('.otherAuthtab').hide();
                }
            } else {
                $('.otherAuthmaintab').hide();
            }
            var leftxpo = 260;
            if ($('.menu_close .menu_area').css('left') !== undefined) {
                leftxpo = 15;
            }
            var left = e.pageX - leftxpo;
            $('#contextTabMenu').toggle().css({
                left: left + 'px'
            }).attr('targetObjId', $(this).children('a').attr('href'));
            return false;
        });

        $(".profile_box").click(function () {
            $(".profile_mbox").toggle();
        })

        $(".btn_nbox_close").click(function () {
            $(".notification_mbox").hide();
        });

        $(".btn_pbox_close").click(function () {
            $(".profile_mbox").hide();
        });


        $('#logout').on('click', function (e) {
            e.preventDefault();
            Alert.confirm('', 'ë¡œê·¸ì•„ì›ƒí•˜ì‹œê² ìŠµë‹ˆê¹Œ?', function () {
                i18n.resetData();
                location.href = '/logout';
            });
        });


        // CR = String.fromCharCode(10);
        // let notify_list = notify_text.split(CR);
        //
        // let notify_index = 0;
        //
        // let timer = setInterval(function () {
        //     return;
        //
        //     if (notify_index >= notify_list.length)
        //         notify_index = 0;
        //     let notify_text = notify_list[notify_index];
        //     $('#notify_text').text(notify_text);
        //     notify_index++;
        // }, 5000);
        //
        // // ë‚´ì •ë³´ í´ë¦­
        $('#myinfo').on('click', function (e) {
            e.preventDefault();
            Ax5Modal.open({url: '/page/account/myinfo', width: 400, height: 380});
            $(".profile_contbox").hide();
        });
        //
        // // ì–¸ì–´ì„¤ì •
        // $('#myLanguage').on('click', function (e) {
        //     e.preventDefault();
        //     Ax5Modal.open({url: '/page/account/language', width: 400, height: 200});
        //     $(".profile_contbox").hide();
        // });
        //
        // // í…Œë§ˆë³€ê²½
        // $('.setting-color > label').on('click', function (e) {
        //     dynamicLinkCss($(this).data('load-top-css'), $(this).data('load-left-css'));
        // });
        //
        // // ê°œì¸ì •ë³´ ì²˜ë¦¬ë°©ì¹¨ í´ë¦­
        // $('#link_privatepolicy').on('click', function (e) {
        //     Ax5Modal.open({url: '/page/popup/privacy_policy', width: 800, height: 200});
        // });
        //
        // // ì´ë©”ì¼ ë¬´ë‹¨ìˆ˜ì§‘ ê±°ë¶€ í´ë¦­
        // $('#link_emailreject').on('click', function (e) {
        //     Ax5Modal.open({url: '/page/popup/email_unauthorized_collection_policy', width: 800, height: 400});
        // });

        // ì˜¤í”ˆì†ŒìŠ¤ ì‚¬ìš©ê³µì§€ í•„ìš”
    });

</script>

<script type="text/javascript">
    // ë‚ ì”¨ ì •ë³´
    fetchWeatherData();

    /*const spjangcd = sessionStorage.getItem("spjangcd");

    const eventSource = new EventSource("/sse/subscribe?"  + spjangcd);

    eventSource.onmessage = function (){
        console.log("ğŸ”” ì•Œë¦¼ ìˆ˜ì‹ :", event.data);
    }*/

    // ë‚ ì”¨ ì •ë³´ë¥¼ ì„œë²„ì—ì„œ ê°€ì ¸ì˜¤ëŠ” í•¨ìˆ˜
    function fetchWeatherData() {
        $.ajax({
            url: '/weather/current',
            type: 'GET',
            dataType: 'json',
            success: function (data) {
                // JSON ë°ì´í„° êµ¬ì¡°ë¥¼ ì´ìš©í•˜ì—¬ ê° í•­ëª©ì— ëŒ€í•œ ê°’ì„ ì¶”ì¶œ
                //console.log(data); // ë°˜í™˜ëœ ë°ì´í„°ë¥¼ ì½˜ì†”ì— ì¶œë ¥
                const fullAddress = data.address;
                const shortAddress = fullAddress.split(" ")[0] + " " + fullAddress.split(" ")[1] + " " + fullAddress.split(" ")[2];
                $('#area').text(shortAddress); // ì§€ì—­ ì •ë³´ í‘œì‹œ
                $('#temperature').html(`${data.T1H}<span class="celsius">â„ƒ</span>`);
                $('#precipitationProbability').html(data.POP ? `${data.POP}%` : '0%'); // ê°•ìˆ˜í™•ë¥ ì´ ì—†ëŠ” ê²½ìš° '0%'ë¡œ í‘œì‹œ
                $('#humidity').html(`${data.REH}%`); // ìŠµë„ë¥¼ í‘œì‹œí•  ë•Œ '%'ë¥¼ ì¶”ê°€
                $('#windSpeed').html(`${data.WSD}m/s`); // í’ì†ì„ í‘œì‹œí•  ë•Œ 'm/s'ë¥¼ ì¶”ê°€

                // ë‚ ì”¨ ì•„ì´ì½˜ ì—…ë°ì´íŠ¸
                updateWeatherIcon(data.SKY, data.PTY);
            },
            error: function (error) {
                console.error('Error fetching weather data:', error);
            }
        });
    }

    // ë‚ ì”¨ ì•„ì´ì½˜ ì—…ë°ì´íŠ¸ í•¨ìˆ˜
    function updateWeatherIcon(skyValue, ptyValue) {
        // console.log("PTY Value:", ptyValue);
        // console.log("SKY Value:", skyValue);

        let iconPath = '/images/icon/weather/';
        let altText = 'ë‚ ì”¨ ì•„ì´ì½˜';

        // PTY ê°’ì— ë”°ë¼ ë¨¼ì € íŒë‹¨ (ê°•ìˆ˜ í˜•íƒœ ìš°ì„ )
        if (ptyValue == '1') {
            iconPath += 'ico-wt4.svg'; // ë¹„
            altText = 'ë¹„';
        } else if (ptyValue == '3') {
            iconPath += 'ico-wt5.svg'; // ëˆˆ
            altText = 'ëˆˆ';
        } else if (ptyValue == '4') {
            iconPath += 'ico-wt7.svg'; // ì†Œë‚˜ê¸°
            altText = 'ì†Œë‚˜ê¸°';
        } else {
            // PTY ê°’ì´ 0ì´ê±°ë‚˜ ë¹„ì–´ ìˆì„ ë•ŒëŠ” SKY ê°’ìœ¼ë¡œ íŒë‹¨
            if (skyValue == '1') {
                iconPath += 'ico-wt1.svg'; // ë§‘ìŒ
                altText = 'ë§‘ìŒ';
            } else if (skyValue == '2') {
                iconPath += 'ico-wt2.svg'; // êµ¬ë¦„ ì¡°ê¸ˆ
                altText = 'êµ¬ë¦„ ì¡°ê¸ˆ';
            } else if (skyValue == '3' || skyValue == '4') {
                iconPath += 'ico-wt3.svg'; // êµ¬ë¦„ ë§ìŒ ë˜ëŠ” íë¦¼
                altText = 'êµ¬ë¦„ ë§ìŒ ë˜ëŠ” íë¦¼';
            }
        }

        // ì•„ì´ì½˜ ì—…ë°ì´íŠ¸
        const weatherIcon = $('#weatherIcon');
        weatherIcon.attr('src', iconPath);
        weatherIcon.attr('alt', altText);

    }

    document.addEventListener('DOMContentLoaded', function () {
        const wrapper = document.getElementById('spjangSelectWrapper');
        const savedSpjangcd = sessionStorage.getItem('spjangcd');
        const select = document.createElement('select');

        select.id = 'spjangcd';
        select.name = 'spjangcd';
        select.classList.add('select-no-border');

        // ë””í´íŠ¸ë¡œ ì„ íƒí•  spjangcd ê°’
        let defaultSpjangcd = null;

        if (!savedSpjangcd && spjangList.length >= 2) {
            const zzItem = spjangList.find(item => item.spjangcd === 'ZZ');
            if (zzItem) {
                defaultSpjangcd = 'ZZ';
                sessionStorage.setItem('spjangcd', 'ZZ');
            }
        }

        spjangList.forEach((item, index) => {
            const option = document.createElement('option');
            option.value = item.spjangcd;
            option.textContent = item.spjangnm;

            if (savedSpjangcd) {
                option.selected = (item.spjangcd === savedSpjangcd);
            } else if (defaultSpjangcd) {
                option.selected = (item.spjangcd === defaultSpjangcd);
            } else if (index === 0) {
                option.selected = true;
                sessionStorage.setItem('spjangcd', item.spjangcd); // ì²« í•­ëª© ì €ì¥
            }

            select.appendChild(option);
        });

        select.addEventListener('change', function () {
            sessionStorage.setItem('spjangcd', this.value);
            window.location.reload();
        });

        wrapper.appendChild(select);
    });

</script>

<input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
<style>
    .select-no-border {
        font-size: 14px;
        width: 110px;
        max-width: 110px;
        padding: 0 10px;
        border: none;
        outline: none;
        background-color: transparent;
        appearance: none;
        border-bottom: 1px solid;
        border-radius: 0;
        -webkit-appearance: none;
        -moz-appearance: none;
    }

    /* í¬ì»¤ìŠ¤ ì‹œ ì€ì€í•œ íšŒìƒ‰ í…Œë‘ë¦¬ */
    .select-no-border:focus {
        border: 1px solid #ccc;
        border-radius: 4px;
        outline: none;
        box-shadow: 0 0 0 1px rgba(0, 0, 0, 0.08);
    }
</style>
</body>
</html>

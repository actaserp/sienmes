<html layout:decorate="~{layout_page}">
<head>
    <style>
        .back_current {
            background-color: #d4edda !important; /* ì—°í•œ ì´ˆë¡ */
        }

        .back_past {
            background-color: #f8d7da !important; /* ì—°í•œ ë¹¨ê°• */
        }

        .back_future {
            background-color: #d1ecf1 !important; /* ì—°í•œ íŒŒë‘ */
        }

        .back_error {
            background-color: #f5c6cb !important; /* ì—°í•œ ë¶„í™ */
        }

    </style>
</head>

<th:block layout:fragment="content">
    <div class="layout-contents">
        <div class="page-title-wrap">
            <div class="left">
                <h2>BOM</h2>
                <a title="ë¶ë§ˆí¬" class="bookmark toggle">
                    ë‚´ ë©”ë‰´
                </a>
            </div>
            <ul class="page-navi">
                <li><img src="/images/icon/ico-nav-home.svg" alt="í™ˆì•„ì´ì½˜"></li>
                <li>ì¼ì§€ ë° ë°ì´í„°</li>
                <li>ê¸°ì¤€ì •ë³´</li>
                <li>BOM</li>
            </ul>
        </div>

        <section class="section">
            <div class="section-top">
                <div class="search-wrap">
                    <dl>
                        <dt>
                            <label>BOMêµ¬ë¶„</label>
                        </dt>
                        <dd>
                            <select class="form-control2" id="cboBOMType" name="cboBOMType"></select>
                        </dd>

                    </dl>
                    <dl>
                        <dt>
                            <label>í’ˆëª©êµ¬ë¶„</label>
                        </dt>
                        <dd>
                            <select class="form-control2" id="cboMaterialType" name="cboMaterialType"></select>
                        </dd>
                    </dl>

                    <dl>
                        <dt>
                            <label>í’ˆëª©ê·¸ë£¹</label>
                        </dt>
                        <dd>
                            <select class="form-control2" id="cboMaterialGroup" name="cboMaterialGroup"></select>
                        </dd>
                    </dl>

                    <dl>
                        <dt>
                            <label>ì œí’ˆëª…</label>
                        </dt>
                        <dd>
                            <input type="text" class="form-control2" id="txtMatName" name="txtMatName">
                        </dd>
                    </dl>

                    <dl>
                        <dt>
                            <label>ìµœì¢…</label>
                        </dt>
                        <dd>
                            <input class="form-control2" type="checkbox" id="not_past_flag" name="not_past_flag"
                                   value="Y" checked/>
                        </dd>
                    </dl>
                    <dl>
                        <dt><span class="eq"></span></dt>
                        <dd>
                            <li>
                                <a class="btn btn-delete" title="ê²€ìƒ‰" id="btnSearch">
                                    <img src="/images/icon/btn-srch.svg" alt="ê²€ìƒ‰ ì•„ì´ì½˜">
                                    ê²€ìƒ‰
                                </a>
                            </li>
                        </dd>
                    </dl>
                </div>
                <div class="button-wrap">
                    <button type="button" class="btn-default" id="btnBomNew"
                            style="width: 90px; height: 36px; float: none;">ë“±ë¡</button>
                    <button type="button" class="btn-danger y_write_auth" id="btnBomDelete"
                            style="width: 90px; height: 36px; float: none;">ì‚­ì œ
                    </button>
                    <button type="button" class="btn-default" id="btnBomEdit"
                            style="width: 90px; height: 36px; float: none;">ìˆ˜ì •</button>
                    <button type="button" class="btn-default y_write_auth" id="btnBomReplicate" data-labelCd="ë³µì œ"
                            style="width: 90px; height: 36px; float: none;">
                    </button>
                    <button type="button" class="btn-default y_write_auth" id="btnBomRevision" data-labelCd="ê°œì •"
                            style="width: 90px; height: 36px; float: none;">
                    </button>
                </div>
            </div>

            <!-- <div class="grid_box">
                 <div class="h-280" data-ax5grid="bom-grid" ></div>
             </div>-->
            <div class="container-fluid">
                <div id="bom-grid" style="height: 280px; max-height: 280px;"></div>
            </div>
        </section>

        <div class="tab-wrap">
            <ul class="tab-links">
                <li><a href="#tab_basic" name="tabs_basic">1ë ˆë²¨</a></li>
                <li><a href="#tab_tree" name="tab_tree">ì „ì²´ë ˆë²¨</a></li>
                <li><a href="#tab_copy_text" name="tab_copy_text">í…ìŠ¤íŠ¸ì…ë ¥</a></li>
            </ul>
            <div>
                <section class="tab-item" id="tab_basic" style="border-top-left-radius: 0;">
                    <div class="section-top">
                        <div class="button-wrap">
                            <ul>
                                <li>
                                    <button type="button" class="btn-default" id="btnBomCompNew"
                                            style="width: 115px; height: 36px;"><i
                                            class="fas fa-plus"></i>ë“±ë¡
                                    </button>
                                </li>

                                <li>
                                    <button type="button" class="btn-danger y_write_auth" id="btnBomCompDelete"
                                            style="width: 115px; height: 36px;"><i
                                            class="fas fa-trash"></i>ì‚­ì œ
                                    </button>
                                </li>

                                <li>
                                    <button type="button" class="btn-default" id="btnBomCompEdit"
                                            style="width: 115px; height: 36px;"><i
                                            class="fas fa-edit"></i>ìˆ˜ì •
                                    </button>
                                </li>
                                <li>
                                    <button type="button" class="btn-default" id="btnCompUp" title="ìˆœì„œ ì¡°ì •-ìœ„ë¡œ"
                                            style="width: 150px; height: 36px;"><i
                                            class="fas fa-arrow-up"></i> ìˆœì„œ ì¡°ì •-ìœ„ë¡œ
                                    </button>
                                </li>
                                <li>
                                    <button type="button" class="btn-default" id="btnCompDown" title="ìˆœì„œ ì¡°ì •-ì•„ë˜ë¡œ"
                                            style="width: 150px; height: 36px;"><i
                                            class="fas fa-arrow-down"></i> ìˆœì„œ ì¡°ì •-ì•„ë˜ë¡œ
                                    </button>
                                </li>
                                <li>
                                    <button type="button" class="btn-default y_write_auth" id="btnCompOrderSave"
                                            style="width: 115px; height: 36px;"><span
                                            data-labelCd="ìˆœì„œ ì €ì¥">ìˆœì„œ ì €ì¥</span></button>
                                </li>
                            </ul>
                        </div>
                    </div>
                    <div>
                        <!-- <div class="grid_box">
                             <div class="h-600" data-ax5grid="bomcomp-grid" ></div>
                         </div>-->
                        <div class="container-fluid">
                            <div id="bomcomp-grid" style="height: 240px; max-height: 240px;"></div>
                        </div>
                    </div>
                </section>
                <!--section2-->
                <section class="tab-item" id="tab_tree" style="border-top-left-radius: 0;">
                    <div class="section-top">
                        <div class="button-wrap">
                            <ul>
                                <li>
                                    <button type="button" class="btn-default" id="btnBomTreeView"><i
                                            class="fas fa-search"></i></button>
                                </li>
                            </ul>
                        </div>
                    </div>
                    <div>
                        <!-- <div class="grid_box">
                             <div class="h-600" data-ax5grid="bomtree-grid" ></div>
                         </div>-->
                        <div class="container-fluid">
                            <div id="bomtree-grid" style="height: 240px; max-height: 240px;"></div>
                        </div>
                    </div>
                </section>
                <!--section3-->
                <section class="tab-item" id="tab_copy_text" style="border-top-left-radius: 0;">
                    <div class="section-top">
                        <div class="button-wrap">
                            <ul>
                                <li>
                                    <button type="button" class="btn-default y_write_auth" id="btnSaveBomText"
                                            style="float:none"><i class="fas fa-save"></i></button>
                                </li>
                                <!--<span class="right_align lpt" >í’ˆëª©ì½”ë“œ,ìˆ˜ëŸ‰,ë¹„ê³  ìˆœìœ¼ë¡œ ì—‘ì…€ì—ì„œ ì‘ì„± í›„ ë¶™ì—¬ë„£ê¸° í•˜ì„¸ìš”. ê¸°ì¡´ BOMêµ¬ì„±ì€ ëª¨ë‘ ì‚­ì œë˜ê³  ì €ì¥ë˜ë‹ˆ ì£¼ì˜í•´ì•¼ í•©ë‹ˆë‹¤.&nbsp;&nbsp;&nbsp;&nbsp;</span>-->
                            </ul>
                        </div>
                    </div>
                    <div style="height: 240px;">
                        <textarea id="txtCopyText" rows="15" style="height: 240px"></textarea>
                    </div>
                </section>
            </div>
        </div>
    </div>
<!-- BOM ë“±ë¡ ìŠ¤í¬ë¦½íŠ¸ -->
    <script type="text/x-tmpl" id="bomCreateTemplate">
        <div class="content_wrap popup">
            <!--<header>
                <h4 id="popTitle">
                {% if (o.id!='') { %}
                  BOM ìˆ˜ì •({%=o.Name%})
                  {% } else { %}
                  BOM ë“±ë¡
                  {% } %}
                </h4>
                <div class="popup_close_box"><button class="btn_popup_close" id="modal-close-x"><i class="fas fa-times"></i></button></div>
            </header>-->

    <div class="table-wrap">
           <form id="bomForm">
                <table class="write-table">
                    <input type="hidden" id="id" name="id" value="{%=o.id%}">
                    <caption>ì£¼ë¬¸ë“±ë¡ í…Œì´ë¸”</caption>
                    <tbody>
                        <tr>
                            <th style="text-align: center">
                                <label for="popMaterialType">í’ˆëª©êµ¬ë¶„</label>
                            </th>
                            <td>
                                <select class="form-control2" id='popMaterialType' name="popMaterialType"></select>
                            </td>

                            <th style="text-align: center">
                                <label for="popMaterialGroup">í’ˆëª©ê·¸ë£¹</label>
                            </th>
                            <td>
                                <select class="form-control2" id="popMaterialGroup" name="popMaterialGroup"></select>
                            </td>
                        </tr>

                        <tr>
                            <th style="text-align: center">
                                <label for="txtProductName">í’ˆëª©ëª…</label>
                            </th>
                            <td>
                                <input class="form-control2" type="text" id="keyword" name="keyword" />
                            </td>
                           &nbsp;
                            <td colspan="2" style="text-align: center;">
                                <button type="button" class="btn-default" id="btnMatSearch" title="ì¡°íšŒ"><i class="fas fa-search"></i>ê²€ìƒ‰</button>
                            </td>
                        </tr>
                    </tbody>
                </table>

                <div class="grid_box" style="margin-top: 10px;">
                    <div id="material-search-grid" style="height: 250px; max-height: 250px;"></div>
                </div>

              <table class="write-table">
                    <tfoot>
                        <tr>
                            <th style="text-align: center">
                               <label for="Material_id">*(ë°˜)ì œí’ˆëª…</label>
                            </th>
                            <td>
                                <input class="form-control2" type="hidden" id="Material_id" name="Material_id" value="{%=o.Material_id%}" />
                                <input class="form-control2" type="text" id="MaterialName" name="MaterialName" readonly="readonly"  value="{%=o.MaterialName%}" />
                            </td>

                            <th style="text-align: center">
                                <label for="Name">*BOMëª…</label>
                            </th>
                            <td>
                                <input class="form-control2" type="text" id="Name" name="Name" value="{%=o.Name%}" />
                            </td>
                        </tr>

                        <tr>
                            <th style="text-align: center">
                                <label for="OutputAmount">*ê¸°ì¤€ìˆ˜ëŸ‰</label>
                            </th>
                            <td>
                                <input class="form-control2 tar" type="number" id="OutputAmount" name="OutputAmount" value="{%=o.OutputAmount%}" />
                            </td>

                            <th style="text-align: center">
                                <label for="BOMType">*BOMì¢…ë¥˜</label>
                            </th>
                            <td>
                                <select class="form-control2" id="BOMType" name="BOMType"></select>
                            </td>
                        </tr>

                        <tr>
                            <th style="text-align: center">
                                <label for="Version">ë²„ì „</label>
                            </th>
                            <td>
                                <input class="form-control2 tar" id="Version" name="Version" value="{%=o.Version%}" />
                            </td>
                            <th></th>
                            <td></td>
                        </tr>

                        <tr>
                            <th style="text-align: center">
                                <label for="StartDate">*ì ìš©ì‹œì‘ì¼</label>
                            </th>
                            <td>
                                <input class="form-control2 tac" type="date" id="StartDate" name="StartDate" value="{%=o.StartDate%}">
                                <!--<span class="input-group-text fs-xl"><i class="fas fa-calendar-alt calendar_color"></i></span>-->
                            </td>

                            <th style="text-align: center">
                                <label for="EndDate">*ì ìš©ì¢…ë£Œì¼</label>
                            </th>
                            <td>
                                <input class="form-control2 tac" type="date" id="EndDate" name="EndDate" value="{%=o.EndDate%}">
                                <!-- <span class="input-group-text fs-xl"><i class="fas fa-calendar-alt calendar_color"></i></span>-->
                            </td>
                    </tr>
               </tfoot>
            </table>
        </form>
    </div>

        <div class="popup-button">
          <button type="button" class="btn-popup y_write_auth" id="btnBomSave" ><span data-labelCd="ì €ì¥">ì €ì¥</span></button>
          <button type="button" class="btn-popup" id="modal-close-button"><span data-labelCd="ë‹«ê¸°">ë‹«ê¸°</span></button>
          <button type="button" class="btn-popup" id="btnTest"><span data-labelCd="ìƒˆë¡œê³ ì¹¨">ìƒˆë¡œê³ ì¹¨</span></button>
        </div>
</div>
</script>


    <!-- êµ¬ì„±í’ˆëª© ë“±ë¡ ìŠ¤í¬ë¦½íŠ¸ -->
    <script type="text/x-tmpl" id="bomMaterialTemplate">
        <div class="content_wrap popup">
            <!--<header>
                <h4 id="popTitle">
                {% if (o.id!='') { %}
                  êµ¬ì„±í’ˆëª© ìˆ˜ì •({%=o.ParentMaterialName%})
                  {% } else { %}
                  êµ¬ì„±í’ˆëª© ë“±ë¡
                  {% } %}
                </h4>
                <div class="popup_close_box"><button class="btn_popup_close" id="modal-close"><i class="fas fa-times"></i></button></div>
            </header>-->


            <div class="table-wrap">
           <form id="materialForm">
                <table class="write-table">
                    <input type="hidden" id="BOM_id" name="BOM_id" value="{%=o.BOM_id%}">
                    <input type="hidden" id="id" name="id" value="{%=o.id%}">

                    <caption>ì£¼ë¬¸ë“±ë¡ í…Œì´ë¸”</caption>
                    <tbody>
                        <tr>
                            <th style="text-align: center">
                                <label for="popMaterialType">í’ˆëª©êµ¬ë¶„</label>
                            </th>
                            <td>
                                 <select class="form-control2" id='popMaterialType' name="popMaterialType" ></select>
                            </td>

                            <th style="text-align: center">
                                <label for="popMaterialGroup">í’ˆëª©ê·¸ë£¹</label>
                            </th>
                            <td>
                                <select class="form-control2" id="popMaterialGroup" name="popMaterialGroup"></select>
                            </td>
                        </tr>

                        <tr>
                            <th style="text-align: center">
                                <label for="txtProductName">í’ˆëª©ëª…</label>
                            </th>
                            <td>
                                <input class="form-control2" type="text" id="keyword" name="keyword" />
                            </td>
                           &nbsp;
                            <td colspan="2" style="text-align: center;">
                                <button type="button" class="btn-default" id="btnMatSearch" title="ê²€ìƒ‰">ê²€ìƒ‰</button>
                            </td>
                        </tr>
                    </tbody>
                </table>

                <div class="grid_box" style="margin-top: 10px;">
                    <div id="material-search-grid" style="height: 250px; max-height: 250px;"></div>
                </div>


              <table class="write-table">
                    <tfoot>
                        <tr>
                            <th style="text-align: center">
                               <label for="Material_id">*í’ˆëª©ëª…</label>
                            </th>
                            <td colspan="3">
                               <input class="form-control2" type="hidden" id="Material_id" name="Material_id" value="{%=o.Material_id%}"  />
                               <input class="form-control2" type="text" id="MaterialName" name="MaterialName" readonly="readonly" value="{%=o.MaterialName%}" style="width:100%"/>
                            </td>
                        </tr>

                        <tr>
                            <th style="text-align: center">
                                <label for="Name">*í•„ìš”ìˆ˜ëŸ‰</label>
                            </th>
                            <td>
                                 <input class="form-control2 tar" type="number" id="Amount" name="Amount" value="{%=o.Amount%}" />
                            </td>
                            <th style="text-align: center">
                                <label for="_order">ìˆœì„œ</label>
                            </th>
                            <td>
                                <input class="form-control2" type="number" id="_order" name="_order" value="{%=o._order%}" />
                            </td>
                        </tr>

                        <tr>
                              <th style="text-align: center">
                                <label for="Description">ë¹„ê³ </label>
                            </th>
                            <td colspan="3">
                               <textarea class="form-control2" id="Description" name="Description">{%=o.Description%}</textarea>
                            </td>
                        </tr>
               </tfoot>
            </table>
        </form>
    </div>


        <div class="popup-button">
          <button type="button" class="btn-popup y_write_auth" id="btnBomMaterialSave" ><span data-labelCd="ì €ì¥">ì €ì¥</span></button>
          <button type="button" class="btn-popup" id="modal-close-button"><span data-labelCd="ë‹«ê¸°">ë‹«ê¸°</span></button>
          <button type="button" class="btn-popup" id="btnTest"><span data-labelCd="ìƒˆë¡œê³ ì¹¨">ìƒˆë¡œê³ ì¹¨</span></button>
        </div>


        </div>
    </script>

</th:block>

<th:block layout:fragment="scripts">
    <th:block th:replace="/common/columns_setting :: columns_setting"></th:block>
    <script type="text/javascript" src="/js/grid.js"></script>

    <script type="text/javascript">

        class BOMPage {
            constructor() {
                this.gridBom = null;
                this.gridBomComp = null;
                this.viewData = new wijmo.collections.CollectionView();
                this.viewData2 = new wijmo.collections.CollectionView();
                this.viewData3 = new wijmo.collections.CollectionView();
                this.viewData4 = new wijmo.collections.CollectionView();
                this.init();
            }

            init() {
                let _this = this;

                /*let configBom = {
                    target: $('[data-ax5grid="bom-grid"]'),
                    sortable: true,
                    frozenColumnIndex: 0, // ì—´ ê³ ì •
                    frozenRowIndex: 0,    // í–‰ ê³ ì •
                    showLineNumber: true, // ì—´ì˜ ë²ˆí˜¸ ë³´ì´ê¸° ì—¬ë¶€
                    showRowSelector: false,  // checkbox(ì„ íƒ) ë³´ì´ê¸° ì—¬ë¶€
                    multipleSelect: false, // ì—¬ëŸ¬í–‰ ì„ íƒ ê°€ëŠ¥ ì—¬ë¶€ (falseì‹œ ë‹¨ë… ì„ íƒ)
                    sortable: true, // ëª¨ë“  ì»¬ëŸ¼ì— ì •ë ¬ ì•„ì´ì½˜ í‘œì‹œ (columnsì—ì„œ ì»¬ëŸ¼ë³„ ì†ŒíŒ…ì—¬ë¶€ ì¬ì„¤ì • ê°€ëŠ¥)
                    multiSort: true, // ë‹¤ì¤‘ ì •ë ¬ ì—¬ë¶€
                    header: {
                        align: 'center',  // í—¤ë”ì˜ ê¸°ë³¸ ì •ë ¬
                        columnHeight: 30  // í—¤ë” ë†’ì´
                    },
                    body: {
                        columnHeight: 25, // bodyì˜ ê¸°ë³¸ ë†’ì´
                        onClick: function (e) {
                            //e.colIndex
                            //e.dindex
                            //c.value
                            //e.column
                            //e.item
                            //e.list
                            _this.gridBom.select(this.dindex);
                            _this.showBomCompList(e.item.id);
                            //_this.showBomCompTreeList(e.item.id);
                        },
                    },
                    page: {
                        display: true,  // í˜ì´ì§• ë³´ì´ê¸° ì—¬ë¶€
                        statusDisplay: true,
                    },
                    columns: [
                        {key: 'id', label: 'ë²ˆí˜¸', width: 50, align: 'left'},
                        {key: 'mat_type', label: 'í’ˆëª©êµ¬ë¶„', width: 110, align: 'center'},
                        {key: 'mat_group_name', label: 'í’ˆëª©ê·¸ë£¹', width: 110, align: 'left'},
                        {key: 'mat_code', label: '(ë°˜)ì œí’ˆì½”ë“œ', width: 110, align: 'center'},
                        {key: 'mat_name', label: '(ë°˜)ì œí’ˆëª…', width: 200, align: 'left'},
                        {key: 'bom_type_name', label: 'BOMì¢…ë¥˜', width: 120, align: 'center'},
                        {
                            key: 'Name', label: 'BOMëª…', width: 200, align: 'left',
                            styleClass: function () {
                                if (this.item.current_flag == 'current')
                                    return 'back_current';
                                if (this.item.current_flag == 'past')
                                    return 'back_past';
                                if (this.item.current_flag == 'future')
                                    return 'back_future';
                                if (this.item.current_flag == 'error')
                                    return 'back_error';
                                //return 'background-white';
                            }
                        },
                        {key: 'OutputAmount', label: 'ê¸°ì¤€ìˆ˜ëŸ‰', width: 110, align: 'right'},
                        {key: 'unit', label: 'ë‹¨ìœ„', width: 110, align: 'center'},
                        {key: 'Version', label: 'Ver.', width: 110, align: 'center'},
                        {key: 'StartDate', label: 'ì ìš©ì‹œì‘ì¼', width: 130, align: 'center'},
                        {key: 'EndDate', label: 'ì ìš©ì¢…ë£Œì¼', width: 130, align: 'center'},
                        //{ key: 'Description', label: 'ì„¤ëª…', width: 250, align: 'center' },
                    ]

                };*/

                //ë©”ì¸ ê·¸ë¦¬ë“œ
                this.grid = new wijmo.grid.FlexGrid('#bom-grid', {
                    selectionMode: wijmo.grid.SelectionMode.Row,
                    headersVisibility: wijmo.grid.HeadersVisibility.Column,
                    autoGenerateColumns: false,
                    showMarquee: true,
                    isReadOnly: true,
                    formatItem: (sender, e) => {
                        if (e.panel.cellType === wijmo.grid.CellType.ColumnHeader) {
                            e.cell.style.textAlign = 'center';
                        }
                        if (e.panel.cellType === wijmo.grid.CellType.Cell) {
                            let item = sender.rows[e.row].dataItem; // í˜„ì¬ í–‰ì˜ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
                            if (e.col === sender.columns.indexOf(sender.columns.getColumn('Name'))) {
                                if (item.current_flag === 'current') {
                                    e.cell.classList.add('back_current');
                                } else if (item.current_flag === 'past') {
                                    e.cell.classList.add('back_past');
                                } else if (item.current_flag === 'future') {
                                    e.cell.classList.add('back_future');
                                } else if (item.current_flag === 'error') {
                                    e.cell.classList.add('back_error');
                                }
                            }
                        }
                    },
                    columns: [
                        {binding: 'id', header: 'ë²ˆí˜¸', width: 100, align: 'left'},
                        {binding: 'mat_type', header: 'í’ˆëª©êµ¬ë¶„', width: 110, align: 'center'},
                        {binding: 'mat_group_name', header: 'í’ˆëª©ê·¸ë£¹', width: '*', align: 'left'},
                        {binding: 'mat_code', header: '(ë°˜)ì œí’ˆì½”ë“œ', width: 110, align: 'center'},
                        {binding: 'mat_name', header: '(ë°˜)ì œí’ˆëª…', width: 200, align: 'left'},
                        {binding: 'bom_type_name', header: 'BOMì¢…ë¥˜', width: 120, align: 'center'},
                        {binding: 'Name', header: 'BOMëª…', width: 200, align: 'left'},
                        {binding: 'OutputAmount', header: 'ê¸°ì¤€ìˆ˜ëŸ‰', width: 110, align: 'right'},
                        {binding: 'unit', header: 'ë‹¨ìœ„', width: 110, align: 'center'},
                        {binding: 'Version', header: 'Ver.', width: 110, align: 'center'},
                        {binding: 'StartDate', header: 'ì ìš©ì‹œì‘ì¼', width: 130, align: 'center'},
                        {binding: 'EndDate', header: 'ì ìš©ì¢…ë£Œì¼', width: 130, align: 'center'},
                    ],
                    itemsSource: this.viewData, // ë°ì´í„°ë¥¼ ì„¤ì •í•  ë°°ì—´
                });

                this.grid.hostElement.addEventListener('dblclick', (e) => {
                    let hitTest = this.grid.hitTest(e);
                    if (hitTest.cellType === wijmo.grid.CellType.Cell) {
                        let row = hitTest.row;
                        let selectedItem = this.grid.rows[row].dataItem;
                        _this.showBomCompList(selectedItem.id)
                       /* _this.showBomCompTreeList(selectedItem.id)*/
                    }
                });

                new FlexGridContextMenu(this.grid);
                this.grid.downloadFileName = 'BOM';


                // 1ë ˆë²¨ ê·¸ë¦¬ë“œ
                this.grid2 = new wijmo.grid.FlexGrid('#bomcomp-grid', {
                    selectionMode: wijmo.grid.SelectionMode.Row,
                    headersVisibility: wijmo.grid.HeadersVisibility.Column,
                    autoGenerateColumns: false,
                    showMarquee: true,
                    isReadOnly: false, // í¸ì§‘ ê°€ëŠ¥í•˜ë„ë¡ ë³€ê²½
                    allowSorting: false, // ì •ë ¬ ë¹„í™œì„±í™” (ì„ íƒ ì‚¬í•­)
                    formatItem: (sender, e) => {
                        if (e.panel.cellType === wijmo.grid.CellType.ColumnHeader) {
                            e.cell.style.textAlign = 'center';
                        }
                    },
                    columns: [
                        {binding: '_order', header: 'ìˆœì„œ', width: 120, align: 'center'},
                        {binding: 'mat_type', header: 'í’ˆëª©êµ¬ë¶„', width: 120, align: 'center'},
                        {binding: 'mat_code', header: 'í’ˆëª©ì½”ë“œ', width: 150, align: 'center'},
                        {binding: 'mat_name', header: 'í’ˆëª©ëª…', width: 350, align: 'left'},
                        {binding: 'Amount', header: 'í•„ìš”ìˆ˜ëŸ‰', width: 120, align: 'right'},
                        {binding: 'unit', header: 'ë‹¨ìœ„', width: 100, align: 'center'},
                        {
                            binding: 'Description',
                            header: 'ë¹„ê³ ',
                            width: "*",
                            align: 'left',
                            isReadOnly: false, // í¸ì§‘ ê°€ëŠ¥
                            multiLine: true // ì—¬ëŸ¬ ì¤„ ì…ë ¥ í—ˆìš©
                        }
                    ],
                    itemsSource: this.viewData2, // ë°ì´í„°ë¥¼ ì„¤ì •í•  ë°°ì—´
                });

                new FlexGridContextMenu(this.grid2);
                this.grid2.downloadFileName = '1ë ˆë²¨';


                /*let configBomTree = {
                    target: $('[data-ax5grid="bomtree-grid"]'),
                    sortable: true,
                    frozenColumnIndex: 0, // ì—´ ê³ ì •
                    frozenRowIndex: 0,    // í–‰ ê³ ì •
                    showLineNumber: true, // ì—´ì˜ ë²ˆí˜¸ ë³´ì´ê¸° ì—¬ë¶€
                    showRowSelector: true,  // checkbox(ì„ íƒ) ë³´ì´ê¸° ì—¬ë¶€
                    multipleSelect: true, // ì—¬ëŸ¬í–‰ ì„ íƒ ê°€ëŠ¥ ì—¬ë¶€ (falseì‹œ ë‹¨ë… ì„ íƒ)
                    sortable: false, // ëª¨ë“  ì»¬ëŸ¼ì— ì •ë ¬ ì•„ì´ì½˜ í‘œì‹œ (columnsì—ì„œ ì»¬ëŸ¼ë³„ ì†ŒíŒ…ì—¬ë¶€ ì¬ì„¤ì • ê°€ëŠ¥)
                    multiSort: false, // ë‹¤ì¤‘ ì •ë ¬ ì—¬ë¶€
                    header: {
                        align: 'center',  // í—¤ë”ì˜ ê¸°ë³¸ ì •ë ¬
                        columnHeight: 30  // í—¤ë” ë†’ì´
                    },
                    body: {
                        columnHeight: 25, // bodyì˜ ê¸°ë³¸ ë†’ì´
                        onClick: function (e) {
                            //this.self.selectAll({ selected: false });
                            this.self.select(this.dindex, {__selected__: true});
                            //e.self.select(this.dindex, {selected: true});
                            //_this.gridBomComp.select(this.dindex);
                            //this.self.select(this.dindex, {__selected__: true});
                        },
                    },
                    page: {
                        display: true,  // í˜ì´ì§• ë³´ì´ê¸° ì—¬ë¶€
                        statusDisplay: true,
                    },
                    columns: [
                        {binding: 'mat_type', header: 'í’ˆëª©êµ¬ë¶„', width: 120, align: 'center'},
                        {binding: 'mat_code', header: 'í’ˆëª©ì½”ë“œ', width: 150, align: 'center'},
                        {binding: 'lvl', header: 'ë ˆë²¨', width: 100, align: 'right'},
                        {binding: 'mat_name', header: 'í’ˆëª©ëª…', width: 350, align: 'left', treeControl: true},
                        {binding: 'bom_ratio', header: 'íˆ¬ì…ë¹„(ìµœì¢…ìƒì‚°í’ˆê¸°ì¤€)', width: 80, align: 'right'},
                        {binding: 'bom_qty', header: 'í•„ìš”ëŸ‰(ì¤‘ê°„ìƒì‚°í’ˆê¸°ì¤€)', width: 80, align: 'right'},
                        {binding: 'unit', header: 'ë‹¨ìœ„', width: 100, align: 'center'},
                        {
                            binding: 'Description', header: 'ë¹„ê³ ', width: 300, align: 'left',
                            editor: {type: 'textarea'}
                        },
                    ],
                    tree: {
                        use: true,
                        indentWidth: 15,
                        arrowWidth: 15,
                        iconWidth: 18,
                        icons: {
                            openedArrow: '<i class="fa fa-caret-down" aria-hidden="true"></i>',
                            collapsedArrow: '<i class="fa fa-caret-right" aria-hidden="true"></i>',
                            groupIcon: '<i class="fa fa-minus-square" aria-hidden="true"></i>',
                            collapsedGroupIcon: '<i class="fa fa-plus-square" aria-hidden="true"></i>',
                            //itemIcon: '-'
                        },
                        columnKeys: {
                            parentbinding: 'parent_key',
                            selfbinding: 'my_key'
                        }
                    },
                };
*/
                // ì „ì²´ë ˆë²¨ ê·¸ë¦¬ë“œ
                this.grid3 = new wijmo.grid.FlexGrid('#bomtree-grid', {
                    selectionMode: wijmo.grid.SelectionMode.Row,
                    headersVisibility: wijmo.grid.HeadersVisibility.Column,
                    autoGenerateColumns: false,
                    showMarquee: true,
                    isReadOnly: false,
                    formatItem: (sender, e) => {
                        if (e.panel.cellType === wijmo.grid.CellType.ColumnHeader) {
                            e.cell.style.textAlign = 'center';
                        }
                    },
                    columns: [
                        {binding: 'mat_type', header: 'í’ˆëª©êµ¬ë¶„', width: 120, align: 'center'},
                        {binding: 'mat_code', header: 'í’ˆëª©ì½”ë“œ', width: 150, align: 'center'},
                        {binding: 'lvl', header: 'ë ˆë²¨', width: 100, align: 'right'},
                        {binding: 'mat_name', header: 'í’ˆëª©ëª…', width: 350, align: 'left'}, // treeControl ì œê±°
                        {binding: 'bom_ratio', header: 'íˆ¬ì…ë¹„(ìµœì¢…ìƒì‚°í’ˆê¸°ì¤€)', width: 150, align: 'right'},
                        {binding: 'bom_qty', header: 'í•„ìš”ëŸ‰(ì¤‘ê°„ìƒì‚°í’ˆê¸°ì¤€)', width: 150, align: 'right'},
                        {binding: 'unit', header: 'ë‹¨ìœ„', width: "*", align: 'center'},
                        {
                            binding: 'Description',
                            header: 'ë¹„ê³ ',
                            width: 300,
                            align: 'left',
                            isReadOnly: false, // í¸ì§‘ ê°€ëŠ¥
                            multiLine: true // ì—¬ëŸ¬ ì¤„ ì…ë ¥ í—ˆìš©
                        },
                    ],
                    childItemsPath: 'children', // íŠ¸ë¦¬ ê³„ì¸µ êµ¬ì¡° ì„¤ì •
                    itemsSource: this.viewData3, // ë°ì´í„°ë¥¼ ì„¤ì •í•  ë°°ì—´
                });


                new FlexGridContextMenu(this.grid3);
                this.grid3.downloadFileName = 'ì „ì²´ë ˆë²¨';


                AjaxUtil.fillSelectOptions($('#cboMaterialType'), 'system_code', 'all', false, 'mat_type');
                AjaxUtil.fillSelectOptions($('#cboMaterialGroup'), 'material_group', 'all', false);
                AjaxUtil.fillSelectOptions($('#cboBOMType'), 'system_code', 'all', false, 'bom_type');

                $('#cboMaterialType').on('change', function (e) {
                    let mat_type = $('#cboMaterialType').val();
                    AjaxUtil.fillSelectOptions($('#cboMaterialGroup'), 'material_group', 'all', false, mat_type);
                });

                $('#txtMatName').on('keypress', function (e) {
                    if (event.keyCode == 13) {
                        _this.searchBomList();
                    }
                });

            }

            showBomEdit(data) {
                let _this = this;
                let content = tmpl('bomCreateTemplate', data);
                let $content = $(content);

                let modalContainer = new PopupDraggable(data.id ? 'BOM ìˆ˜ì •' : 'BOM ë“±ë¡');
                modalContainer.open({width: 1025, height: 700, $content});

                $('#popSrchDt1').ax5DatePicker({direction: 'top'});
                $('#popSrchDt2').ax5DatePicker({direction: 'top'});

                let $MaterialName = $content.find('#MaterialName');
                let $Material_id = $content.find('#Material_id');
                let $BomName = $content.find('#Name');

                let $matSearchGrid = null;
                let selectedItem = null;
                let target = $content.find('#material-search-grid');


                this.viewData4 = Array.isArray(this.viewData4) ? this.viewData4 : [];

                this.grid4 = new wijmo.grid.FlexGrid('#material-search-grid', {
                    selectionMode: wijmo.grid.SelectionMode.Row,
                    headersVisibility: wijmo.grid.HeadersVisibility.Column,
                    autoGenerateColumns: false,
                    showMarquee: true,
                    isReadOnly: false,
                    formatItem: (sender, e) => {
                        if (e.panel.cellType === wijmo.grid.CellType.ColumnHeader) {
                            e.cell.style.textAlign = 'center';
                        }
                    },
                    columns: [
                        {binding: 'MaterialTypeName', header: 'í’ˆëª©êµ¬ë¶„', width: 100, align: 'left'},
                        {binding: 'group_name', header: 'í’ˆëª©ê·¸ë£¹', width: 150, align: 'left'},
                        {binding: 'Code', header: 'í’ˆëª©ì½”ë“œ', width: 150, align: 'center'},
                        {binding: 'Name', header: 'í’ˆëª©ëª…', width: 200, align: 'left'},
                        {binding: '', header: '', width: '*', align: 'left'}
                    ],
                    itemsSource: this.viewData4
                });


                this.grid4.hostElement.addEventListener('dblclick', (e) => {
                    let hitTest = this.grid4.hitTest(e);
                    if (hitTest.cellType === wijmo.grid.CellType.Cell) {
                        let row = hitTest.row;
                        let selectedItem = this.grid4.rows[row].dataItem;
                        $Material_id.val(selectedItem.id);
                        $MaterialName.val(selectedItem.Name);
                        $BomName.val(selectedItem.Name);
                    }
                });

                $matSearchGrid = this.grid4; // ê¸°ì¡´ grid4ë¥¼ í• ë‹¹

                $content.find('#btnBomSave').on('click', function () {
                    let $form = $content.find('#bomForm');
                    Alert.confirm('', 'ì €ì¥í•˜ì‹œê² ìŠµë‹ˆê¹Œ?', function () {
                        _this.saveBOMData($form);
                    });
                });

                let $popMaterialType = $content.find('#popMaterialType');
                let $popMaterialGroup = $content.find('#popMaterialGroup');
                let $keyword = $content.find('#keyword');

                $popMaterialType.append('<option value="product">ì œí’ˆ</option>');
                $popMaterialType.append('<option value="semi">ë°˜ì œí’ˆ</option>');

                AjaxUtil.fillSelectOptions($popMaterialGroup, 'material_group', 'all', '', 'product');

                $popMaterialType.change(function () {
                    AjaxUtil.fillSelectOptions($popMaterialGroup, 'material_group', 'all', '', $popMaterialType.val());
                });

                let $bomType = $content.find('#BOMType');
                AjaxUtil.fillSelectOptions($bomType, 'system_code', '', data.BOMType, 'bom_type');

                // ê²€ìƒ‰ ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸
                $content.find('#btnMatSearch').click(function () {
                    let matType = $popMaterialType.val();
                    let matGroup = $popMaterialGroup.val();
                    let keyword = $keyword.val();
                    let url = '/api/popup/search_material';
                    let requestData = {
                        'material_type': matType,
                        'material_group': matGroup,
                        'keyword': keyword
                    };

                    let fncallback = function (result) {
                        if (result.success) {
                            let recordsTotal = result.data.length;
                            $matSearchGrid.itemsSource = result.data || [];
                        }
                    };

                    AjaxUtil.getAsyncData(url, requestData, fncallback);
                    selectedItem = null;
                });

                // ìƒˆë¡œê³ ì¹¨ ë²„íŠ¼ ì´ë²¤íŠ¸
                let $btnTest = $content.find('#btnTest');
                $btnTest.click(function () {
                    $matSearchGrid.collectionView.refresh();
                });
            }


            showBomCompEdit(data) {
                let _this = this;
                let content = tmpl('bomMaterialTemplate', data);
                let $content = $(content);

                let modalContainer = null;
                if (!data.id) {
                    modalContainer = new PopupDraggable('êµ¬ì„± í’ˆëª© ë“±ë¡');
                } else {
                    modalContainer = new PopupDraggable('êµ¬ì„± í’ˆëª© ìˆ˜ì •');
                }
                modalContainer.open({width: 1025, height: 750, $content});
                /*modalContainer.open({width: 600, height: 540, $content});*/

                let $MaterialName = $content.find('#MaterialName');
                let $Material_id = $content.find('#Material_id');

                let $matSearchGrid = null;
                let selectedItem = null;
                let target = $content.find('#material-search-grid');
                // ğŸ” ë°ì´í„°ê°€ ë°°ì—´ì¸ì§€ í™•ì¸í•˜ê³  ê¸°ë³¸ê°’ ì„¤ì •
                this.viewData4 = Array.isArray(this.viewData4) ? this.viewData4 : [];

                this.grid4 = new wijmo.grid.FlexGrid('#material-search-grid', {
                    selectionMode: wijmo.grid.SelectionMode.Row,
                    headersVisibility: wijmo.grid.HeadersVisibility.Column,
                    autoGenerateColumns: false,
                    showMarquee: true,
                    isReadOnly: false,
                    formatItem: (sender, e) => {
                        if (e.panel.cellType === wijmo.grid.CellType.ColumnHeader) {
                            e.cell.style.textAlign = 'center';
                        }
                    },
                    columns: [
                        {binding: 'MaterialTypeName', header: 'í’ˆëª©êµ¬ë¶„', width: 100, align: 'left'},
                        {binding: 'group_name', header: 'í’ˆëª©ê·¸ë£¹', width: 150, align: 'left'},
                        {binding: 'Code', header: 'í’ˆëª©ì½”ë“œ', width: 150, align: 'center'},
                        {binding: 'Name', header: 'í’ˆëª©ëª…', width: 200, align: 'left'},
                        {binding: '', header: '', width: '*', align: 'left'}
                    ],
                    itemsSource: this.viewData4
                });

                this.grid4.hostElement.addEventListener('dblclick', (e) => {
                    let hitTest = this.grid4.hitTest(e);
                    if (hitTest.cellType === wijmo.grid.CellType.Cell) {
                        let row = hitTest.row;
                        let selectedItem = this.grid4.rows[row].dataItem;
                        $Material_id.val(selectedItem.id);
                        $MaterialName.val(selectedItem.Name);
                    }
                });

                $matSearchGrid = this.grid4; // ê¸°ì¡´ grid4ë¥¼ í• ë‹¹

                $content.find('#btnBomMaterialSave').on('click', function () {
                    let $form = $content.find('#materialForm');
                    Alert.confirm('', 'ì €ì¥í•˜ì‹œê² ìŠµë‹ˆê¹Œ?', function () {
                        _this.saveMaterialData($form);
                    });
                });


                /*let target = $content.find('[data-ax5grid="material-search-grid"]');
                let config = {
                    target: target,
                    sortable: true,
                    frozenColumnIndex: 0, // ì—´ ê³ ì •
                    frozenRowIndex: 0,    // í–‰ ê³ ì •
                    showLineNumber: false, // ì—´ì˜ ë²ˆí˜¸ ë³´ì´ê¸° ì—¬ë¶€
                    showRowSelector: false,  // checkbox(ì„ íƒ) ë³´ì´ê¸° ì—¬ë¶€
                    multipleSelect: false, // ì—¬ëŸ¬í–‰ ì„ íƒ ê°€ëŠ¥ ì—¬ë¶€ (falseì‹œ ë‹¨ë… ì„ íƒ)
                    sortable: true, // ëª¨ë“  ì»¬ëŸ¼ì— ì •ë ¬ ì•„ì´ì½˜ í‘œì‹œ (columnsì—ì„œ ì»¬ëŸ¼ë³„ ì†ŒíŒ…ì—¬ë¶€ ì¬ì„¤ì • ê°€ëŠ¥)
                    multiSort: true, // ë‹¤ì¤‘ ì •ë ¬ ì—¬ë¶€
                    header: {
                        align: 'center',  // í—¤ë”ì˜ ê¸°ë³¸ ì •ë ¬
                        columnHeight: 30  // í—¤ë” ë†’ì´
                    },
                    body: {
                        columnHeight: 25, // bodyì˜ ê¸°ë³¸ ë†’ì´
                        onClick: function () {
                            $matSearchGrid.select(this.dindex);
                        },
                        onDBLClick: function () {
                            $matSearchGrid.select(this.dindex);
                            //_this.selectData(this.item);
                            selectedItem = this.item;
                            $Material_id.val(selectedItem.id);
                            $MaterialName.val(selectedItem.Name);
                        },
                    },
                    page: {
                        display: true,  // í˜ì´ì§• ë³´ì´ê¸° ì—¬ë¶€
                        statusDisplay: true,
                    },
                    columns: [
                        {binding: 'MaterialTypeName', header: 'í’ˆëª©êµ¬ë¶„', width: 100, align: 'left', sortable: false},
                        {binding: 'group_name', header: 'í’ˆëª©ê·¸ë£¹', width: 100, align: 'left', sortable: false},
                        {binding: 'Code', header: 'í’ˆëª©ì½”ë“œ', width: 100, align: 'center', sortable: false},
                        {binding: 'Name', header: 'í’ˆëª©ëª…', width: 200, align: 'left', sortable: false},

                        //{ binding: 'Description', header: 'ì„¤ëª…', width: 250, align: 'center', sortable: false },
                    ]
                };
                $matSearchGrid = new ax5.ui.grid(config);*/

                let $popMaterialType = $content.find('#popMaterialType');
                let $popMaterialGroup = $content.find('#popMaterialGroup');
                let $keyword = $content.find('#keyword');
                let $btnMatSearch = $content.find('#btnMatSearch');

                $popMaterialType.append('<option value="">ì „ì²´</option>');
                $popMaterialType.append('<option value="semi">ë°˜ì œí’ˆ</option>');
                $popMaterialType.append('<option value="raw_mat">ì›ì¬ë£Œ</option>');
                $popMaterialType.append('<option value="sub_mat">ë¶€ìì¬</option>');
                AjaxUtil.fillSelectOptions($popMaterialGroup, 'material_group', 'all', '', $popMaterialType.val());
                $popMaterialType.change(function (e) {
                    AjaxUtil.fillSelectOptions($popMaterialGroup, 'material_group', 'all', '', $popMaterialType.val());
                });

// ê²€ìƒ‰ ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸
                $content.find('#btnMatSearch').click(function () {
                    let matType = $popMaterialType.val();
                    let matGroup = $popMaterialGroup.val();
                    let keyword = $keyword.val();

                    let url = '/api/popup/search_material';
                    let data = {
                        'material_type': matType,
                        'material_group': matGroup,
                        'keyword': keyword,
                    };

                    let fncallback = function (result) {
                        if (result.success) {
                            let recordsTotal = result.data.length;
                            $matSearchGrid.itemsSource = result.data || [];
                        }
                    };

                    AjaxUtil.getAsyncData(url, data, fncallback);
                    selectedItem = null;
                });

                // ê²€ìƒ‰ë²„íŠ¼ í´ë¦­
                /*$btnMatSearch.click(function (e) {
                    let matType = $popMaterialType.val();
                    let matGroup = $popMaterialGroup.val();
                    let keyword = $keyword.val();
                    let url = '/api/popup/search_material';
                    let data = {
                        'material_type': matType,
                        'material_group': matGroup,
                        'keyword': keyword,
                    };
                    let fncallback = function (result) {
                        if (result.success) {
                            let count = result.data.length;
                            $matSearchGrid.setData({
                                list: result.data,
                                page: {
                                    display: true,
                                    totalElements: count,
                                }
                            });
                        }
                    };
                    AjaxUtil.getAsyncData(url, data, fncallback);

                    //ê²€ìƒ‰ë²„íŠ¼ì„ ëˆ„ë¥´ê³  ì´ˆê¸°í™”í•œë‹¤
                    selectedItem = null;

                });*/

                $keyword.keydown(function (e) {
                    if (e.key === 'Enter') {
                        //alert('enter');
                        $btnMatSearch.trigger('click');
                    }
                });



                /*$content.find('#btnBomMaterialSave').on('click', function () {
                    let $form = $content.find('#materialForm');
                    Alert.confirm('',
                        'ì €ì¥í•˜ì‹œê² ìŠµë‹ˆê¹Œ?',
                        function () {
                            _this.saveMaterialData($form);
                        },
                        function () {
                        }
                    );
                });*/

                if (data.action === 'edit') {
                    $btnMatSearch.attr('disabled', true);
                }

                //ìƒˆë¡œê³ ì¹¨
                let $btnTest = $content.find('#btnTest');

                $btnTest.click(function (e) {
                    $matSearchGrid.init().repaint();
                });
            }

            showBomCompList(bom_id) {
                let _this = this;

                let param = {
                    'id': bom_id
                };
                let url = '/api/definition/bom/bom_comp_list';
                let result = AjaxUtil.getSyncData(url, param);

                if (result.success) {
                    try {
                        let count = result.data.length;

                        // ë°ì´í„° ì´ˆê¸°í™”
                        _this.grid2.itemsSource = new wijmo.collections.CollectionView(result.data);

                        // ë³µì‚¬í•  í…ìŠ¤íŠ¸ ìƒì„±
                        let text = result.data.map(item =>
                            `${item.mat_code}\t${item.Amount}\t${item.Description}`
                        ).join('\n');

                        $('#txtCopyText').val(text);
                    } catch (ex) {
                        Notify.error('ì—ëŸ¬ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.' + ex);
                        throw ex;
                    }
                }
            }


            /*showBomCompList(bom_id) {
                let _this = this;

                let param = {
                    'id': bom_id,
                    //"action": 'bom_comp_list'
                };
                let url = '/api/definition/bom/bom_comp_list';
                let result = AjaxUtil.getSyncData(url, param);
                if (result.success) {
                    let count = result.data.length;
                    _this.gridBomComp.setData([]);
                    try {
                        _this.gridBomComp.setData({
                            list: result.data,
                            page: {
                                display: true,
                                totalElements: count,
                            }
                        });
                        let text = '';
                        result.data.forEach(function (item, index) {
                            text += item.mat_code + '\t' + item.Amount + '\t' + item.Description + '\n';
                        });
                        $('#txtCopyText').val(text);
                    } catch (ex) {
                        Notify.error('ì—ëŸ¬ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.' + ex);
                        throw ex;
                    }
                }
            }*/

            showBomCompTreeList(bom_id) {
                let _this = this;
                let url = '/api/definition/bom/material_tree_list';
                let result = AjaxUtil.getSyncData(url, { 'id': bom_id });

                console.log("bom_id:", bom_id); // ë””ë²„ê¹…ìš©
                console.log("API Response:", result); // ë””ë²„ê¹…ìš©

                if (!result) {
                    Alert.alert('', 'ì„œë²„ ì‘ë‹µì´ ì—†ìŠµë‹ˆë‹¤.');
                    return;
                }

                if (result.success) {
                    try {
                        _this.grid3.itemsSource = new wijmo.collections.CollectionView(result.data);

                        if (!result.data || result.data.length === 0) {
                            Alert.alert('', 'ì¡°íšŒëœ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.');
                        }
                    } catch (ex) {
                        Alert.alert('ì—ëŸ¬ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + ex.message);
                        console.error(ex);
                    }
                } else {
                    Alert.alert('', 'ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
                }
            }



            searchBomList() {
                let _this = this;

                let url = '/api/definition/bom/read';
                let data = {
                    'mat_type': $('#cboMaterialType').val(),
                    'mat_group': $('#cboMaterialGroup').val(),
                    'bom_type': $('#cboBOMType').val(),
                    'mat_name': $('#txtMatName').val(),
                    'not_past_flag': $('#not_past_flag').is(':checked') ? 'Y' : ''
                };

                let result = AjaxUtil.getSyncData(url, data);
                if (result.success) {
                    _this.viewData.sourceCollection = result.data;

                }
            }//searchBomList

            saveBOMData($form) {
                let _this = this;
                let url = '/api/definition/bom/save';
                //ë°ì´í„°ì…ë ¥ì²´í¬ë£¨í‹´ ëˆ„ë½
                //let data = $('#equipmentForm').serialize();

                let data = FormUtil.extractForm($form);
                if (data.Material_id == '') {
                    Alert.alert('', '(ë°˜)ì œí’ˆì„ ì„ íƒí•˜ì„¸ìš”!!');
                    return;
                }

                if (!data.StartDate || !data.EndDate) {
                    Alert.alert('', 'ì ìš©ì‹œì‘ì¼ê³¼ ì ìš©ì¢…ë£Œì¼ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                    return;
                }

                if (data.StartDate > data.EndDate) {
                    Alert.alert('', 'ì ìš©ì‹œì‘ì¼ê³¼ ì ìš©ì¢…ë£Œì¼ì„ í™•ì¸í•´ì£¼ì„¸ìš”.');
                    return;
                }

                let fnSuccess = function (result) {
                    if (result.success) {
                        Alert.alert('','ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤');
                        _this.searchBomList();
                    } else {
                        Notify.error(result.message);
                    }
                };
                AjaxUtil.postAsyncData(url, data, fnSuccess);
            }

            saveMaterialData($form) {
                let _this = this;
                let url = '/api/definition/bom/material_save';

                //ë°ì´í„°ì…ë ¥ì²´í¬ë£¨í‹´ ëˆ„ë½
                let data = FormUtil.extractForm($form);

                if (data.Material_id == '') {
                    Alert.alert('', 'í’ˆëª©ì„ ì„ íƒí•˜ì„¸ìš”.');
                    return;
                }

                let fnSuccess = function (res) {
                    if (res.success)
                        Alert.alert('', 'ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.');
                    else {
                        Alert.alert('', 'ì €ì¥ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. \n' + res.message);
                        return;
                    }


                    let grid = wijmo.Control.getControl('#bom-grid'); // ê·¸ë¦¬ë“œ ê°ì²´ ê°€ì ¸ì˜¤ê¸°
                    let selection = grid.selection; // í˜„ì¬ ì„ íƒëœ ì…€ì˜ ì •ë³´ ê°€ì ¸ì˜¤ê¸°

                    /*let items = page.gridBom.getList("selected");*/

                    if (selection.row > -1) { // ì„ íƒëœ í–‰ì´ ìˆì„ ê²½ìš°
                        let item = grid.rows[selection.row].dataItem; // ì„ íƒëœ í–‰ì˜ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°

                        if (item) {
                            let id = item.id; // ID ê°’ ê°€ì ¸ì˜¤ê¸°
                            _this.showBomCompList(id);
                        }
                    }

                   /* let items = page.gridBom.getList("selected");
                    if (items.length > 0) {
                        _this.showBomCompList(items[0].id);
                    }*/

                };
                AjaxUtil.postAsyncData(url, data, fnSuccess);
            }

            //ë³µì œ
            replicateBOM(bom_id) {
                let _this = this;
                let url = '/api/definition/bom/bom_replicate';

                let data = {id: bom_id};
                let fnSuccess = function (res) {
                    if (res.success) {
                        Alert.alert('','ë³µì œë˜ì—ˆìŠµë‹ˆë‹¤.');
                        _this.searchBomList();
                    }
                };

                AjaxUtil.postAsyncData(url, data, fnSuccess);
            }
//ê°œì •
            revisionBOM(bom_id) {
                let _this = this;
                let url = '/api/definition/bom/bom_revision';

                let data = {id: bom_id};
                let fnSuccess = function (res) {
                    if (res.success) {
                        Alert.alert('','ê°œì •ë˜ì—ˆìŠµë‹ˆë‹¤.');
                        _this.searchBomList();
                    }
                };

                AjaxUtil.postAsyncData(url, data, fnSuccess);
            }

            deleteMaterialData(id) {
                let _this = this;
                let url = '/api/definition/bom/material_delete';
                let fnsuccess = function (res) {
                    if (res.success) {
                        Alert.alert('','ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤');

                        let grid = wijmo.Control.getControl('#bomcomp-grid'); // ê·¸ë¦¬ë“œ ê°ì²´ ê°€ì ¸ì˜¤ê¸°
                        let selection = grid.selection; // í˜„ì¬ ì„ íƒëœ ì…€ì˜ ì •ë³´ ê°€ì ¸ì˜¤ê¸°

                        if (selection.row > -1) { // ì„ íƒëœ í–‰ì´ ìˆì„ ê²½ìš°
                            let item = grid.rows[selection.row].dataItem; // ì„ íƒëœ í–‰ì˜ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°

                            if (item) {
                                let id = item.id; // ID ê°’ ê°€ì ¸ì˜¤ê¸°
                                _this.showBomCompList(id);
                            }
                        }

                      /*  let items = page.gridBom.getList("selected");
                        if (items.length > 0) {
                            _this.showBomCompList(items[0].id);
                        }*/
                    } else {
                        Alert.alert('', res.message);
                    }
                };
                AjaxUtil.postAsyncData(url, {id: id}, fnsuccess);
            }


            deleteBOM(id) {
                let _this = this;
                let url = '/api/definition/bom/bom_delete';
                let data = {'id': id};
                let fnDeleteSuccessCallback = function (res) {
                    if (res.success) {
                        Alert.alert('','ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
                        _this.searchBomList();
                    } else {
                        Alert.alert('', res.message);
                    }
                };
                AjaxUtil.postAsyncData(url, data, fnDeleteSuccessCallback);
            }


            saveAllBomComp(bom_id) {
                let _this = this;
                let txtbox = $('#txtCopyText').val().trim();

                if (txtbox === '') {
                    Alert.alert('', 'ì…ë ¥ëœ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.');
                    return;
                }

                let normalizedText = txtbox.replace(/  +/g, '\t'); // ì—°ì†ëœ ê³µë°±ì„ íƒ­ìœ¼ë¡œ ë³€ê²½
                let lines = normalizedText.split('\n');
                let bErr = false;

                lines.forEach(function (line, index) {
                    let cols = line.split(/\s+/); // íƒ­ ë˜ëŠ” ê³µë°± ê¸°ì¤€ìœ¼ë¡œ ë¶„ë¦¬
                    console.log("ì¤„:", line, "ì»¬ëŸ¼ ê°œìˆ˜:", cols.length);
                    if (line.trim() !== '' && cols.length < 2) {
                        bErr = true;
                    }
                });

                if (bErr) {
                    Alert.alert('', 'ë°ì´í„°ê°€ ì í•©í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. ë‹¤ì‹œ í™•ì¸í•˜ì‹­ì‹œì˜¤.');
                    return;
                }

                let url = '/api/definition/bom?action=save_bom_comp_all';
                let data = {
                    'bom_id': bom_id,
                    'lines': txtbox,
                };
                let fnDeleteSuccessCallback = function (res) {
                    Alert.alert('', 'ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.');
                };

                AjaxUtil.postAsyncData(url, data, fnDeleteSuccessCallback);
            }


            saveBomCompOrder() {
                let _this = this;
                let grid = wijmo.Control.getControl('#bomcomp-grid'); // ê·¸ë¦¬ë“œ ê°ì²´ ê°€ì ¸ì˜¤ê¸°

                if (!grid || !grid.itemsSource) {
                    console.error("saveBomCompOrderí•¨ìˆ˜ì—ì„œ gridBomComp ë˜ëŠ” itemsSourceê°€ ì¡´ì¬í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.");
                    return;
                }

                let items = [];
                $.each(grid.itemsSource, function (idx, item) {
                    if (item && item.id) {
                        items.push({ id: item.id });
                    }
                });

                let url = '/api/definition/bom/save_bom_comp_order';
                let strData = JSON.stringify(items);
                let data = { Q: strData };
                let fnsuccess = function (result) {
                    if (result.success) {
                        Alert.alert('', 'ì €ì¥í–ˆìŠµë‹ˆë‹¤.');
                        _this.showBomCompEdit();
                    }
                };

                AjaxUtil.postAsyncData(url, data, fnsuccess);
            }


        }

        let page = null;

        $(document).ready(function (e) {
            page = new BOMPage();
            //ê·¸ë¦¬ë“œ ì»¬ëŸ¼ ì„¤ì •

            if (userinfo.group_code == 'admin') {
                $('#btnGridSetting').css('visibility', 'visible');
                $('#btnBomCompGridSetting').css('visibility', 'visible');
            }

            /* //ê·¸ë¦¬ë“œ ì»¬ëŸ¼ ì„¤ì •
             page.popColSetting = new popColSetting();
             let columns1 = page.popColSetting.loadColumnData(gui.gui_code, gui.template_key, 'grid1', page.gridBom);
             let columns2 = page.popColSetting.loadColumnData(gui.gui_code, gui.template_key, 'grid2', page.gridBomComp);

             $('#btnGridSetting').click(function (e) {
                 let _this = this;
                 let fix_cols = page.grid_config1.frozenColumnIndex;
                 page.popColSetting.show(gui.gui_code, gui.template_key, 'grid1', page.grid_config1.columns, page.gridBom, {
                     'order_fix': false,
                     'fix_cols': fix_cols
                 });
             });
             $('#btnBomCompGridSetting').click(function (e) {
                 let _this = this;
                 let fix_cols = page.grid_config2.frozenColumnIndex;
                 page.popColSetting.show(gui.gui_code, gui.template_key, 'grid2', page.grid_config2.columns, page.gridBomComp, {
                     'order_fix': false,
                     'fix_cols': fix_cols
                 });
             });*/

            page.searchBomList();

            $('#btnSearch').click(function (ex) {
                page.searchBomList();
            });

            $('#btnBomNew').click(function (e) {

                let start_date = CommonUtil.getYYYYMMDD();
                let end_date = CommonUtil.getYYYYMMDD();
                let data = {
                    'id': '',
                    'Material_id': '',
                    'MaterialName': '',
                    'Name': '',
                    'BOMType': '',
                    'StartDate': start_date,
                    'EndDate': end_date,
                    'OutputAmount': 1,
                };

                page.showBomEdit(data);

            });

            $('#btnBomReplicate').click(function () {
              /*  let items = page.gridBom.getList("selected");*/
                let grid = wijmo.Control.getControl('#bom-grid'); // ê·¸ë¦¬ë“œ ê°ì²´ ê°€ì ¸ì˜¤ê¸°
                let selection = grid.selection; // í˜„ì¬ ì„ íƒëœ ì…€ì˜ ì •ë³´ ê°€ì ¸ì˜¤ê¸°

                if (selection.row > -1) { // ì„ íƒëœ í–‰ì´ ìˆì„ ê²½ìš°
                    let item = grid.rows[selection.row].dataItem; // ì„ íƒëœ í–‰ì˜ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°

                    if (item) {
                        let id = item.id; // ID ê°’ ê°€ì ¸ì˜¤ê¸°

                        Alert.confirm('', "ì„ íƒí•œ BOMì„ ê°€ì§€ê³  ìƒˆ BOMì„ ë³µì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?",
                            function () {
                        page.replicateBOM(id);
                            },
                            function () {
                            }
                        );
                    }
                }
                /*if (items.length > 0) {
                    Alert.confirm('', "ì„ íƒí•œ BOMì„ ê°€ì§€ê³  ìƒˆ BOMì„ ë³µì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?",
                        function () {
                            let id = items[0].id;
                            page.replicateBOM(id);
                        },
                        function () {
                        }
                    );
                }*/



            });

            $('#btnBomRevision').click(function () {
                /*let items = page.gridBom.getList("selected");*/
                let grid = wijmo.Control.getControl('#bom-grid'); // ê·¸ë¦¬ë“œ ê°ì²´ ê°€ì ¸ì˜¤ê¸°
                let selection = grid.selection; // í˜„ì¬ ì„ íƒëœ ì…€ì˜ ì •ë³´ ê°€ì ¸ì˜¤ê¸°

                if (selection.row > -1) { // ì„ íƒëœ í–‰ì´ ìˆì„ ê²½ìš°
                    let item = grid.rows[selection.row].dataItem; // ì„ íƒëœ í–‰ì˜ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°

                    if (item) {
                        let id = item.id; // ID ê°’ ê°€ì ¸ì˜¤ê¸°

                        Alert.confirm('', "ì„ íƒí•œ BOMì„ ê°œì •í•˜ì‹œê² ìŠµë‹ˆê¹Œ? ê°œì • í›„ ë³µì œëœ ë‚´ìš©ì„ ìˆ˜ì •í•˜ì‹­ì‹œì˜¤.",
                            function () {
                                page.revisionBOM(id);
                            },
                            function () {
                            }
                        );
                    }
                }
                /*if (items.length > 0) {
                    Alert.confirm('', "ì„ íƒí•œ BOMì„ ê°œì •í•˜ì‹œê² ìŠµë‹ˆê¹Œ? ê°œì • í›„ ë³µì œëœ ë‚´ìš©ì„ ìˆ˜ì •í•˜ì‹­ì‹œì˜¤.",
                        function () {
                            let id = items[0].id;
                            page.revisionBOM(id);
                        },
                        function () {
                        }
                    );
                }*/
            });

            $('#btnBomCompNew').click(function (e) {
                let grid = wijmo.Control.getControl('#bom-grid'); // ê·¸ë¦¬ë“œ ê°ì²´ ê°€ì ¸ì˜¤ê¸°
                let selection = grid.selection; // í˜„ì¬ ì„ íƒëœ ì…€ì˜ ì •ë³´ ê°€ì ¸ì˜¤ê¸°

                if (selection.row > -1) { // ì„ íƒëœ í–‰ì´ ìˆì„ ê²½ìš°
                    let item = grid.rows[selection.row].dataItem; // ì„ íƒëœ í–‰ì˜ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°

                    if (item) {
                        let id = item.id; // ID ê°’ ê°€ì ¸ì˜¤ê¸°

                        let data = {
                            id: '',
                            BOM_id: id,
                            Amount: 1,
                            Description: '',
                            action: 'new',
                        };

                        page.showBomCompEdit(data);
                    }
                } else {
                    Alert.alert('', "ì„ íƒëœ BOMì´ ì—†ìŠµë‹ˆë‹¤.");
                }

                /*if (items.length > 0) {

                    let data = {
                        id: '',
                        BOM_id: items[0].id,
                        Amount: 1,
                        Description: '',
                        action: 'new',
                    };
                    page.showBomCompEdit(data);
                } else {
                    Alert.alert('', 'ì„ íƒëœ BOMì´ ì—†ìŠµë‹ˆë‹¤');
                }*/
            });

            $('#btnBomCompEdit').click(function (e) {
                /*let items = page.gridBomComp.getList("selected");*/
                let grid = wijmo.Control.getControl('#bomcomp-grid'); // ê·¸ë¦¬ë“œ ê°ì²´ ê°€ì ¸ì˜¤ê¸°
                let selection = grid.selection; // í˜„ì¬ ì„ íƒëœ ì…€ì˜ ì •ë³´ ê°€ì ¸ì˜¤ê¸°

                if (selection.length == 0) {
                    Alert.alert('', 'ì„ íƒëœ í’ˆëª©ì´ ì—†ìŠµë‹ˆë‹¤');
                    return;
                }

                /*let row = items[0];*/
                //if (row.parent_mat_id > 0) {
                //    Alert.alert('', '1ë ˆë²¨ì˜ êµ¬ì„±í’ˆë§Œ ìˆ˜ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.');
                //    return;
                //}

                if (selection.row > -1) { // ì„ íƒëœ í–‰ì´ ìˆì„ ê²½ìš°
                    let item = grid.rows[selection.row].dataItem; // ì„ íƒëœ í–‰ì˜ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
                    let url = '/api/definition/bom/material_detail';

                    if (item) {
                        let id = item.id; // ID ê°’ ê°€ì ¸ì˜¤ê¸°
                        let url = '/api/definition/bom/material_detail';
                        let result = AjaxUtil.getSyncData(url, {id: id});

                        let data = result.data;
                        data.action = 'edit';
                        page.showBomCompEdit(data);
                    }
                } else {
                    Alert.alert('', 'ì„ íƒëœ í’ˆëª©ì´ ì—†ìŠµë‹ˆë‹¤');
                }

                /*if (items.length > 0) {
                    let url = '/api/definition/bom/material_detail';
                    let result = AjaxUtil.getSyncData(url, {id: row.id});
                    if (result.success) {
                        let data = result.data;
                        data.action = 'edit';
                        page.showBomCompEdit(data);

                    } else {
                        Alert.alert('ì˜¤ë¥˜', "ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
                    }
                } else {
                    Alert.alert('', 'ì„ íƒëœ í’ˆëª©ì´ ì—†ìŠµë‹ˆë‹¤');
                }*/

            });

            $('#btnBomCompDelete').click(function (e) {
                /*let items = page.gridBomComp.getList("selected");*/
                let grid = wijmo.Control.getControl('#bomcomp-grid'); // ê·¸ë¦¬ë“œ ê°ì²´ ê°€ì ¸ì˜¤ê¸°
                let selection = grid.selection; // í˜„ì¬ ì„ íƒëœ ì…€ì˜ ì •ë³´ ê°€ì ¸ì˜¤ê¸°

                if (selection.length == 0) {
                    Alert.alert('', 'ì„ íƒëœ í’ˆëª©ì´ ì—†ìŠµë‹ˆë‹¤');
                    return;
                }

                if (selection.row > -1) { // ì„ íƒëœ í–‰ì´ ìˆì„ ê²½ìš°
                    let item = grid.rows[selection.row].dataItem; // ì„ íƒëœ í–‰ì˜ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°

                    if (item) {
                        let id = item.id; // ID ê°’ ê°€ì ¸ì˜¤ê¸°

                        Alert.confirm('', "ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?", function (e) {
                            page.deleteMaterialData(id);
                        });
                    }
                }


               /* let row = items[0];
                if (row.parent_mat_id > 0) {
                    Alert.alert('', '1ë ˆë²¨ì˜ êµ¬ì„±í’ˆë§Œ ì‚­ì œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.');
                    return;
                }
                Alert.confirm('', "ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?", function (e) {
                    page.deleteMaterialData(row.id);
                });*/

            });




            $('#btnBomEdit').click(function (e) {
                let grid = wijmo.Control.getControl('#bom-grid'); // ê·¸ë¦¬ë“œ ê°ì²´ ê°€ì ¸ì˜¤ê¸°
                let selection = grid.selection; // í˜„ì¬ ì„ íƒëœ ì…€ì˜ ì •ë³´ ê°€ì ¸ì˜¤ê¸°

                if (selection.row > -1) { // ì„ íƒëœ í–‰ì´ ìˆì„ ê²½ìš°
                    let item = grid.rows[selection.row].dataItem; // ì„ íƒëœ í–‰ì˜ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°

                    if (item) {
                        let id = item.id; // ID ê°’ ê°€ì ¸ì˜¤ê¸°
                        let url = '/api/definition/bom/detail';
                        let result = AjaxUtil.getSyncData(url, { id: id });

                        if (result.success) {
                            page.showBomEdit(result.data);
                        } else {
                            Alert.alert("ìƒì„¸ì¡°íšŒ ì˜¤ë¥˜", "ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
                        }
                    }
                } else {
                    Alert.alert("ì„ íƒ ì˜¤ë¥˜", "í¸ì§‘í•  BOMì„ ì„ íƒí•˜ì„¸ìš”.");
                }
            });


            $('#btnBomDelete').click(function (e) {
                let grid = wijmo.Control.getControl('#bom-grid'); // ê·¸ë¦¬ë“œ ê°ì²´ ê°€ì ¸ì˜¤ê¸°
                let selection = grid.selection; // í˜„ì¬ ì„ íƒëœ ì…€ì˜ ì •ë³´ ê°€ì ¸ì˜¤ê¸°

                /*let items = page.gridBom.getList("selected");*/

                if (selection.row > -1) { // ì„ íƒëœ í–‰ì´ ìˆì„ ê²½ìš°
                    let item = grid.rows[selection.row].dataItem; // ì„ íƒëœ í–‰ì˜ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°

                    if (item) {
                        let id = item.id; // ID ê°’ ê°€ì ¸ì˜¤ê¸°
                        Alert.confirm('', "ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?",
                            function () {
                        page.deleteBOM(id);
                            },
                            function () {
                            }
                        );
                    }
                } else {
                    Alert.alert("ì„ íƒ ì˜¤ë¥˜", "ì‚­ì œí•  BOMì„ ì„ íƒí•˜ì„¸ìš”.");
                }
            });

            $('#btnSaveBomText').click(function (e) {
                let grid = wijmo.Control.getControl('#bom-grid'); // ê·¸ë¦¬ë“œ ê°ì²´ ê°€ì ¸ì˜¤ê¸°
                let selection = grid.selection; // í˜„ì¬ ì„ íƒëœ ì…€ì˜ ì •ë³´ ê°€ì ¸ì˜¤ê¸°

                if (selection.length == 0) {
                    Alert.alert('ì œí’ˆì´ ì„ íƒë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.');
                    return;
                }

                if (selection.row > -1) { // ì„ íƒëœ í–‰ì´ ìˆì„ ê²½ìš°
                    let item = grid.rows[selection.row].dataItem; // ì„ íƒëœ í–‰ì˜ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°

                    if (item) {
                        let id = item.id; // ID ê°’ ê°€ì ¸ì˜¤ê¸°
                        let bom_id = id;

                        Alert.confirm('', "í˜„ BOM êµ¬ì„±ì„ ëª¨ë‘ ì‚­ì œí•˜ê³  í•œêº¼ë²ˆì— ìƒˆë¡œ ì €ì¥í•˜ì‹œê² ìŠµë‹ˆê¹Œ?",
                            function () {
                                page.saveAllBomComp(bom_id);
                            },
                            function () {
                            }
                        );
                    }
                }
            });

            $('#btnCompUp').click(function (e) {
                let grid = wijmo.Control.getControl('#bomcomp-grid'); // ê·¸ë¦¬ë“œ ê°ì²´ ê°€ì ¸ì˜¤ê¸°
                GridUtil.changeOrder('U', grid);
            });


            $('#btnCompDown').click(function (e) {
                let grid = wijmo.Control.getControl('#bomcomp-grid'); // ê·¸ë¦¬ë“œ ê°ì²´ ê°€ì ¸ì˜¤ê¸°
                GridUtil.changeOrder('D', grid);
            });

            $('#btnCompOrderSave').click(function (e) {
                let grid = wijmo.Control.getControl('#bomcomp-grid'); // ê·¸ë¦¬ë“œ ê°ì²´ ê°€ì ¸ì˜¤ê¸°

                if (!grid || !grid.itemsSource) {
                    console.error("ë²„íŠ¼í´ë¦­ í•¨ìˆ˜ gridBomComp ë˜ëŠ” itemsSourceê°€ ì¡´ì¬í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.");
                    return;
                }

                let count = grid.itemsSource.length;

                if (count === 0 || count === 1) {
                    return;
                }

                Alert.confirm('', 'ìˆœì„œë¥¼ ì €ì¥í•˜ì‹œê² ìŠµë‹ˆê¹Œ?', function () {
                    page.saveBomCompOrder();
                });
            });


            /*let items = page.gridBom.getList("selected");*/
            $('#btnBomTreeView').click(function (e) {
                let grid = wijmo.Control.getControl('#bom-grid'); // ê·¸ë¦¬ë“œ ê°ì²´ ê°€ì ¸ì˜¤ê¸°
                let selection = grid.selection; // í˜„ì¬ ì„ íƒëœ ì…€ì˜ ì •ë³´ ê°€ì ¸ì˜¤ê¸°

                if (selection.row < 0) { // ì„ íƒëœ í–‰ì´ ì—†ëŠ” ê²½ìš°
                    return;
                }

                let selectedItem = grid.rows[selection.row].dataItem; // ì„ íƒëœ í–‰ì˜ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
                if (!selectedItem || !selectedItem.id) { // idê°€ ì—†ì„ ê²½ìš° ë°©ì–´ ì½”ë“œ
                    Alert.alert('', 'ì„ íƒëœ ë°ì´í„°ì— BOM IDê°€ ì—†ìŠµë‹ˆë‹¤.');
                    return;
                }


                let bom_id = selectedItem.id;
                page.showBomCompTreeList(bom_id);
            });

            // ì—‘ì…€ ë‹¤ìš´ë¡œë“œ
            $('#btnExcel').click(function (e) {
                //page.gridBom.exportExcel('BOM.xls');
                let bom_type = $('#cboBOMType').val();
                if (bom_type == '') {
                    Alert.alert('ê²½ê³ ', '"BOMêµ¬ë¶„"ì„ ì„ íƒí•˜ê³  ì¶œë ¥í•˜ì‹­ì‹œì˜¤.');
                    return;
                }
                let url = '/api/files/bom_download?';
                url += 'bom_type=' + bom_type;
                AjaxUtil.downloadFile(url, 'bom-all.xlsx');
            });

            //page.searchBomList();

        });
    </script>


</th:block>
</html>
